<!-- Implementation-NSITE Viewer -->
<!-- Solution tracking dashboard for NSITE MO Implementation team -->

<div class="implementation-viewer">
  <!-- Page Header -->
  <div class="page-header">
    <div class="page-title">
      <h1>Implementation-NSITE</h1>
      <p class="page-subtitle">Solution / Project Focused Dashboard</p>
    </div>
    <div class="page-actions">
      <button class="btn btn-secondary" onclick="Implementation.exportData()">
        <span class="material-icons">download</span>
        Export
      </button>
    </div>
  </div>

  <!-- Top Row: Stats + MO Milestones + Document Administration -->
  <div class="dashboard-top-row">
    <!-- Stats Summary -->
    <div class="panel stats-panel">
      <div class="panel-header">
        <span class="material-icons">bar_chart</span>
        <span>Portfolio Overview</span>
      </div>
      <div class="stats-grid-compact" id="implementationStats">
        <div class="stat-item">
          <div class="stat-value" id="statTotalSolutions">--</div>
          <div class="stat-label">Total</div>
        </div>
        <div class="stat-item stat-green">
          <div class="stat-value" id="statOperational">--</div>
          <div class="stat-label">Operational</div>
        </div>
        <div class="stat-item stat-blue">
          <div class="stat-value" id="statImplementation">--</div>
          <div class="stat-label">Implementation</div>
        </div>
        <div class="stat-item stat-orange">
          <div class="stat-value" id="statFormulation">--</div>
          <div class="stat-label">Formulation</div>
        </div>
      </div>
    </div>

    <!-- MO Milestones Panel -->
    <div class="panel milestones-panel">
      <div class="panel-header">
        <span class="material-icons">flag</span>
        <span>Implementation Milestones</span>
      </div>
      <div class="milestones-tracker">
        <div class="milestone-item" data-milestone="ATP">
          <span class="milestone-badge">ATP</span>
          <span class="milestone-label">Authority to Proceed DG</span>
          <span class="milestone-count" id="countATP">--</span>
        </div>
        <div class="milestone-item" data-milestone="F2I">
          <span class="milestone-badge">F2I</span>
          <span class="milestone-label">Formulation to Implementation DG</span>
          <span class="milestone-count" id="countF2I">--</span>
        </div>
        <div class="milestone-item" data-milestone="ORR">
          <span class="milestone-badge">ORR</span>
          <span class="milestone-label">Operational Readiness Review</span>
          <span class="milestone-count" id="countORR">--</span>
        </div>
        <div class="milestone-item" data-milestone="CLOSE">
          <span class="milestone-badge">CLOSE</span>
          <span class="milestone-label">Closeout DG</span>
          <span class="milestone-count" id="countCloseout">--</span>
        </div>
      </div>
    </div>

    <!-- Document Administration Panel -->
    <div class="panel docs-panel">
      <div class="panel-header">
        <span class="material-icons">description</span>
        <span>Document Administration</span>
      </div>
      <div class="docs-tracker" id="docsTracker">
        <div class="doc-item">
          <span class="doc-name">Project Plan</span>
          <span class="doc-status" id="docProjectPlan">--</span>
        </div>
        <div class="doc-item">
          <span class="doc-name">Science SOW</span>
          <span class="doc-status" id="docScienceSow">--</span>
        </div>
        <div class="doc-item">
          <span class="doc-name">IPA</span>
          <span class="doc-status" id="docIpa">--</span>
        </div>
        <div class="doc-item">
          <span class="doc-name">ICD</span>
          <span class="doc-status" id="docIcd">--</span>
        </div>
        <div class="doc-item">
          <span class="doc-name">TTA</span>
          <span class="doc-status" id="docTta">--</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Per-Solution Tracking Summary -->
  <div class="tracking-summary-row">
    <div class="tracking-card">
      <span class="material-icons">storage</span>
      <div class="tracking-info">
        <span class="tracking-title">DAAC Assignments</span>
        <span class="tracking-subtitle">Data center allocation</span>
      </div>
      <span class="tracking-value" id="statDAAC">--</span>
    </div>
    <div class="tracking-card">
      <span class="material-icons">calendar_today</span>
      <div class="tracking-info">
        <span class="tracking-title">Deep Dives</span>
        <span class="tracking-subtitle">Scheduled reviews</span>
      </div>
      <span class="tracking-value" id="statDeepDives">--</span>
    </div>
    <div class="tracking-card">
      <span class="material-icons">check_box</span>
      <div class="tracking-info">
        <span class="tracking-title">Action Items</span>
        <span class="tracking-subtitle">Open items</span>
      </div>
      <span class="tracking-value" id="statActions">--</span>
    </div>
    <div class="tracking-card">
      <span class="material-icons">group</span>
      <div class="tracking-info">
        <span class="tracking-title">Stakeholder Lists</span>
        <span class="tracking-subtitle">Linked contacts</span>
      </div>
      <span class="tracking-value" id="statStakeholders">--</span>
    </div>
  </div>

  <!-- Filters -->
  <div class="filter-bar">
    <div class="filter-group solution-picker-group">
      <label class="filter-label">Solutions:</label>
      <button class="btn btn-secondary btn-sm solution-picker-btn" id="solutionPickerBtn" onclick="Implementation.toggleSolutionPicker()">
        <span id="solutionPickerLabel">Loading...</span>
        <span class="material-icons">expand_more</span>
      </button>
      <div class="solution-picker-dropdown" id="solutionPickerDropdown">
        <div class="picker-actions">
          <button class="picker-action-btn" onclick="Implementation.selectActiveSolutions()">Default</button>
          <button class="picker-action-btn" onclick="Implementation.selectAllSolutions()">All</button>
          <button class="picker-action-btn" onclick="Implementation.clearSolutionSelection()">None</button>
        </div>
        <div class="picker-section">
          <div class="picker-section-header">Default Selection</div>
          <div class="picker-list" id="activePickerList"></div>
        </div>
        <div class="picker-section">
          <div class="picker-section-header">Other Solutions</div>
          <div class="picker-list" id="otherPickerList"></div>
        </div>
      </div>
    </div>
    <div class="filter-group">
      <label class="filter-label">Cycle:</label>
      <select class="form-select filter-select" id="filterCycle" onchange="Implementation.applyFilters()">
        <option value="">All Cycles</option>
        <option value="1">C1 (2016)</option>
        <option value="2">C2 (2018)</option>
        <option value="3">C3 (2020)</option>
        <option value="4">C4 (2022)</option>
        <option value="5">C5 (2024)</option>
        <option value="6">C6 (2026)</option>
      </select>
    </div>
    <div class="filter-group">
      <label class="filter-label">Phase:</label>
      <select class="form-select filter-select" id="filterPhase" onchange="Implementation.applyFilters()">
        <option value="">All Phases</option>
        <option value="Pre-Formulation">Pre-Formulation</option>
        <option value="Formulation">Formulation</option>
        <option value="Implementation">Implementation</option>
        <option value="Production / Operational">Production / Operational</option>
        <option value="Completed">Completed</option>
      </select>
    </div>
    <div class="filter-group">
      <label class="filter-label">Group:</label>
      <select class="form-select filter-select" id="filterGroup" onchange="Implementation.applyFilters()">
        <option value="">All Groups</option>
      </select>
    </div>
    <div class="filter-group">
      <label class="filter-label">DAAC:</label>
      <select class="form-select filter-select" id="filterDAAC" onchange="Implementation.applyFilters()">
        <option value="">All DAACs</option>
      </select>
    </div>
    <div class="filter-search">
      <span class="material-icons">search</span>
      <input type="text" class="form-input search-input" id="filterSearch"
             placeholder="Search solutions..."
             oninput="Implementation.applyFilters()">
    </div>
    <button class="btn btn-secondary btn-sm" onclick="Implementation.clearFilters()">
      Clear
    </button>
  </div>

  <!-- Solutions by Cycle -->
  <div class="solutions-container" id="solutionsContainer">
    <div class="loading-state">
      <span class="loading-spinner"></span>
      <p>Loading solutions...</p>
    </div>
  </div>
</div>

<!-- Solution Detail Modal -->
<div class="modal-overlay" id="solutionModal" onclick="Implementation.closeModal(event)">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title" id="modalTitle">Solution Details</h2>
      <button class="modal-close" onclick="Implementation.closeModal()">&times;</button>
    </div>
    <div class="modal-body" id="modalBody">
      <!-- Dynamic content -->
    </div>
  </div>
</div>

<!-- Implementation-NSITE Styles -->
<style>
  .implementation-viewer { max-width: 1600px; margin: 0 auto; }

  /* Page Header */
  .page-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-lg); }
  .page-title h1 { font-size: var(--font-size-xxl); color: var(--color-implementation); margin-bottom: var(--space-xs); }
  .page-subtitle { color: var(--color-text-secondary); font-size: var(--font-size-md); }
  .page-actions { display: flex; gap: var(--space-sm); }

  /* Dashboard Top Row */
  .dashboard-top-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: var(--space-md);
    margin-bottom: var(--space-md);
  }

  .panel {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }

  .panel-header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-md);
    background: var(--color-surface-alt);
    font-weight: 600;
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    border-bottom: 1px solid var(--color-border-light);
  }

  .panel-header svg { width: 16px; height: 16px; }

  /* Stats Panel */
  .stats-panel { border-top: 3px solid var(--color-implementation); }

  .stats-grid-compact {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    padding: var(--space-md);
    gap: var(--space-sm);
  }

  .stat-item {
    text-align: center;
    padding: var(--space-sm);
    border-radius: var(--radius-sm);
    background: var(--color-surface-alt);
  }

  .stat-item .stat-value { font-size: var(--font-size-xl); font-weight: 700; color: var(--color-text); }
  .stat-item .stat-label { font-size: var(--font-size-xs); color: var(--color-text-secondary); }
  .stat-item.stat-green .stat-value { color: var(--color-success); }
  .stat-item.stat-blue .stat-value { color: var(--color-info); }
  .stat-item.stat-orange .stat-value { color: var(--color-warning); }

  /* Milestones Panel */
  .milestones-panel { border-top: 3px solid #10b981; }

  .milestones-tracker {
    display: flex;
    flex-direction: column;
    padding: var(--space-sm);
    gap: var(--space-xs);
  }

  .milestone-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-xs) var(--space-sm);
    background: rgba(16, 185, 129, 0.08);
    border-radius: var(--radius-sm);
    border-left: 3px solid #10b981;
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .milestone-item:hover { background: rgba(16, 185, 129, 0.15); transform: translateX(2px); }

  .milestone-badge {
    font-family: monospace;
    font-size: var(--font-size-xs);
    font-weight: 700;
    color: #10b981;
    background: rgba(16, 185, 129, 0.2);
    padding: 2px 6px;
    border-radius: 3px;
    min-width: 32px;
    text-align: center;
  }

  .milestone-label { flex: 1; font-size: var(--font-size-sm); color: var(--color-text-secondary); }
  .milestone-count { font-size: var(--font-size-sm); font-weight: 600; color: #10b981; }

  /* Document Administration Panel */
  .docs-panel { border-top: 3px solid var(--color-warning); }

  .docs-tracker {
    display: flex;
    flex-direction: column;
    padding: var(--space-sm);
    gap: var(--space-xs);
  }

  .doc-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-xs) var(--space-sm);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
  }

  .doc-name { font-size: var(--font-size-sm); color: var(--color-text); }

  .doc-status {
    font-size: var(--font-size-xs);
    padding: 2px 8px;
    border-radius: 10px;
    font-weight: 500;
    background: var(--color-surface);
    color: var(--color-text-muted);
  }

  .doc-status.status-complete { background: rgba(16, 185, 129, 0.15); color: #10b981; }
  .doc-status.status-in-work { background: rgba(249, 115, 22, 0.15); color: #f97316; }
  .doc-status.status-not-started { background: var(--color-surface); color: var(--color-text-muted); }

  /* Document Status Grid (modal) */
  .doc-status-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-sm);
  }

  .doc-status-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-xs) var(--space-sm);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
  }

  .doc-status-label {
    font-size: var(--font-size-sm);
    color: var(--color-text);
  }

  .doc-badge {
    font-size: var(--font-size-xs);
    padding: 2px 8px;
    border-radius: 10px;
    font-weight: 500;
  }

  .doc-badge-complete { background: rgba(16, 185, 129, 0.15); color: #10b981; }
  .doc-badge-in-work { background: rgba(249, 115, 22, 0.15); color: #f97316; }
  .doc-badge-not-started { background: var(--color-surface); color: var(--color-text-muted); }

  /* Tracking Summary Row */
  .tracking-summary-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
  }

  .tracking-card {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-md);
    background: var(--color-surface);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    transition: all var(--transition-fast);
    cursor: pointer;
  }

  .tracking-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }

  .tracking-icon { width: 24px; height: 24px; color: var(--color-text-muted); }
  .tracking-info { flex: 1; }
  .tracking-title { display: block; font-weight: 600; font-size: var(--font-size-sm); color: var(--color-text); }
  .tracking-subtitle { display: block; font-size: var(--font-size-xs); color: var(--color-text-muted); }
  .tracking-value { font-size: var(--font-size-lg); font-weight: 700; color: var(--color-primary); }

  /* Filter Bar */
  .filter-bar {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-md);
    background: var(--color-surface);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    margin-bottom: var(--space-lg);
    flex-wrap: wrap;
  }

  .filter-group { display: flex; align-items: center; gap: var(--space-sm); }
  .filter-label { font-size: var(--font-size-sm); font-weight: 500; color: var(--color-text-secondary); }
  .filter-select { min-width: 120px; padding: var(--space-xs) var(--space-sm); font-size: var(--font-size-sm); }
  .filter-search { flex: 1; min-width: 200px; position: relative; }
  .filter-search .search-icon { position: absolute; left: var(--space-sm); top: 50%; transform: translateY(-50%); width: 16px; height: 16px; color: var(--color-text-muted); }
  .filter-search .search-input { padding-left: 36px; width: 100%; }

  /* Solution Picker */
  .solution-picker-group { position: relative; }
  .solution-picker-btn { display: flex; align-items: center; gap: var(--space-xs); min-width: 160px; justify-content: space-between; }
  .solution-picker-btn .picker-chevron { width: 14px; height: 14px; transition: transform var(--transition-fast); }
  .solution-picker-btn.active .picker-chevron { transform: rotate(180deg); }

  .solution-picker-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 100;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    min-width: 280px;
    max-height: 400px;
    overflow-y: auto;
    display: none;
    margin-top: var(--space-xs);
  }

  .solution-picker-dropdown.active { display: block; }

  .picker-actions {
    display: flex;
    gap: var(--space-xs);
    padding: var(--space-sm);
    border-bottom: 1px solid var(--color-border-light);
    background: var(--color-surface-alt);
    position: sticky;
    top: 0;
  }

  .picker-action-btn {
    flex: 1;
    padding: var(--space-xs) var(--space-sm);
    font-size: var(--font-size-xs);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .picker-action-btn:hover { background: var(--color-primary); color: white; border-color: var(--color-primary); }

  .picker-section { padding: var(--space-xs) 0; }

  .picker-section-header {
    padding: var(--space-xs) var(--space-sm);
    font-size: var(--font-size-xs);
    font-weight: 600;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    background: var(--color-surface-alt);
    border-bottom: 1px solid var(--color-border-light);
  }

  .picker-list { display: flex; flex-direction: column; }

  .picker-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-xs) var(--space-sm);
    cursor: pointer;
    transition: background var(--transition-fast);
  }

  .picker-item:hover { background: var(--color-surface-alt); }

  .picker-item input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
    accent-color: var(--color-primary);
  }

  .picker-item-label {
    flex: 1;
    font-size: var(--font-size-sm);
    color: var(--color-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .picker-item-cycle {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    padding: 1px 6px;
    background: var(--color-surface-alt);
    border-radius: 10px;
  }

  /* Cycle Sections */
  .cycle-section { margin-bottom: var(--space-lg); }

  .cycle-header {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    padding: var(--space-sm) var(--space-md);
    background: var(--color-surface);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    cursor: pointer;
    margin-bottom: var(--space-md);
    transition: background var(--transition-fast);
  }

  .cycle-header:hover { background: var(--color-surface-alt); }
  .cycle-header .chevron { width: 20px; height: 20px; transition: transform var(--transition-fast); }
  .cycle-header.collapsed .chevron { transform: rotate(-90deg); }
  .cycle-badge { padding: 4px 10px; font-size: var(--font-size-sm); font-weight: 700; border-radius: var(--radius-sm); }
  .badge-c1 { background: #fee2e2; color: #991b1b; }
  .badge-c2 { background: #fef3c7; color: #92400e; }
  .badge-c3 { background: #d1fae5; color: #065f46; }
  .badge-c4 { background: #dbeafe; color: #1e40af; }
  .badge-c5 { background: #e0e7ff; color: #3730a3; }
  .badge-c6 { background: #f3e8ff; color: #6b21a8; border: 1px dashed #6b21a8; }
  .cycle-title { font-size: var(--font-size-lg); font-weight: 600; color: var(--color-text); }
  .cycle-count { font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-left: auto; }
  .cycle-solutions { display: grid; grid-template-columns: repeat(auto-fill, minmax(380px, 1fr)); gap: var(--space-md); }
  .cycle-solutions.collapsed { display: none; }

  /* Solution Cards */
  .solution-card {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    padding: var(--space-md);
    display: flex;
    flex-direction: column;
    transition: box-shadow var(--transition-fast), transform var(--transition-fast);
    border-left: 4px solid var(--color-border);
  }

  .solution-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
  .solution-card.phase-operational { border-left-color: #10b981; }
  .solution-card.phase-implementation { border-left-color: #3b82f6; }
  .solution-card.phase-formulation { border-left-color: #f97316; }
  .solution-card.phase-pre-formulation { border-left-color: #eab308; }

  .solution-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-sm); }
  .solution-name { font-weight: 600; font-size: var(--font-size-md); color: var(--color-text); cursor: pointer; }
  .solution-name:hover { color: var(--color-implementation); }
  .solution-id { font-size: var(--font-size-xs); color: var(--color-text-muted); font-family: monospace; }

  .solution-badges { display: flex; gap: var(--space-xs); flex-wrap: wrap; }
  .phase-badge { padding: 2px 8px; font-size: var(--font-size-xs); font-weight: 500; border-radius: 12px; white-space: nowrap; }
  .phase-pre-formulation { background: #fef9c3; color: #a16207; }
  .phase-formulation { background: #ffedd5; color: #c2410c; }
  .phase-implementation { background: #dbeafe; color: #1d4ed8; }
  .phase-operational { background: #dcfce7; color: #15803d; }
  .phase-completed { background: #f1f5f9; color: #475569; }

  .solution-meta { display: flex; gap: var(--space-md); font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--space-sm); flex-wrap: wrap; }
  .solution-meta-item { display: flex; align-items: center; gap: var(--space-xs); }
  .solution-meta-item svg { width: 14px; height: 14px; }

  .solution-lead { font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--space-sm); }
  .solution-lead strong { color: var(--color-text); }

  .solution-tracking {
    display: flex;
    gap: var(--space-sm);
    flex-wrap: wrap;
    margin-bottom: var(--space-sm);
  }

  .tracking-tag {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--font-size-xs);
    padding: 2px 8px;
    border-radius: var(--radius-sm);
    background: var(--color-surface-alt);
  }

  .tracking-tag svg { width: 12px; height: 12px; }
  .tracking-tag.tag-daac { background: rgba(139, 92, 246, 0.1); color: #7c3aed; }
  .tracking-tag.tag-milestone { background: rgba(16, 185, 129, 0.1); color: #059669; }
  .tracking-tag.tag-deepdive { background: rgba(59, 130, 246, 0.1); color: #2563eb; }

  .solution-status { font-size: var(--font-size-sm); color: var(--color-text-secondary); flex: 1; margin-bottom: var(--space-sm); line-height: 1.4; max-height: 3.6em; overflow: hidden; }

  .solution-actions { display: flex; gap: var(--space-sm); margin-top: auto; padding-top: var(--space-sm); border-top: 1px solid var(--color-border-light); flex-wrap: wrap; }
  .solution-action-btn { display: flex; align-items: center; gap: var(--space-xs); padding: var(--space-xs) var(--space-sm); font-size: var(--font-size-xs); color: var(--color-text-secondary); background: var(--color-surface-alt); border-radius: var(--radius-sm); cursor: pointer; transition: all var(--transition-fast); text-decoration: none; border: none; }
  .solution-action-btn:hover { background: var(--color-primary); color: white; }
  .solution-action-btn svg { width: 14px; height: 14px; }

  /* Modal */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: var(--space-md);
  }

  .modal-overlay.active { display: flex; }

  .modal-content {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    max-width: 800px;
    width: 100%;
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-md) var(--space-lg);
    border-bottom: 1px solid var(--color-border-light);
    background: var(--color-surface-alt);
  }

  .modal-title { font-size: var(--font-size-lg); font-weight: 600; color: var(--color-text); margin: 0; }
  .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-text-muted); padding: 0; line-height: 1; }
  .modal-close:hover { color: var(--color-text); }
  .modal-body { padding: var(--space-lg); overflow-y: auto; }

  .detail-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-lg);
  }

  .detail-section { margin-bottom: var(--space-md); }
  .detail-section:last-child { margin-bottom: 0; }
  .detail-section-title { font-size: var(--font-size-sm); font-weight: 600; color: var(--color-text-secondary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-sm); border-bottom: 1px solid var(--color-border-light); padding-bottom: var(--space-xs); }
  .detail-row { display: flex; justify-content: space-between; padding: var(--space-xs) 0; font-size: var(--font-size-sm); }
  .detail-label { color: var(--color-text-secondary); }
  .detail-value { color: var(--color-text); font-weight: 500; text-align: right; }
  .detail-text { font-size: var(--font-size-sm); color: var(--color-text); line-height: 1.6; }

  .empty-state { text-align: center; padding: var(--space-xxl); color: var(--color-text-muted); }
  .empty-state svg { width: 48px; height: 48px; margin-bottom: var(--space-md); opacity: 0.5; }

  /* Stakeholder Styles */
  .stakeholder-summary {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
    margin-bottom: var(--space-md);
  }

  .stakeholder-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-sm) var(--space-md);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    min-width: 80px;
  }

  .stakeholder-stat .stat-number {
    font-size: var(--font-size-lg);
    font-weight: 700;
    color: var(--color-primary);
  }

  .stakeholder-stat .stat-label {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    text-align: center;
  }

  .sme-list, .dept-list {
    font-size: var(--font-size-sm);
    color: var(--color-text);
    margin-bottom: var(--space-sm);
    line-height: 1.6;
  }

  .sme-link {
    color: var(--color-primary);
    text-decoration: none;
  }

  .sme-link:hover {
    text-decoration: underline;
  }

  .empty-stakeholders {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    font-style: italic;
    padding: var(--space-md);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    text-align: center;
  }

  /* Updates Styles */
  .updates-summary {
    display: flex;
    gap: var(--space-md);
    align-items: center;
    margin-bottom: var(--space-md);
    font-size: var(--font-size-sm);
  }

  .updates-count {
    color: var(--color-text-secondary);
  }

  .updates-recent-badge {
    background: var(--color-primary);
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: var(--font-size-xs);
    font-weight: 500;
  }

  .updates-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .updates-extended.collapsed {
    display: none;
  }

  .update-item {
    display: grid;
    grid-template-columns: 90px 1fr;
    gap: var(--space-sm);
    padding: var(--space-sm);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    border-left: 3px solid var(--color-primary);
    font-size: var(--font-size-sm);
  }

  .update-date {
    color: var(--color-text-secondary);
    font-weight: 500;
    font-size: var(--font-size-xs);
  }

  .update-content {
    color: var(--color-text-primary);
    line-height: 1.5;
  }

  .update-source {
    grid-column: 1 / -1;
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    margin-top: var(--space-xs);
    padding-top: var(--space-xs);
    border-top: 1px solid var(--color-border);
  }

  .updates-see-more-btn {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    background: none;
    border: 1px dashed var(--color-border);
    color: var(--color-primary);
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-size: var(--font-size-sm);
    width: 100%;
    justify-content: center;
    margin: var(--space-md) 0;
    transition: all 0.2s;
  }

  .updates-see-more-btn:hover {
    background: var(--color-surface-alt);
    border-color: var(--color-primary);
  }

  .updates-see-more-btn .see-more-icon {
    width: 16px;
    height: 16px;
    transition: transform 0.2s;
  }

  .updates-empty-recent {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    font-style: italic;
    padding: var(--space-md);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    text-align: center;
  }

  .empty-updates {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    font-style: italic;
    padding: var(--space-md);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    text-align: center;
  }

  .updates-historical-note {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-top: var(--space-md);
    padding: var(--space-sm) var(--space-md);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
  }

  .updates-historical-note svg {
    width: 14px;
    height: 14px;
    opacity: 0.7;
  }

  .updates-historical-note a {
    color: var(--color-primary);
    text-decoration: none;
  }

  .updates-historical-note a:hover {
    text-decoration: underline;
  }

  /* Status Summary Collapsible Styles */
  .status-summary-wrapper {
    position: relative;
  }

  .status-full.collapsed {
    display: none;
  }

  .status-see-more-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    background: none;
    border: none;
    color: var(--color-primary);
    padding: var(--space-xs) 0;
    cursor: pointer;
    font-size: var(--font-size-sm);
    margin-top: var(--space-xs);
  }

  .status-see-more-btn:hover {
    text-decoration: underline;
  }

  .status-see-more-btn .see-more-icon {
    width: 14px;
    height: 14px;
  }

  /* Milestone Styles */
  .milestone-summary {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
    margin-bottom: var(--space-md);
  }

  .milestone-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-sm) var(--space-md);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    min-width: 80px;
  }

  .milestone-stat .stat-number {
    font-size: var(--font-size-lg);
    font-weight: 700;
    color: var(--color-success);
  }

  .milestone-stat .stat-label {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    text-align: center;
  }

  .milestone-stat.milestone-overdue .stat-number {
    color: var(--color-error);
  }

  .next-milestone {
    font-size: var(--font-size-sm);
    padding: var(--space-sm) var(--space-md);
    background: rgba(59, 130, 246, 0.1);
    border-left: 3px solid var(--color-primary);
    border-radius: var(--radius-sm);
    margin-bottom: var(--space-md);
  }

  .milestone-date {
    color: var(--color-text-secondary);
    font-size: var(--font-size-xs);
  }

  .milestone-timeline {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .milestone-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
  }

  .milestone-item .milestone-icon {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  .milestone-item .milestone-type {
    flex: 1;
  }

  .milestone-item.milestone-completed {
    color: var(--color-success);
    background: rgba(16, 185, 129, 0.05);
  }

  .milestone-item.milestone-planned {
    color: var(--color-primary);
    background: rgba(59, 130, 246, 0.05);
  }

  .milestone-item.milestone-not_started {
    color: var(--color-text-muted);
    background: var(--color-surface-alt);
  }

  .empty-milestones {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    font-style: italic;
    padding: var(--space-md);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    text-align: center;
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .dashboard-top-row { grid-template-columns: 1fr 1fr; }
    .docs-panel { grid-column: span 2; }
    .tracking-summary-row { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 768px) {
    .page-header { flex-direction: column; gap: var(--space-md); }
    .page-actions { width: 100%; }
    .page-actions .btn { flex: 1; }
    .dashboard-top-row { grid-template-columns: 1fr; }
    .docs-panel { grid-column: span 1; }
    .stats-grid-compact { grid-template-columns: repeat(2, 1fr); }
    .tracking-summary-row { grid-template-columns: 1fr; }
    .filter-bar { flex-direction: column; align-items: stretch; }
    .filter-group { justify-content: space-between; }
    .cycle-solutions { grid-template-columns: 1fr; }
    .detail-grid { grid-template-columns: 1fr; }
  }
</style>

<!-- Implementation-NSITE JavaScript -->
<script>
var Implementation = (function() {
  var state = {
    solutions: [],
    filteredSolutions: [],
    groups: [],
    daacs: [],
    collapsedCycles: {},
    selectedSolutions: {} // Track which solutions are selected by solution_id
  };

  /**
   * Check if solution should be shown in default selection.
   * Uses the 'show_in_default' column from MO-DB_Solutions.
   * Values: 'Y' or 'y' = show in default, anything else = don't show
   */
  function isActivelyManaged(sol) {
    var value = (sol.show_in_default || '').toString().trim().toUpperCase();
    return value === 'Y';
  }

  function init() {
    console.log('Implementation.init() called');
    loadSolutions();
  }

  function loadSolutions() {
    console.log('loadSolutions() starting...');
    google.script.run
      .withSuccessHandler(function(solutions) {
        console.log('SUCCESS: Received solutions:', solutions ? solutions.length : 'null/undefined');
        state.solutions = solutions || [];
        extractFilters();
        updateStats();
        updateMilestones();
        updateTrackingStats();
        applyFilters();
      })
      .withFailureHandler(function(error) {
        console.error('FAILURE: Failed to load solutions:', error);
        showError('Failed to load solutions. Please try again.');
      })
      .getSolutions();
  }

  function extractFilters() {
    var groups = {}, daacs = {};
    state.solutions.forEach(function(sol) {
      if (sol.solution_group && sol.solution_group.trim()) {
        groups[sol.solution_group.trim()] = true;
      }
      if (sol.daac_assignment && sol.daac_assignment.trim()) {
        daacs[sol.daac_assignment.trim()] = true;
      }
    });
    state.groups = Object.keys(groups).sort();
    state.daacs = Object.keys(daacs).sort();
    populateFilterDropdowns();
    populateSolutionPicker();
    // Select actively managed by default
    selectActiveSolutions();
  }

  function populateFilterDropdowns() {
    // Groups
    var groupSelect = document.getElementById('filterGroup');
    groupSelect.innerHTML = '<option value="">All Groups</option>';
    state.groups.forEach(function(group) {
      var option = document.createElement('option');
      option.value = group;
      option.textContent = group;
      groupSelect.appendChild(option);
    });

    // DAACs
    var daacSelect = document.getElementById('filterDAAC');
    daacSelect.innerHTML = '<option value="">All DAACs</option>';
    state.daacs.forEach(function(daac) {
      var option = document.createElement('option');
      option.value = daac;
      option.textContent = daac;
      daacSelect.appendChild(option);
    });
  }

  function populateSolutionPicker() {
    var activeList = document.getElementById('activePickerList');
    var otherList = document.getElementById('otherPickerList');
    activeList.innerHTML = '';
    otherList.innerHTML = '';

    // Sort solutions by name
    var sortedSolutions = state.solutions.slice().sort(function(a, b) {
      return (a.name || a.solution_id).localeCompare(b.name || b.solution_id);
    });

    sortedSolutions.forEach(function(sol) {
      var isActive = isActivelyManaged(sol);
      var html = '<label class="picker-item">';
      html += '<input type="checkbox" id="picker_' + sol.solution_id + '" onchange="Implementation.onSolutionToggle(\'' + sol.solution_id + '\')">';
      html += '<span class="picker-item-label">' + escapeHtml(sol.name || sol.solution_id) + '</span>';
      html += '<span class="picker-item-cycle">C' + sol.cycle + '</span>';
      html += '</label>';

      if (isActive) {
        activeList.innerHTML += html;
      } else {
        otherList.innerHTML += html;
      }
    });
  }

  function toggleSolutionPicker() {
    var dropdown = document.getElementById('solutionPickerDropdown');
    var btn = document.getElementById('solutionPickerBtn');
    dropdown.classList.toggle('active');
    btn.classList.toggle('active');
  }

  function closeSolutionPicker() {
    document.getElementById('solutionPickerDropdown').classList.remove('active');
    document.getElementById('solutionPickerBtn').classList.remove('active');
  }

  function onSolutionToggle(solutionId) {
    var checkbox = document.getElementById('picker_' + solutionId);
    state.selectedSolutions[solutionId] = checkbox.checked;
    updatePickerLabel();
    applyFilters();
  }

  function selectActiveSolutions() {
    state.selectedSolutions = {};
    state.solutions.forEach(function(sol) {
      var checkbox = document.getElementById('picker_' + sol.solution_id);
      if (checkbox) {
        var isActive = isActivelyManaged(sol);
        checkbox.checked = isActive;
        state.selectedSolutions[sol.solution_id] = isActive;
      }
    });
    updatePickerLabel();
    applyFilters();
  }

  function selectAllSolutions() {
    state.selectedSolutions = {};
    state.solutions.forEach(function(sol) {
      var checkbox = document.getElementById('picker_' + sol.solution_id);
      if (checkbox) {
        checkbox.checked = true;
        state.selectedSolutions[sol.solution_id] = true;
      }
    });
    updatePickerLabel();
    applyFilters();
  }

  function clearSolutionSelection() {
    state.selectedSolutions = {};
    state.solutions.forEach(function(sol) {
      var checkbox = document.getElementById('picker_' + sol.solution_id);
      if (checkbox) {
        checkbox.checked = false;
      }
    });
    updatePickerLabel();
    applyFilters();
  }

  function updatePickerLabel() {
    var count = Object.keys(state.selectedSolutions).filter(function(k) {
      return state.selectedSolutions[k];
    }).length;
    var total = state.solutions.length;
    var label = document.getElementById('solutionPickerLabel');
    if (count === 0) {
      label.textContent = 'None selected';
    } else if (count === total) {
      label.textContent = 'All (' + total + ')';
    } else {
      label.textContent = count + ' of ' + total + ' selected';
    }
  }

  function updateStats() {
    // Calculate stats based on filtered solutions (current view)
    var total = state.filteredSolutions.length;
    var operational = 0, implementation = 0, formulation = 0;

    state.filteredSolutions.forEach(function(sol) {
      var phase = (sol.phase || '').toLowerCase();
      if (phase.indexOf('operational') !== -1 || phase.indexOf('production') !== -1) operational++;
      else if (phase.indexOf('implementation') !== -1) implementation++;
      else if (phase.indexOf('formulation') !== -1) formulation++;
    });

    document.getElementById('statTotalSolutions').textContent = total;
    document.getElementById('statOperational').textContent = operational;
    document.getElementById('statImplementation').textContent = implementation;
    document.getElementById('statFormulation').textContent = formulation;
  }

  function updateMilestones() {
    // Count completed milestones from solution data (date in the past = completed)
    var today = new Date();
    today.setHours(0, 0, 0, 0);
    var counts = { ATP: 0, F2I: 0, ORR: 0, Closeout: 0 };

    state.filteredSolutions.forEach(function(sol) {
      if (isDateCompleted(sol.atp_date, today)) counts.ATP++;
      if (isDateCompleted(sol.f2i_date, today)) counts.F2I++;
      if (isDateCompleted(sol.orr_date, today)) counts.ORR++;
      if (isDateCompleted(sol.closeout_date, today)) counts.Closeout++;
    });

    document.getElementById('countATP').textContent = counts.ATP;
    document.getElementById('countF2I').textContent = counts.F2I;
    document.getElementById('countORR').textContent = counts.ORR;
    document.getElementById('countCloseout').textContent = counts.Closeout;
  }

  function isDateCompleted(dateVal, today) {
    if (!dateVal) return false;
    var d = parseDate(dateVal);
    return d && d < today;
  }

  function parseDate(dateVal) {
    if (!dateVal) return null;
    if (dateVal instanceof Date) return dateVal;
    var str = String(dateVal).trim();
    if (!str) return null;
    var d = new Date(str);
    return isNaN(d.getTime()) ? null : d;
  }

  function getMilestoneStatus(dateVal) {
    if (!dateVal) return 'not_started';
    var d = parseDate(dateVal);
    if (!d) return 'not_started';
    var today = new Date();
    today.setHours(0, 0, 0, 0);
    return d < today ? 'completed' : 'planned';
  }

  function getDocStatus(val) {
    if (!val) return 'not_started';
    var str = String(val).trim().toLowerCase();
    if (!str || str === 'nan') return 'not_started';
    // Check if it's a date (completed)
    var d = parseDate(val);
    if (d) return 'complete';
    // Check for in_work variations
    if (str.indexOf('in_work') !== -1 || str.indexOf('in work') !== -1 || str.indexOf('in-work') !== -1) {
      return 'in_work';
    }
    // Any other text = in progress
    if (str.length > 0) return 'in_work';
    return 'not_started';
  }

  function updateDocuments() {
    // Count document statuses across filtered solutions
    var docs = {
      project_plan: { complete: 0, in_work: 0, not_started: 0 },
      science_sow: { complete: 0, in_work: 0, not_started: 0 },
      ipa: { complete: 0, in_work: 0, not_started: 0 },
      icd: { complete: 0, in_work: 0, not_started: 0 },
      tta: { complete: 0, in_work: 0, not_started: 0 }
    };

    state.filteredSolutions.forEach(function(sol) {
      var ppStatus = getDocStatus(sol.project_plan);
      var sowStatus = getDocStatus(sol.science_sow);
      var ipaStatus = getDocStatus(sol.ipa);
      var icdStatus = getDocStatus(sol.icd);
      var ttaStatus = getDocStatus(sol.tta);

      docs.project_plan[ppStatus]++;
      docs.science_sow[sowStatus]++;
      docs.ipa[ipaStatus]++;
      docs.icd[icdStatus]++;
      docs.tta[ttaStatus]++;
    });

    // Update UI - show counts as "X / Y / Z" (complete / in_work / not_started)
    updateDocElement('docProjectPlan', docs.project_plan);
    updateDocElement('docScienceSow', docs.science_sow);
    updateDocElement('docIpa', docs.ipa);
    updateDocElement('docIcd', docs.icd);
    updateDocElement('docTta', docs.tta);
  }

  function updateDocElement(elementId, counts) {
    var el = document.getElementById(elementId);
    if (!el) return;

    var total = counts.complete + counts.in_work + counts.not_started;
    if (total === 0) {
      el.textContent = '--';
      el.className = 'doc-status';
      return;
    }

    // Show as "complete / in_work"
    el.textContent = counts.complete + ' / ' + counts.in_work;

    // Color based on majority status
    if (counts.in_work > 0) {
      el.className = 'doc-status status-in-work';
    } else if (counts.complete > 0) {
      el.className = 'doc-status status-complete';
    } else {
      el.className = 'doc-status status-not-started';
    }
  }

  function renderDocStatusRow(label, value) {
    var status = getDocStatus(value);
    var statusText = '--';
    var statusClass = '';

    if (status === 'complete') {
      var d = parseDate(value);
      statusText = d ? formatDateDisplay(value) : 'Complete';
      statusClass = 'doc-badge-complete';
    } else if (status === 'in_work') {
      statusText = 'In Progress';
      statusClass = 'doc-badge-in-work';
    } else {
      statusText = '--';
      statusClass = 'doc-badge-not-started';
    }

    return '<div class="doc-status-row">' +
      '<span class="doc-status-label">' + escapeHtml(label) + '</span>' +
      '<span class="doc-badge ' + statusClass + '">' + statusText + '</span>' +
      '</div>';
  }

  function updateTrackingStats() {
    // Calculate based on filtered solutions (current view)
    var daacCount = 0;
    var total = state.filteredSolutions.length;

    state.filteredSolutions.forEach(function(sol) {
      if (sol.daac_assignment && sol.daac_assignment.trim()) daacCount++;
    });

    document.getElementById('statDAAC').textContent = daacCount + '/' + total;
    document.getElementById('statDeepDives').textContent = 'TBD';
    document.getElementById('statActions').textContent = 'TBD';

    // Load stakeholder stats from contacts database
    google.script.run
      .withSuccessHandler(function(stats) {
        if (stats) {
          document.getElementById('statStakeholders').textContent = stats.unique_contacts || 0;
        } else {
          document.getElementById('statStakeholders').textContent = '0';
        }
      })
      .withFailureHandler(function(error) {
        console.error('Failed to load contact stats:', error);
        document.getElementById('statStakeholders').textContent = '--';
      })
      .getContactStats();
  }

  function applyFilters() {
    var cycleFilter = document.getElementById('filterCycle').value;
    var phaseFilter = document.getElementById('filterPhase').value;
    var groupFilter = document.getElementById('filterGroup').value;
    var daacFilter = document.getElementById('filterDAAC').value;
    var searchFilter = document.getElementById('filterSearch').value.toLowerCase().trim();

    state.filteredSolutions = state.solutions.filter(function(sol) {
      // Solution picker filter - only show selected solutions
      if (!state.selectedSolutions[sol.solution_id]) return false;
      if (cycleFilter && String(sol.cycle) !== cycleFilter) return false;
      if (phaseFilter && sol.phase !== phaseFilter) return false;
      if (groupFilter && sol.solution_group !== groupFilter) return false;
      if (daacFilter && sol.daac_assignment !== daacFilter) return false;
      if (searchFilter) {
        var searchable = [sol.solution_id, sol.name, sol.full_title, sol.solution_lead, sol.solution_group, sol.purpose_mission, sol.daac_assignment].join(' ').toLowerCase();
        if (searchable.indexOf(searchFilter) === -1) return false;
      }
      return true;
    });
    updateStats(); // Update stats based on filtered view
    updateMilestones(); // Update milestones based on filtered view
    updateTrackingStats(); // Update tracking stats based on filtered view
    updateDocuments(); // Update document administration panel
    render();
  }

  function clearFilters() {
    document.getElementById('filterCycle').value = '';
    document.getElementById('filterPhase').value = '';
    document.getElementById('filterGroup').value = '';
    document.getElementById('filterDAAC').value = '';
    document.getElementById('filterSearch').value = '';
    selectActiveSolutions(); // Reset to actively managed
  }

  function render() {
    var container = document.getElementById('solutionsContainer');

    if (state.filteredSolutions.length === 0) {
      container.innerHTML = '<div class="empty-state"><span class="material-icons">inbox</span><p>No solutions match your filters</p></div>';
return;
    }

    var byCycle = {};
    state.filteredSolutions.forEach(function(sol) {
      var cycle = sol.cycle || 'Unknown';
      if (!byCycle[cycle]) byCycle[cycle] = [];
      byCycle[cycle].push(sol);
    });

    var cycles = Object.keys(byCycle).sort(function(a, b) { return parseInt(b) - parseInt(a); });
    var html = '';

    cycles.forEach(function(cycle) {
      var solutions = byCycle[cycle];
      var isCollapsed = state.collapsedCycles[cycle] || false;
      var cycleYear = getCycleYear(cycle);
      var isFuture = parseInt(cycle) >= 6;

      html += '<div class="cycle-section" data-cycle="' + cycle + '">';
      html += '<div class="cycle-header' + (isCollapsed ? ' collapsed' : '') + '" onclick="Implementation.toggleCycle(\'' + cycle + '\')">';
      html += '<span class="material-icons">expand_more</span>';
      html += '<span class="cycle-badge badge-c' + cycle + '">C' + cycle + '</span>';
      html += '<span class="cycle-title">Cycle ' + cycle + (cycleYear ? ' (' + cycleYear + ')' : '') + (isFuture ? ' - Assessment' : '') + '</span>';
      html += '<span class="cycle-count">' + solutions.length + ' solution' + (solutions.length !== 1 ? 's' : '') + '</span>';
      html += '</div>';
      html += '<div class="cycle-solutions' + (isCollapsed ? ' collapsed' : '') + '">';
      solutions.forEach(function(sol) { html += renderSolutionCard(sol); });
      html += '</div></div>';
    });

    container.innerHTML = html;
}

  function renderSolutionCard(sol) {
    var phaseClass = getPhaseClass(sol.phase);
    var cardClass = 'solution-card ' + phaseClass;
    var statusSummary = truncateText(sol.status_summary, 120);

    var html = '<div class="' + cardClass + '">';

    // Header
    html += '<div class="solution-card-header"><div>';
    html += '<div class="solution-name" onclick="Implementation.showDetail(\'' + sol.solution_id + '\')">' + escapeHtml(sol.name || sol.solution_id) + '</div>';
    html += '<div class="solution-id">' + escapeHtml(sol.solution_id) + '</div>';
    html += '</div><div class="solution-badges">';
    html += '<span class="phase-badge ' + phaseClass + '">' + escapeHtml(sol.phase || 'Unknown') + '</span>';
    html += '</div></div>';

    // Meta info
    html += '<div class="solution-meta">';
    if (sol.solution_group) html += '<span class="solution-meta-item"><span class="material-icons">folder</span>' + escapeHtml(sol.solution_group) + '</span>';
    if (sol.funded_by_ison === 'Y') html += '<span class="solution-meta-item"><span class="material-icons">attach_money</span>ISON</span>';
    html += '</div>';

    // Lead
    if (sol.solution_lead) {
      html += '<div class="solution-lead"><strong>Lead:</strong> ' + escapeHtml(sol.solution_lead);
      if (sol.solution_lead_affiliation) html += ' <span style="opacity:0.7">(' + escapeHtml(truncateText(sol.solution_lead_affiliation, 30)) + ')</span>';
      html += '</div>';
    }

    // Tracking tags
    html += '<div class="solution-tracking">';
    if (sol.daac_assignment) html += '<span class="tracking-tag tag-daac"><span class="material-icons">storage</span>' + escapeHtml(sol.daac_assignment) + '</span>';
    if (sol.phase && sol.phase.toLowerCase().indexOf('operational') !== -1) {
      html += '<span class="tracking-tag tag-milestone"><span class="material-icons">check_circle</span>OPS</span>';
    } else if (sol.phase && sol.phase.toLowerCase().indexOf('implementation') !== -1) {
      html += '<span class="tracking-tag tag-milestone"><span class="material-icons">play_circle</span>F2I</span>';
    }
    html += '</div>';

    // Status
    if (statusSummary) html += '<div class="solution-status">' + escapeHtml(statusSummary) + '</div>';

    // Actions
    html += '<div class="solution-actions">';
    if (sol.drive_folder_url) html += '<a href="' + escapeHtml(sol.drive_folder_url) + '" target="_blank" class="solution-action-btn"><span class="material-icons">folder</span>Drive</a>';
    if (sol.snwg_solution_page_url) html += '<a href="' + escapeHtml(sol.snwg_solution_page_url) + '" target="_blank" class="solution-action-btn"><span class="material-icons">open_in_new</span>Earthdata</a>';
    if (sol.project_plan_url) html += '<a href="' + escapeHtml(sol.project_plan_url) + '" target="_blank" class="solution-action-btn"><span class="material-icons">description</span>Plan</a>';
    html += '<button class="solution-action-btn" onclick="Implementation.showDetail(\'' + sol.solution_id + '\')"><span class="material-icons">info</span>Details</button>';
    html += '</div></div>';

    return html;
  }

  function toggleCycle(cycle) {
    state.collapsedCycles[cycle] = !state.collapsedCycles[cycle];
    var section = document.querySelector('.cycle-section[data-cycle="' + cycle + '"]');
    if (section) {
      var header = section.querySelector('.cycle-header');
      var solutions = section.querySelector('.cycle-solutions');
      if (state.collapsedCycles[cycle]) {
        header.classList.add('collapsed');
        solutions.classList.add('collapsed');
      } else {
        header.classList.remove('collapsed');
        solutions.classList.remove('collapsed');
      }
    }
  }

  function showDetail(solutionId) {
    var sol = state.solutions.find(function(s) { return s.solution_id === solutionId; });
    if (!sol) return;

    document.getElementById('modalTitle').textContent = sol.name || sol.solution_id;

    // Show loading state first
    document.getElementById('modalBody').innerHTML = '<div style="text-align:center;padding:40px;"><span class="loading-spinner"></span><p>Loading details...</p></div>';
    document.getElementById('solutionModal').classList.add('active');

    // Build milestone data from solution fields
    var milestoneData = buildMilestoneData(sol);

    // Track loading state for parallel requests
    var loadState = { stakeholders: null, updates: null, loaded: 0 };

    function checkAndRender() {
      loadState.loaded++;
      if (loadState.loaded === 2) {
        renderDetailModal(sol, loadState.stakeholders, milestoneData, loadState.updates);
      }
    }

    // Load stakeholder data
    google.script.run
      .withSuccessHandler(function(stakeholders) {
        loadState.stakeholders = stakeholders;
        checkAndRender();
      })
      .withFailureHandler(function(error) {
        console.error('Failed to load stakeholders:', error);
        loadState.stakeholders = null;
        checkAndRender();
      })
      .getSolutionStakeholderSummary(sol.name || sol.full_title);

    // Load updates data
    google.script.run
      .withSuccessHandler(function(updates) {
        loadState.updates = updates;
        checkAndRender();
      })
      .withFailureHandler(function(error) {
        console.error('Failed to load updates:', error);
        loadState.updates = null;
        checkAndRender();
      })
      .getUpdatesForSolutionCard(sol.name || sol.full_title);
  }

  function buildMilestoneData(sol) {
    var milestones = [];
    var completed = 0, planned = 0;

    // ATP
    if (sol.atp_date) {
      var status = getMilestoneStatus(sol.atp_date);
      milestones.push({ type: 'ATP DG', date: formatDateDisplay(sol.atp_date), status: status });
      if (status === 'completed') completed++; else if (status === 'planned') planned++;
    }

    // F2I
    if (sol.f2i_date) {
      var status = getMilestoneStatus(sol.f2i_date);
      milestones.push({ type: 'F2I DG', date: formatDateDisplay(sol.f2i_date), status: status });
      if (status === 'completed') completed++; else if (status === 'planned') planned++;
    }

    // ORR
    if (sol.orr_date) {
      var status = getMilestoneStatus(sol.orr_date);
      milestones.push({ type: 'ORR', date: formatDateDisplay(sol.orr_date), status: status });
      if (status === 'completed') completed++; else if (status === 'planned') planned++;
    }

    // Closeout
    if (sol.closeout_date) {
      var status = getMilestoneStatus(sol.closeout_date);
      milestones.push({ type: 'Closeout DG', date: formatDateDisplay(sol.closeout_date), status: status });
      if (status === 'completed') completed++; else if (status === 'planned') planned++;
    }

    // Find next milestone (first planned one)
    var nextMilestone = milestones.find(function(m) { return m.status === 'planned'; });

    return {
      milestones: milestones,
      completed: completed,
      planned: planned,
      next_milestone: nextMilestone ? { type: nextMilestone.type, target_date: nextMilestone.date } : null
    };
  }

  function formatDateDisplay(dateVal) {
    var d = parseDate(dateVal);
    if (!d) return '';
    return d.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
  }

  function renderDetailModal(sol, stakeholders, milestones, updates) {
    var html = '<div class="detail-grid">';

    // Left column - Identity & Status
    html += '<div>';

    html += '<div class="detail-section">';
    html += '<div class="detail-section-title">Identity</div>';
    html += '<div class="detail-row"><span class="detail-label">Solution ID</span><span class="detail-value">' + escapeHtml(sol.solution_id) + '</span></div>';
    html += '<div class="detail-row"><span class="detail-label">Full Title</span><span class="detail-value">' + escapeHtml(sol.full_title || '-') + '</span></div>';
    html += '<div class="detail-row"><span class="detail-label">Group</span><span class="detail-value">' + escapeHtml(sol.solution_group || '-') + '</span></div>';
    html += '</div>';

    html += '<div class="detail-section">';
    html += '<div class="detail-section-title">Lifecycle</div>';
    html += '<div class="detail-row"><span class="detail-label">Cycle</span><span class="detail-value">C' + sol.cycle + ' (' + getCycleYear(sol.cycle) + ')</span></div>';
    html += '<div class="detail-row"><span class="detail-label">Phase</span><span class="detail-value">' + escapeHtml(sol.phase || '-') + '</span></div>';
    html += '<div class="detail-row"><span class="detail-label">Funding</span><span class="detail-value">' + (sol.funded_by_ison === 'Y' ? 'ISON Funded' : sol.funding_status || '-') + '</span></div>';
    html += '</div>';

    html += '<div class="detail-section">';
    html += '<div class="detail-section-title">Per-Solution Tracking</div>';
    html += '<div class="detail-row"><span class="detail-label">DAAC Assignment</span><span class="detail-value">' + escapeHtml(sol.daac_assignment || 'TBD') + '</span></div>';
    html += '<div class="detail-row"><span class="detail-label">Stakeholder List</span><span class="detail-value">' + (sol.stakeholder_list ? 'Linked' : 'Not linked') + '</span></div>';
    html += '</div>';

    html += '</div>';

    // Right column - Team & Content
    html += '<div>';

    html += '<div class="detail-section">';
    html += '<div class="detail-section-title">Team</div>';
    html += '<div class="detail-row"><span class="detail-label">Solution Lead</span><span class="detail-value">' + escapeHtml(sol.solution_lead || 'TBD') + '</span></div>';
    html += '<div class="detail-row"><span class="detail-label">Affiliation</span><span class="detail-value">' + escapeHtml(sol.solution_lead_affiliation || '-') + '</span></div>';
    html += '<div class="detail-row"><span class="detail-label">RA Representative</span><span class="detail-value">' + escapeHtml(sol.ra_representative || '-') + '</span></div>';
    html += '</div>';

    html += '<div class="detail-section">';
    html += '<div class="detail-section-title">Purpose</div>';
    html += '<div class="detail-text">' + escapeHtml(sol.purpose_mission || 'No description available.') + '</div>';
    html += '</div>';

    html += '<div class="detail-section">';
    html += '<div class="detail-section-title">Status Summary</div>';
    var statusText = sol.status_summary || 'No status update.';
    var statusCharLimit = 300;
    if (statusText.length > statusCharLimit) {
      var truncatedStatus = statusText.substring(0, statusCharLimit).trim();
      // Don't cut mid-word
      var lastSpace = truncatedStatus.lastIndexOf(' ');
      if (lastSpace > statusCharLimit - 50) {
        truncatedStatus = truncatedStatus.substring(0, lastSpace);
      }
      html += '<div class="status-summary-wrapper">';
      html += '<div class="detail-text status-truncated" id="statusTruncated">' + escapeHtml(truncatedStatus) + '...</div>';
      html += '<div class="detail-text status-full collapsed" id="statusFull">' + escapeHtml(statusText) + '</div>';
      html += '<button class="status-see-more-btn" onclick="Implementation.toggleStatusSummary()">';
      html += '<span class="material-icons">expand_more</span>';
      html += 'See more';
      html += '</button>';
      html += '</div>';
    } else {
      html += '<div class="detail-text">' + escapeHtml(statusText) + '</div>';
    }
    html += '</div>';

    html += '</div>';
    html += '</div>';

    // Documents section (full width)
    html += '<div class="detail-section" style="margin-top: var(--space-lg);">';
    html += '<div class="detail-section-title">Documentation Links</div>';
    html += '<div style="display: flex; flex-wrap: wrap; gap: var(--space-sm);">';
    if (sol.drive_folder_url) html += '<a href="' + escapeHtml(sol.drive_folder_url) + '" target="_blank" class="solution-action-btn"><span class="material-icons">folder</span>Drive Folder</a>';
    if (sol.snwg_solution_page_url) html += '<a href="' + escapeHtml(sol.snwg_solution_page_url) + '" target="_blank" class="solution-action-btn"><span class="material-icons">public</span>Earthdata Page</a>';
    if (sol.project_plan_url) html += '<a href="' + escapeHtml(sol.project_plan_url) + '" target="_blank" class="solution-action-btn"><span class="material-icons">description</span>Project Plan</a>';
    if (sol.science_sow_url) html += '<a href="' + escapeHtml(sol.science_sow_url) + '" target="_blank" class="solution-action-btn"><span class="material-icons">insert_drive_file</span>Science SOW</a>';
    if (sol.risk_register_url) html += '<a href="' + escapeHtml(sol.risk_register_url) + '" target="_blank" class="solution-action-btn"><span class="material-icons">warning</span>Risk Register</a>';
    if (sol.data_product_table_url) html += '<a href="' + escapeHtml(sol.data_product_table_url) + '" target="_blank" class="solution-action-btn"><span class="material-icons">table_chart</span>Data Products</a>';
    html += '</div></div>';

    // Document Status section
    html += '<div class="detail-section" style="margin-top: var(--space-lg);">';
    html += '<div class="detail-section-title">Document Status</div>';
    html += '<div class="doc-status-grid">';
    html += renderDocStatusRow('Project Plan', sol.project_plan);
    html += renderDocStatusRow('Science SOW', sol.science_sow);
    html += renderDocStatusRow('IPA', sol.ipa);
    html += renderDocStatusRow('ICD', sol.icd);
    html += renderDocStatusRow('TTA', sol.tta);
    html += renderDocStatusRow('ATP Memo', sol.atp_memo);
    html += renderDocStatusRow('F2I Memo', sol.f2i_memo);
    html += renderDocStatusRow('ORR Memo', sol.orr_memo);
    html += renderDocStatusRow('Closeout Memo', sol.closeout_memo);
    html += '</div></div>';

    // Milestones section
    html += '<div class="detail-section" style="margin-top: var(--space-lg);">';
    html += '<div class="detail-section-title">Milestones</div>';

    if (milestones && milestones.milestones && milestones.milestones.length > 0) {
      html += '<div class="milestone-summary">';
      html += '<div class="milestone-stat"><span class="stat-number">' + milestones.completed + '</span><span class="stat-label">Completed</span></div>';
      html += '<div class="milestone-stat"><span class="stat-number">' + milestones.planned + '</span><span class="stat-label">Planned</span></div>';
      if (milestones.overdue > 0) {
        html += '<div class="milestone-stat milestone-overdue"><span class="stat-number">' + milestones.overdue + '</span><span class="stat-label">Overdue</span></div>';
      }
      html += '</div>';

      // Next milestone
      if (milestones.next_milestone) {
        html += '<div class="next-milestone">';
        html += '<strong>Next:</strong> ' + escapeHtml(milestones.next_milestone.type);
        if (milestones.next_milestone.target_date) {
          html += ' <span class="milestone-date">(' + milestones.next_milestone.target_date + ')</span>';
        }
        html += '</div>';
      }

      // Milestone timeline
      html += '<div class="milestone-timeline">';
      milestones.milestones.forEach(function(m) {
        var statusClass = 'milestone-' + (m.status || 'not_started');
        var icon = m.status === 'completed' ? 'check-circle' : (m.status === 'planned' ? 'clock' : 'circle');
        html += '<div class="milestone-item ' + statusClass + '">';
        html += '<span class="material-icons">' + icon + '</span>';
        html += '<span class="milestone-type">' + escapeHtml(m.type) + '</span>';
        if (m.date) {
          html += '<span class="milestone-date">' + m.date + '</span>';
        }
        html += '</div>';
      });
      html += '</div>';
    } else {
      html += '<div class="empty-milestones">No milestone dates set for this solution.</div>';
    }
    html += '</div>';

    // Stakeholders section
    html += '<div class="detail-section" style="margin-top: var(--space-lg);">';
    html += '<div class="detail-section-title">Stakeholders</div>';

    if (stakeholders && stakeholders.total_contacts > 0) {
      html += '<div class="stakeholder-summary">';
      html += '<div class="stakeholder-stat"><span class="stat-number">' + stakeholders.total_contacts + '</span><span class="stat-label">Total Contacts</span></div>';

      // Role breakdown
      if (stakeholders.by_role) {
        var roles = Object.keys(stakeholders.by_role);
        roles.forEach(function(role) {
          html += '<div class="stakeholder-stat"><span class="stat-number">' + stakeholders.by_role[role] + '</span><span class="stat-label">' + role + '</span></div>';
        });
      }
      html += '</div>';

      // Primary SMEs
      if (stakeholders.primary_smes && stakeholders.primary_smes.length > 0) {
        html += '<div class="sme-list">';
        html += '<strong>Primary SMEs:</strong> ';
        var smeNames = stakeholders.primary_smes.map(function(sme) {
          return '<a href="mailto:' + escapeHtml(sme.email) + '" class="sme-link">' + escapeHtml(sme.name) + '</a>';
        });
        html += smeNames.join(', ');
        html += '</div>';
      }

      // Departments
      if (stakeholders.departments && stakeholders.departments.length > 0) {
        html += '<div class="dept-list">';
        html += '<strong>Agencies:</strong> ' + stakeholders.departments.slice(0, 5).map(escapeHtml).join(', ');
        if (stakeholders.departments.length > 5) {
          html += ' <span style="opacity:0.7">+' + (stakeholders.departments.length - 5) + ' more</span>';
        }
        html += '</div>';
      }
    } else {
      html += '<div class="empty-stakeholders">No stakeholder data available for this solution.</div>';
    }
    html += '</div>';

    // Updates section
    html += '<div class="detail-section" style="margin-top: var(--space-lg);">';
    html += '<div class="detail-section-title">Recent Updates</div>';

    if (updates && (updates.recent.length > 0 || updates.extended.length > 0)) {
      // Show total count
      html += '<div class="updates-summary">';
      html += '<span class="updates-count">' + updates.totalCount + ' total updates</span>';
      if (updates.recent.length > 0) {
        html += '<span class="updates-recent-badge">' + updates.recent.length + ' in last 30 days</span>';
      }
      html += '</div>';

      // Recent updates (shown by default)
      if (updates.recent.length > 0) {
        html += '<div class="updates-list" id="recentUpdates">';
        updates.recent.forEach(function(update) {
          html += renderUpdateItem(update);
        });
        html += '</div>';
      } else {
        html += '<div class="updates-empty-recent">No updates in the last 30 days.</div>';
      }

      // Extended updates (hidden by default, shown on "see more")
      if (updates.hasMore) {
        html += '<div class="updates-extended-section">';
        html += '<button class="updates-see-more-btn" onclick="Implementation.toggleExtendedUpdates()">';
        html += '<span class="material-icons">expand_more</span>';
        html += 'See more (' + updates.extended.length + ' updates from past 6 months)';
        html += '</button>';
        html += '<div class="updates-list updates-extended collapsed" id="extendedUpdates">';
        updates.extended.forEach(function(update) {
          html += renderUpdateItem(update);
        });
        html += '</div>';
        html += '</div>';
      }

      // Historical note
      if (updates.hasHistorical) {
        html += '<div class="updates-historical-note">';
        html += '<span class="material-icons">archive</span>';
        html += 'Full historical updates available in the <a href="' + Platform.baseUrl + '?page=reports">Historical Updates Report</a>.';
        html += '</div>';
      }
    } else {
      html += '<div class="empty-updates">No updates recorded for this solution.</div>';
    }
    html += '</div>';

    document.getElementById('modalBody').innerHTML = html;
}

  function renderUpdateItem(update) {
    var html = '<div class="update-item">';
    html += '<div class="update-date">';
    if (update.meeting_date) {
      var d = new Date(update.meeting_date);
      html += d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }
    html += '</div>';
    html += '<div class="update-content">';
    // Handle multiline updates (from children)
    var text = escapeHtml(update.update_text || '');
    text = text.replace(/\n/g, '<br>');
    html += text;
    html += '</div>';
    if (update.source_document) {
      html += '<div class="update-source">' + escapeHtml(update.source_document);
      if (update.source_tab) {
        html += ' (' + escapeHtml(update.source_tab) + ')';
      }
      html += '</div>';
    }
    html += '</div>';
    return html;
  }

  function toggleExtendedUpdates() {
    var extended = document.getElementById('extendedUpdates');
    var btn = document.querySelector('.updates-see-more-btn');
    if (extended && btn) {
      extended.classList.toggle('collapsed');
      var isCollapsed = extended.classList.contains('collapsed');
      var icon = btn.querySelector('.see-more-icon');
      if (icon) {
        icon.style.transform = isCollapsed ? 'rotate(0deg)' : 'rotate(180deg)';
      }
      btn.innerHTML = isCollapsed
        ? '<span class="material-icons">expand_more</span>See more (' + extended.children.length + ' updates from past 6 months)'
        : '<span class="material-icons">expand_less</span>Show less';
}
  }

  function toggleStatusSummary() {
    var truncated = document.getElementById('statusTruncated');
    var full = document.getElementById('statusFull');
    var btn = document.querySelector('.status-see-more-btn');
    if (truncated && full && btn) {
      var isExpanded = !full.classList.contains('collapsed');
      if (isExpanded) {
        // Collapse
        full.classList.add('collapsed');
        truncated.style.display = 'block';
        btn.innerHTML = '<span class="material-icons">expand_more</span>See more';
      } else {
        // Expand
        full.classList.remove('collapsed');
        truncated.style.display = 'none';
        btn.innerHTML = '<span class="material-icons">expand_less</span>Show less';
      }
}
  }

  function closeModal(event) {
    if (!event || event.target === document.getElementById('solutionModal')) {
      document.getElementById('solutionModal').classList.remove('active');
    }
  }

  function syncSolutions() { loadSolutions(); }

  function exportData() {
    // Export filtered solutions to CSV
    var columns = [
      { key: 'short_name', label: 'Short Name' },
      { key: 'solution_name', label: 'Solution Name' },
      { key: 'lifecycle_phase', label: 'Lifecycle Phase' },
      { key: 'solution_group', label: 'Solution Group' },
      { key: 'daac_assignment', label: 'DAAC Assignment' },
      { key: 'program_executive', label: 'Program Executive' },
      { key: 'solution_manager', label: 'Solution Manager' },
      { key: 'selection_cycle', label: 'Selection Cycle' },
      { key: 'description', label: 'Description' }
    ];

    var dataToExport = state.filteredSolutions.length > 0 ? state.filteredSolutions : state.solutions;
    exportToCSV(dataToExport, columns, 'solutions_export');
  }

  function getCycleYear(cycle) {
    var years = { '1': '2016', '2': '2018', '3': '2020', '4': '2022', '5': '2024', '6': '2026' };
    return years[String(cycle)] || '';
  }

  function getPhaseClass(phase) {
    if (!phase) return 'phase-unknown';
    var p = phase.toLowerCase();
    if (p.indexOf('pre-formulation') !== -1) return 'phase-pre-formulation';
    if (p.indexOf('formulation') !== -1) return 'phase-formulation';
    if (p.indexOf('implementation') !== -1) return 'phase-implementation';
    if (p.indexOf('operational') !== -1 || p.indexOf('production') !== -1) return 'phase-operational';
    if (p.indexOf('complete') !== -1) return 'phase-completed';
    return 'phase-unknown';
  }

  function truncateText(text, maxLength) {
    if (!text) return '';
    text = text.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength).trim() + '...';
  }

  function escapeHtml(text) {
    if (!text) return '';
    var div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  function showError(message) {
    var container = document.getElementById('solutionsContainer');
    container.innerHTML = '<div class="empty-state"><span class="material-icons">error</span><p>' + message + '</p></div>';
}

  // Close picker when clicking outside (only if picker exists and is open)
  document.addEventListener('click', function(e) {
    var picker = document.getElementById('solutionPickerDropdown');
    var btn = document.getElementById('solutionPickerBtn');
    // Only process if picker exists, is open, and click is outside
    if (picker && picker.classList.contains('active') && btn &&
        !picker.contains(e.target) && !btn.contains(e.target)) {
      closeSolutionPicker();
    }
  });

  return {
    init: init,
    loadSolutions: loadSolutions,
    applyFilters: applyFilters,
    clearFilters: clearFilters,
    toggleCycle: toggleCycle,
    showDetail: showDetail,
    closeModal: closeModal,
    syncSolutions: syncSolutions,
    exportData: exportData,
    toggleSolutionPicker: toggleSolutionPicker,
    onSolutionToggle: onSolutionToggle,
    selectActiveSolutions: selectActiveSolutions,
    selectAllSolutions: selectAllSolutions,
    clearSolutionSelection: clearSolutionSelection,
    toggleExtendedUpdates: toggleExtendedUpdates,
    toggleStatusSummary: toggleStatusSummary
  };
})();

// Initialize
if (typeof google !== 'undefined' && google.script) {
  Implementation.init();
} else {
  document.addEventListener('DOMContentLoaded', function() {
    if (typeof google !== 'undefined' && google.script) {
      Implementation.init();
    } else {
      setTimeout(function() {
        if (typeof google !== 'undefined' && google.script) {
          Implementation.init();
        }
      }, 500);
    }
  });
}
</script>
