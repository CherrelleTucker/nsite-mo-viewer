<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <base target="_top">
  <title>Access Denied | MO-Viewer</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%230B3D91'/%3E%3Crect x='5' y='5' width='9' height='9' rx='2' fill='white'/%3E%3Crect x='18' y='5' width='9' height='9' rx='2' fill='white'/%3E%3Crect x='5' y='18' width='9' height='9' rx='2' fill='white'/%3E%3Crect x='18' y='18' width='9' height='9' rx='2' fill='%2300A3E0'/%3E%3C/svg%3E">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #0B3D91 0%, #1a5bc4 50%, #00A3E0 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .access-card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 480px;
      width: 100%;
      overflow: hidden;
    }

    .card-header {
      background: #f8d7da;
      padding: 30px;
      text-align: center;
      border-bottom: 1px solid #f5c6cb;
    }

    .lock-icon {
      width: 64px;
      height: 64px;
      background: #dc3545;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
    }

    .lock-icon svg {
      width: 32px;
      height: 32px;
      stroke: white;
      stroke-width: 2;
      fill: none;
    }

    .card-header h1 {
      color: #721c24;
      font-size: 24px;
      font-weight: 600;
    }

    .card-body {
      padding: 30px;
    }

    .message {
      color: #333;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 24px;
      text-align: center;
    }

    .info-box {
      background: #e7f3ff;
      border: 1px solid #b8daff;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 24px;
    }

    .info-box h3 {
      color: #004085;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-box h3 svg {
      width: 16px;
      height: 16px;
      stroke: #004085;
      stroke-width: 2;
      fill: none;
    }

    .info-box p {
      color: #004085;
      font-size: 14px;
      line-height: 1.5;
    }

    .steps {
      margin-bottom: 24px;
    }

    .steps h3 {
      color: #333;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .steps ol {
      padding-left: 20px;
      color: #555;
      font-size: 14px;
      line-height: 1.8;
    }

    .steps li {
      margin-bottom: 8px;
    }

    .steps a {
      color: #0B3D91;
      text-decoration: none;
    }

    .steps a:hover {
      text-decoration: underline;
    }

    .user-email {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 12px 16px;
      font-family: monospace;
      font-size: 14px;
      color: #495057;
      text-align: center;
      margin-bottom: 24px;
    }

    .user-email label {
      display: block;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .card-footer {
      background: #f8f9fa;
      padding: 20px 30px;
      border-top: 1px solid #dee2e6;
      text-align: center;
    }

    .card-footer a {
      color: #6c757d;
      font-size: 14px;
      text-decoration: none;
    }

    .card-footer a:hover {
      color: #0B3D91;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .logo svg {
      width: 24px;
      height: 24px;
      stroke: #0B3D91;
      stroke-width: 2;
      fill: none;
    }

    .logo span {
      font-size: 18px;
      font-weight: 600;
      color: #0B3D91;
    }
  </style>
</head>
<body>
  <div class="access-card">
    <div class="card-header">
      <div class="lock-icon">
        <!-- Lock icon -->
        <svg viewBox="0 0 24 24">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
      </div>
      <h1>Access Denied</h1>
    </div>

    <div class="card-body">
      <p class="message">
        You do not have permission to access MO-Viewer. This application is restricted to authorized NSITE MO team members.
      </p>

      <div class="user-email">
        <label>Your Account</label>
        <span id="userEmail">Loading...</span>
      </div>

      <div class="info-box">
        <h3>
          <!-- Info icon -->
          <svg viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          Why am I seeing this?
        </h3>
        <p>
          MO-Viewer contains NSITE data that is restricted to team members. Access is managed through an approved users list - only users in the MO-DB_Access sheet can view this application.
        </p>
      </div>

      <div class="steps">
        <h3>Request Access:</h3>
        <div id="requestForm">
          <p style="margin-bottom: 12px; font-size: 14px; color: #555;">Click below to send an access request to the administrator.</p>
          <textarea id="requestReason" placeholder="Reason for access (optional)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 12px; font-family: inherit; resize: vertical; min-height: 60px;"></textarea>
          <button id="requestBtn" onclick="submitAccessRequest()" style="width: 100%; padding: 12px; background: #0B3D91; color: white; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">
            Request Access
          </button>
        </div>
        <div id="requestSuccess" style="display: none; padding: 16px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 6px; color: #155724;">
          <strong>Request Sent!</strong><br>
          The administrator has been notified. You'll receive an email once your access is approved.
        </div>
        <div id="requestError" style="display: none; padding: 16px; background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 6px; color: #721c24;">
        </div>
      </div>
    </div>

    <div class="card-footer">
      <div class="logo">
        <!-- Grid icon -->
        <svg viewBox="0 0 24 24">
          <rect x="3" y="3" width="7" height="7"></rect>
          <rect x="14" y="3" width="7" height="7"></rect>
          <rect x="14" y="14" width="7" height="7"></rect>
          <rect x="3" y="14" width="7" height="7"></rect>
        </svg>
        <span>MO-Viewer</span>
      </div>
      <a href="https://www.nasa.gov">NASA.gov</a>
    </div>
  </div>

  <script>
    var userEmail = null;

    // Get email from URL parameter
    function getUrlParam(name) {
      var url = new URL(window.location.href);
      return url.searchParams.get(name);
    }

    // Display the email from URL parameter
    userEmail = getUrlParam('email');
    if (userEmail) {
      document.getElementById('userEmail').textContent = decodeURIComponent(userEmail);
    } else {
      document.getElementById('userEmail').textContent = 'Unknown';
    }

    function submitAccessRequest() {
      var reason = document.getElementById('requestReason').value;
      var btn = document.getElementById('requestBtn');

      if (!userEmail) {
        var errorDiv = document.getElementById('requestError');
        errorDiv.textContent = 'Email address not available. Please go back and sign in again.';
        errorDiv.style.display = 'block';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'Submitting...';

      google.script.run
        .withSuccessHandler(function(result) {
          document.getElementById('requestForm').style.display = 'none';
          if (result.manualRequest) {
            // Show manual instructions if email couldn't be sent
            document.getElementById('requestSuccess').innerHTML =
              '<strong>Request Logged</strong><br>' +
              'Your request has been recorded. Please also contact the administrator directly:<br><br>' +
              '<strong>Email:</strong> ' + result.adminEmail + '<br>' +
              '<strong>Include:</strong> Your email (' + userEmail + ') and reason for access.';
          } else {
            document.getElementById('requestSuccess').innerHTML =
              '<strong>Request Sent!</strong><br>' +
              'The administrator has been notified. You\'ll receive an email once your access is approved.';
          }
          document.getElementById('requestSuccess').style.display = 'block';
        })
        .withFailureHandler(function(error) {
          btn.disabled = false;
          btn.textContent = 'Request Access';
          var errorDiv = document.getElementById('requestError');
          errorDiv.textContent = 'Failed to send request: ' + (error.message || error);
          errorDiv.style.display = 'block';
        })
        .submitAccessRequest(userEmail, reason);
    }
  </script>
</body>
</html>
