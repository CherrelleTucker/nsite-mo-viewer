<!-- Team: Internal team profiles, availability, and office meetings -->

<div class="team-viewer">
  <!-- Page Header -->
  <div class="page-header">
    <div class="page-title">
      <h1>Team</h1>
    </div>
    <div class="page-actions">
      <div class="view-toggle">
        <button class="view-btn active" data-view="overview" onclick="Team.setView('overview')">
          <span class="material-icons">grid_view</span>
          <span>Overview</span>
        </button>
        <button class="view-btn" data-view="actions" onclick="Team.setView('actions')">
          <span class="material-icons">task_alt</span>
          <span>Actions</span>
        </button>
        <button class="view-btn" data-view="kudos" onclick="Team.setView('kudos')">
          <span class="material-icons">celebration</span>
          <span>Kudos</span>
        </button>
        <button class="view-btn" data-view="meetings" onclick="Team.setView('meetings')">
          <span class="material-icons">calendar_today</span>
          <span>Meetings</span>
        </button>
        <button class="view-btn" data-view="documents" onclick="Team.setView('documents')">
          <span class="material-icons">description</span>
          <span>Documents</span>
        </button>
        <button class="view-btn" data-view="parkingLot" onclick="Team.setView('parkingLot')">
          <span class="material-icons">lightbulb</span>
          <span>Parking Lot</span>
        </button>
      </div>
      <button class="btn btn-primary" id="addEntryBtn" onclick="Team.showAddModal()">
        <span class="material-icons">add</span>
        <span id="addEntryLabel">Add Availability</span>
      </button>
    </div>
  </div>

  <!-- Stats Row -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon"><span class="material-icons">group</span></div>
      <div class="stat-info">
        <span class="stat-value" id="statTeamMembers">--</span>
        <span class="stat-label">Team Members</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><span class="material-icons">calendar_today</span></div>
      <div class="stat-info">
        <span class="stat-value" id="statMeetingsThisWeek">--</span>
        <span class="stat-label">Meetings This Week</span>
      </div>
    </div>
    <div class="stat-card stat-warning">
      <div class="stat-icon"><span class="material-icons">person_off</span></div>
      <div class="stat-info">
        <span class="stat-value" id="statOutThisWeek">--</span>
        <span class="stat-label">Out This Week</span>
      </div>
    </div>
    <div class="stat-card stat-kudos">
      <div class="stat-icon"><span class="material-icons">favorite</span></div>
      <div class="stat-info">
        <span class="stat-value" id="statKudosMonth">--</span>
        <span class="stat-label">Kudos This Month</span>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="team-content">
    <!-- Overview View (default) -->
    <div class="view-panel active" id="overviewView">
      <!-- Two column layout -->
      <div class="team-grid">
        <!-- Left: Team Profiles -->
        <div class="team-profiles-section">
          <div class="section-header">
            <h2>Team Members</h2>
            <div class="team-filter">
              <select id="teamFilterSelect" onchange="Team.filterTeam(this.value)">
                <option value="all">All Teams</option>
                <option value="Leadership">Leadership</option>
                <option value="Assessment">Assessment</option>
                <option value="SEP">SEP</option>
                <option value="Comms">Comms</option>
                <option value="Operations">Operations</option>
                <option value="Implementation">Implementation</option>
              </select>
            </div>
          </div>
          <div class="team-grid-cards" id="teamProfilesGrid">
            <div class="loading-state">
              <span class="loading-spinner"></span>
              <span>Loading team...</span>
            </div>
          </div>
        </div>

        <!-- Right: Availability Calendar -->
        <div class="availability-section">
          <div class="section-header">
            <h2>Office Availability</h2>
            <button class="btn btn-sm btn-secondary" onclick="Team.showAddAvailabilityModal()">
              <span class="material-icons">add</span>
              Add
            </button>
          </div>
          <div class="availability-list" id="availabilityList">
            <div class="loading-state">
              <span class="loading-spinner"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions View -->
    <div class="view-panel" id="actionsView">
      <!-- Actions Sub-header -->
      <div class="actions-subheader">
        <div class="actions-view-toggle">
          <button class="view-btn active" data-subview="assignee" onclick="Team.setActionsSubview('assignee')">
            <span class="material-icons">group</span>
            <span>By Person</span>
          </button>
          <button class="view-btn" data-subview="status" onclick="Team.setActionsSubview('status')">
            <span class="material-icons">view_column</span>
            <span>By Status</span>
          </button>
        </div>
        <button class="btn btn-primary btn-sm" onclick="Team.showAddActionModal()">
          <span class="material-icons">add</span>
          Add Action
        </button>
      </div>

      <!-- Actions Filter Bar -->
      <div class="actions-filters">
        <div class="filter-chips">
          <button class="chip active" data-filter="open" onclick="Team.setActionsFilter('open')">Open</button>
          <button class="chip" data-filter="all" onclick="Team.setActionsFilter('all')">All</button>
          <button class="chip" data-filter="done" onclick="Team.setActionsFilter('done')">Done</button>
        </div>
        <div class="filter-search">
          <span class="material-icons">search</span>
          <input type="text" id="action-search" placeholder="Search actions..." onkeyup="Team.applyActionsFilters()">
        </div>
        <select id="filter-source" onchange="Team.applyActionsFilters()">
          <option value="">All Sources</option>
          <option value="MO">Internal (MO)</option>
          <option value="SEP">SEP</option>
        </select>
        <select id="filter-solution" onchange="Team.applyActionsFilters()">
          <option value="">All Solutions</option>
        </select>
      </div>

      <!-- Actions Content -->
      <div class="actions-content">
        <!-- Assignee View (Default) -->
        <div class="assignee-view active" id="assignee-view">
          <div class="loading-state">
            <span class="loading-spinner"></span>
            <span>Loading actions...</span>
          </div>
        </div>

        <!-- Status/Kanban View -->
        <div class="status-view" id="status-view">
          <div class="kanban-column" data-status="pending">
            <div class="column-header">
              <span class="dot pending"></span>
              <span>Pending</span>
              <span class="count" id="count-pending">0</span>
            </div>
            <div class="column-cards" id="cards-pending"></div>
          </div>
          <div class="kanban-column" data-status="not_started">
            <div class="column-header">
              <span class="dot not-started"></span>
              <span>Not Started</span>
              <span class="count" id="count-not-started">0</span>
            </div>
            <div class="column-cards" id="cards-not-started"></div>
          </div>
          <div class="kanban-column" data-status="in_progress">
            <div class="column-header">
              <span class="dot in-progress"></span>
              <span>In Progress</span>
              <span class="count" id="count-in-progress">0</span>
            </div>
            <div class="column-cards" id="cards-in-progress"></div>
          </div>
          <div class="kanban-column" data-status="done">
            <div class="column-header">
              <span class="dot done"></span>
              <span>Done</span>
              <span class="count" id="count-done">0</span>
            </div>
            <div class="column-cards" id="cards-done"></div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="actions-empty" style="display:none;">
        <span class="material-icons">inbox</span>
        <p>No actions found</p>
        <p class="text-muted">Actions sync automatically from meeting agendas</p>
      </div>
    </div>

    <!-- Kudos View -->
    <div class="view-panel" id="kudosView">
      <div class="kudos-layout">
        <!-- Left: Give Kudos Card -->
        <div class="kudos-give-section">
          <div class="kudos-give-card">
            <div class="kudos-give-header">
              <span class="material-icons kudos-header-icon">celebration</span>
              <div>
                <h2>Give a Shoutout!</h2>
                <p>Recognize a teammate for their awesome work</p>
              </div>
            </div>
            <form id="kudosForm" onsubmit="return false;">
              <div class="form-group">
                <label>Who deserves some kudos?</label>
                <select id="kudosRecipient" required>
                  <option value="">Select teammate...</option>
                </select>
              </div>
              <div class="form-group">
                <label>What category?</label>
                <div class="kudos-category-picker" id="kudosCategoryPicker">
                  <button type="button" class="kudos-cat-btn" data-category="teamwork" onclick="Team.selectKudosCategory('teamwork')">
                    <span class="material-icons">group</span>
                    <span>Teamwork</span>
                  </button>
                  <button type="button" class="kudos-cat-btn" data-category="innovation" onclick="Team.selectKudosCategory('innovation')">
                    <span class="material-icons">lightbulb</span>
                    <span>Innovation</span>
                  </button>
                  <button type="button" class="kudos-cat-btn" data-category="above_and_beyond" onclick="Team.selectKudosCategory('above_and_beyond')">
                    <span class="material-icons">star</span>
                    <span>Above &amp; Beyond</span>
                  </button>
                  <button type="button" class="kudos-cat-btn" data-category="mentorship" onclick="Team.selectKudosCategory('mentorship')">
                    <span class="material-icons">school</span>
                    <span>Mentorship</span>
                  </button>
                  <button type="button" class="kudos-cat-btn" data-category="delivery" onclick="Team.selectKudosCategory('delivery')">
                    <span class="material-icons">check_circle</span>
                    <span>Delivery</span>
                  </button>
                </div>
                <input type="hidden" id="kudosCategory" required>
              </div>
              <div class="form-group">
                <label>Your message</label>
                <textarea id="kudosMessage" rows="3" maxlength="280" placeholder="What did they do that was awesome?" required></textarea>
                <div class="char-count"><span id="kudosCharCount">0</span>/280</div>
              </div>
              <div class="form-group kudos-slack-option" id="slackOptionGroup" style="display:none;">
                <label class="checkbox-label kudos-slack-checkbox">
                  <input type="checkbox" id="kudosPostToSlack" checked>
                  <span class="material-icons slack-icon">tag</span>
                  <span>Post to #odsi-kudos</span>
                </label>
              </div>
              <button type="button" class="btn btn-kudos" onclick="Team.submitKudos()">
                <span class="material-icons">send</span>
                Send Kudos!
              </button>
            </form>
          </div>

          <!-- Kudos Stats -->
          <div class="kudos-stats-card">
            <h3><span class="material-icons">insights</span> Kudos Stats</h3>
            <div class="kudos-mini-stats" id="kudosMiniStats">
              <div class="kudos-mini-stat">
                <span class="stat-num" id="kudosThisQuarter">--</span>
                <span class="stat-desc">This Quarter</span>
              </div>
              <div class="kudos-mini-stat">
                <span class="stat-num" id="kudosThisMonth">--</span>
                <span class="stat-desc">This Month</span>
              </div>
            </div>
            <div class="kudos-top-recipients" id="kudosTopRecipients">
              <!-- Populated dynamically -->
            </div>
          </div>
        </div>

        <!-- Right: Kudos Feed -->
        <div class="kudos-feed-section">
          <div class="section-header">
            <h2><span class="material-icons">stream</span> Recent Kudos</h2>
            <select id="kudosFeedFilter" onchange="Team.filterKudosFeed(this.value)">
              <option value="all">All Time</option>
              <option value="30" selected>Last 30 Days</option>
              <option value="90">Last 90 Days</option>
              <option value="quarter">This Quarter</option>
            </select>
          </div>
          <div class="kudos-feed" id="kudosFeed">
            <div class="loading-state">
              <span class="loading-spinner"></span>
              <span>Loading kudos...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Confetti Canvas for Celebrations -->
    <canvas id="confettiCanvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;display:none;"></canvas>

    <!-- Meetings View -->
    <div class="view-panel" id="meetingsView">
      <div class="meetings-layout">
        <!-- Weekly Schedule Grid -->
        <div class="meetings-schedule-section">
          <div class="section-header">
            <h2>Weekly Schedule</h2>
            <div class="meeting-filters">
              <select id="meetingCategoryFilter" onchange="Team.filterMeetings()">
                <option value="all">All Categories</option>
                <option value="MO">MO</option>
                <option value="Assessment">Assessment</option>
                <option value="SEP">SEP</option>
                <option value="Comms">Comms</option>
                <option value="Implementation">Implementation</option>
                <option value="Operations">Operations</option>
                <option value="Ad Hoc">Ad Hoc</option>
              </select>
              <select id="meetingTypeFilter" onchange="Team.filterMeetings()">
                <option value="all">All Types</option>
                <option value="Planning">Planning</option>
                <option value="Working">Working</option>
                <option value="Brainstorm">Brainstorm</option>
                <option value="Status/Sync">Status/Sync</option>
                <option value="Review">Review</option>
                <option value="Training">Training</option>
              </select>
            </div>
          </div>
          <div class="weekly-grid" id="weeklyMeetingGrid">
            <div class="day-column" data-day="Monday">
              <div class="day-header">Monday</div>
              <div class="day-meetings" id="meetingsMonday"></div>
            </div>
            <div class="day-column" data-day="Tuesday">
              <div class="day-header">Tuesday</div>
              <div class="day-meetings" id="meetingsTuesday"></div>
            </div>
            <div class="day-column" data-day="Wednesday">
              <div class="day-header">Wednesday</div>
              <div class="day-meetings" id="meetingsWednesday"></div>
            </div>
            <div class="day-column" data-day="Thursday">
              <div class="day-header">Thursday</div>
              <div class="day-meetings" id="meetingsThursday"></div>
            </div>
            <div class="day-column" data-day="Friday">
              <div class="day-header">Friday</div>
              <div class="day-meetings" id="meetingsFriday"></div>
            </div>
          </div>
        </div>

        <!-- Meeting List with Expandable Details -->
        <div class="meetings-list-section">
          <div class="section-header">
            <h2>All Meetings</h2>
            <button class="btn btn-sm btn-primary" onclick="Team.showAddMeetingModal()">
              <span class="material-icons">add</span>
              Add Meeting
            </button>
          </div>
          <div class="meetings-list" id="meetingsList">
            <div class="loading-state">
              <span class="loading-spinner"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Documents View -->
    <div class="view-panel" id="documentsView">
      <div class="documents-section">
        <div class="section-header">
          <h2>Directing Documents</h2>
          <p class="section-description">Governing documents and policies for NSITE MO</p>
        </div>
        <div class="documents-grid" id="directingDocsList">
          <div class="loading-state">
            <span class="loading-spinner"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Parking Lot View -->
    <div class="view-panel" id="parkingLotView">
      <div class="parking-lot-layout">
        <!-- Left: Add Item + Stats -->
        <div class="parking-lot-sidebar">
          <!-- Quick Add Card -->
          <div class="parking-lot-add-card">
            <div class="parking-lot-add-header">
              <span class="material-icons">lightbulb</span>
              <div>
                <h2>Drop an Idea</h2>
                <p>Capture thoughts that don't have a home yet</p>
              </div>
            </div>
            <form id="parkingLotForm" onsubmit="return false;">
              <div class="form-group">
                <label>Title</label>
                <input type="text" id="plTitle" placeholder="Brief description..." required maxlength="100">
              </div>
              <div class="form-group">
                <label>Type</label>
                <div class="pl-type-picker" id="plTypePicker">
                  <button type="button" class="pl-type-btn" data-type="idea" onclick="Team.selectPLType('idea')">
                    <span class="material-icons">lightbulb</span>
                    <span>Idea</span>
                  </button>
                  <button type="button" class="pl-type-btn" data-type="discussion_topic" onclick="Team.selectPLType('discussion_topic')">
                    <span class="material-icons">forum</span>
                    <span>Discussion</span>
                  </button>
                  <button type="button" class="pl-type-btn" data-type="stakeholder_connection" onclick="Team.selectPLType('stakeholder_connection')">
                    <span class="material-icons">people</span>
                    <span>Connection</span>
                  </button>
                  <button type="button" class="pl-type-btn" data-type="follow_up" onclick="Team.selectPLType('follow_up')">
                    <span class="material-icons">flag</span>
                    <span>Follow-up</span>
                  </button>
                  <button type="button" class="pl-type-btn" data-type="process_suggestion" onclick="Team.selectPLType('process_suggestion')">
                    <span class="material-icons">settings</span>
                    <span>Process</span>
                  </button>
                  <button type="button" class="pl-type-btn" data-type="random_info" onclick="Team.selectPLType('random_info')">
                    <span class="material-icons">info</span>
                    <span>Info</span>
                  </button>
                </div>
                <input type="hidden" id="plType" value="idea">
              </div>
              <div class="form-group">
                <label>Details (optional)</label>
                <textarea id="plDescription" rows="3" placeholder="More context..."></textarea>
              </div>
              <div class="form-row">
                <div class="form-group form-group-half">
                  <label>Priority</label>
                  <select id="plPriority">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                  </select>
                </div>
                <div class="form-group form-group-half">
                  <label>Solution (optional)</label>
                  <select id="plSolution">
                    <option value="">-- None --</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label>Tags (comma-separated)</label>
                <input type="text" id="plTags" placeholder="e.g., comms, sep, process">
              </div>
              <button type="button" class="btn btn-primary btn-full" onclick="Team.submitParkingLotItem()">
                <span class="material-icons">add</span>
                Add to Parking Lot
              </button>
            </form>
          </div>

          <!-- Stats Card -->
          <div class="parking-lot-stats-card">
            <h3><span class="material-icons">insights</span> Parking Lot Stats</h3>
            <div class="pl-mini-stats">
              <div class="pl-mini-stat">
                <span class="stat-num" id="plStatTotal">--</span>
                <span class="stat-desc">Total Items</span>
              </div>
              <div class="pl-mini-stat">
                <span class="stat-num" id="plStatNew">--</span>
                <span class="stat-desc">New</span>
              </div>
              <div class="pl-mini-stat stat-warning">
                <span class="stat-num" id="plStatHighPriority">--</span>
                <span class="stat-desc">High Priority</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Items Feed -->
        <div class="parking-lot-feed-section">
          <div class="parking-lot-feed-header">
            <h2>Parking Lot Items</h2>
            <div class="pl-filters">
              <select id="plFilterType" onchange="Team.filterParkingLot()">
                <option value="all">All Types</option>
                <option value="idea">Ideas</option>
                <option value="discussion_topic">Discussion Topics</option>
                <option value="stakeholder_connection">Connections</option>
                <option value="follow_up">Follow-ups</option>
                <option value="process_suggestion">Process</option>
                <option value="random_info">Info</option>
              </select>
              <select id="plFilterStatus" onchange="Team.filterParkingLot()">
                <option value="active">Active</option>
                <option value="new">New</option>
                <option value="assigned">Assigned</option>
                <option value="in_progress">In Progress</option>
                <option value="resolved">Resolved</option>
                <option value="all">All Statuses</option>
              </select>
            </div>
          </div>
          <div class="parking-lot-feed" id="parkingLotFeed">
            <div class="loading-state">
              <span class="loading-spinner"></span>
              <span>Loading parking lot...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Availability Modal -->
<div class="modal" id="addAvailabilityModal">
  <div class="modal-content modal-sm">
    <div class="modal-header">
      <h3>Add Availability Entry</h3>
      <button class="modal-close" onclick="Team.closeModal('addAvailabilityModal')">&times;</button>
    </div>
    <div class="modal-body">
      <form id="availabilityForm">
        <div class="form-group" id="personSelectGroup">
          <label>Team Member</label>
          <select id="availPersonSelect">
            <option value="">Select person...</option>
          </select>
        </div>
        <div class="form-group">
          <label>Type</label>
          <select id="availTypeSelect" required onchange="Team.toggleFormFields()">
            <option value="">Select type...</option>
            <optgroup label="Personal">
              <option value="vacation">Vacation</option>
              <option value="work_travel">Work Travel</option>
              <option value="ooo">Out of Office</option>
              <option value="9_80">9/80 Schedule</option>
            </optgroup>
            <optgroup label="Office-Wide">
              <option value="holiday">Holiday</option>
              <option value="special_event">Special Event</option>
            </optgroup>
          </select>
        </div>
        <div class="form-group hidden" id="holidayNameGroup">
          <label>Holiday Name</label>
          <input type="text" id="availHolidayName" placeholder="e.g., Memorial Day, Independence Day">
        </div>
        <div class="form-group hidden" id="partnersGroup">
          <label>Affected Partners</label>
          <div class="checkbox-group" id="partnerCheckboxes">
            <label class="checkbox-label"><input type="checkbox" name="partners" value="NASA"> NASA</label>
            <label class="checkbox-label"><input type="checkbox" name="partners" value="UAH"> UAH</label>
            <label class="checkbox-label"><input type="checkbox" name="partners" value="DevSeed"> DevSeed</label>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Start Date</label>
            <input type="date" id="availStartDate" required>
          </div>
          <div class="form-group">
            <label>End Date</label>
            <input type="date" id="availEndDate" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Recurrence</label>
            <select id="availRecurrence">
              <option value="none">Does not repeat</option>
              <option value="weekly">Weekly</option>
              <option value="biweekly">Every 2 weeks</option>
              <option value="monthly">Monthly</option>
              <option value="annually">Annually</option>
            </select>
          </div>
          <div class="form-group" id="locationGroup">
            <label>Location (optional)</label>
            <input type="text" id="availLocation" placeholder="e.g., AGU Conference, HQ">
          </div>
        </div>
        <div class="form-group">
          <label>Notes (optional)</label>
          <textarea id="availNotes" rows="2" maxlength="500"></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-danger" id="deleteAvailabilityBtn" onclick="Team.deleteAvailability()" style="display:none; margin-right:auto;">Delete</button>
      <button class="btn btn-secondary" onclick="Team.closeModal('addAvailabilityModal')">Cancel</button>
      <button class="btn btn-primary" id="saveAvailabilityBtn" onclick="Team.saveAvailability()">
        <span class="btn-text">Save</span>
        <span class="btn-loading" style="display:none;"><span class="loading-spinner-sm"></span> Saving...</span>
      </button>
    </div>
  </div>
</div>

<!-- Add Meeting Modal -->
<div class="modal" id="addMeetingModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add Meeting</h3>
      <button class="modal-close" onclick="Team.closeModal('addMeetingModal')">&times;</button>
    </div>
    <div class="modal-body">
      <form id="meetingForm">
        <div class="form-group">
          <label>Meeting Name</label>
          <input type="text" id="meetingName" required placeholder="e.g., Weekly Sync">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Category</label>
            <select id="meetingCategory" required>
              <option value="MO">MO</option>
              <option value="Assessment">Assessment</option>
              <option value="SEP">SEP</option>
              <option value="Comms">Comms</option>
              <option value="Implementation">Implementation</option>
              <option value="Operations">Operations</option>
              <option value="Ad Hoc">Ad Hoc</option>
            </select>
          </div>
          <div class="form-group">
            <label>Type</label>
            <select id="meetingType" required>
              <option value="Planning">Planning</option>
              <option value="Working">Working</option>
              <option value="Brainstorm">Brainstorm</option>
              <option value="Status/Sync">Status/Sync</option>
              <option value="Review">Review</option>
              <option value="Training">Training</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Cadence</label>
            <select id="meetingCadence" required>
              <option value="Weekly">Weekly</option>
              <option value="Bi-Weekly">Bi-Weekly</option>
              <option value="Tri-Weekly">Tri-Weekly</option>
              <option value="Monthly">Monthly</option>
              <option value="Quarterly">Quarterly</option>
              <option value="Annual">Annual</option>
              <option value="Ad Hoc">Ad Hoc</option>
            </select>
          </div>
          <div class="form-group">
            <label>Day of Week</label>
            <select id="meetingDay">
              <option value="">Not set</option>
              <option value="Monday">Monday</option>
              <option value="Tuesday">Tuesday</option>
              <option value="Wednesday">Wednesday</option>
              <option value="Thursday">Thursday</option>
              <option value="Friday">Friday</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Time</label>
            <input type="text" id="meetingTime" placeholder="e.g., 2:00 PM">
          </div>
          <div class="form-group">
            <label>Duration (minutes)</label>
            <input type="number" id="meetingDuration" value="60">
          </div>
        </div>
        <div class="form-group">
          <label>Purpose</label>
          <textarea id="meetingPurpose" rows="2" maxlength="1000" placeholder="What problem does this meeting solve?"></textarea>
        </div>
        <div class="form-group">
          <label>Online Meeting Link</label>
          <input type="url" id="meetingLink" placeholder="https://...">
        </div>
        <div class="form-group">
          <label>Drive Folder URL</label>
          <input type="url" id="meetingDriveFolder" placeholder="https://drive.google.com/...">
        </div>
        <hr style="margin: var(--space-md) 0;">
        <h4 style="margin-bottom: var(--space-sm);">Resource Links (optional)</h4>
        <div class="form-group">
          <label>Agenda URL</label>
          <input type="url" id="meetingAgendaUrl" placeholder="https://...">
        </div>
        <div class="form-group">
          <label>Notes URL</label>
          <input type="url" id="meetingNotesUrl" placeholder="https://...">
        </div>
        <div class="form-group">
          <label>Slides URL</label>
          <input type="url" id="meetingSlidesUrl" placeholder="https://...">
        </div>
        <div class="form-group">
          <label>Recording URL</label>
          <input type="url" id="meetingRecordingUrl" placeholder="https://...">
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="Team.closeModal('addMeetingModal')">Cancel</button>
      <button class="btn btn-primary" onclick="Team.saveMeeting()">Save</button>
    </div>
  </div>
</div>

<!-- Meeting Detail Modal (for viewing/editing with artifacts) -->
<div class="modal" id="meetingDetailModal">
  <div class="modal-content modal-lg">
    <div class="modal-header">
      <h3 id="meetingDetailTitle">Meeting Details</h3>
      <button class="modal-close" onclick="Team.closeModal('meetingDetailModal')">&times;</button>
    </div>
    <div class="modal-body" id="meetingDetailBody">
      <!-- Populated dynamically -->
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="Team.closeModal('meetingDetailModal')">Close</button>
      <button class="btn btn-primary" onclick="Team.editMeeting()">Edit</button>
    </div>
  </div>
</div>

<!-- Team Member Detail Modal -->
<div class="modal" id="memberDetailModal">
  <div class="modal-content modal-lg">
    <div class="modal-header">
      <h3 id="memberDetailTitle">Team Member</h3>
      <button class="modal-close" onclick="Team.closeModal('memberDetailModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="member-detail">
        <div class="member-detail-header">
          <div class="member-avatar-lg" id="memberDetailAvatar">--</div>
          <div class="member-detail-name">
            <h2 id="memberDetailName">--</h2>
            <p id="memberDetailTitle2" class="member-role">--</p>
          </div>
        </div>
        <div class="member-detail-info">
          <div class="member-info-row">
            <span class="material-icons">email</span>
            <a id="memberDetailEmail" href="#" class="member-email">--</a>
          </div>
          <div class="member-info-row">
            <span class="material-icons">group</span>
            <span id="memberDetailTeam">--</span>
          </div>
          <div class="member-info-row" id="memberDetailPhoneRow" style="display:none;">
            <span class="material-icons">phone</span>
            <span id="memberDetailPhone">--</span>
          </div>
          <div class="member-info-row" id="memberDetailOrgRow" style="display:none;">
            <span class="material-icons">work</span>
            <span id="memberDetailOrg">--</span>
          </div>
        </div>

        <!-- About Me Profile Section -->
        <div class="member-profile-section" id="memberProfileSection" style="display:none;">
          <h4 class="profile-section-header"><span class="material-icons">person</span> About Me</h4>

          <div class="profile-grid">
            <div class="profile-item" id="profileEducationItem">
              <div class="profile-label"><span class="material-icons">school</span> Education</div>
              <div class="profile-value" id="memberDetailEducation">--</div>
            </div>

            <div class="profile-item" id="profileDutiesItem">
              <div class="profile-label"><span class="material-icons">work</span> What I Do</div>
              <div class="profile-value" id="memberDetailDuties">--</div>
            </div>

            <div class="profile-item" id="profileSkillsItem">
              <div class="profile-label"><span class="material-icons">psychology</span> Professional Skills</div>
              <div class="profile-value" id="memberDetailSkills">--</div>
            </div>

            <div class="profile-item" id="profileNonWorkSkillsItem">
              <div class="profile-label"><span class="material-icons">handyman</span> Non-Work Skills</div>
              <div class="profile-value" id="memberDetailNonWorkSkills">--</div>
            </div>

            <div class="profile-item" id="profileHobbiesItem">
              <div class="profile-label"><span class="material-icons">sports_tennis</span> Hobbies</div>
              <div class="profile-value" id="memberDetailHobbies">--</div>
            </div>

            <div class="profile-item" id="profileGoalsItem">
              <div class="profile-label"><span class="material-icons">flag</span> Goals</div>
              <div class="profile-value" id="memberDetailGoals">--</div>
            </div>

            <div class="profile-item" id="profileRelaxItem">
              <div class="profile-label"><span class="material-icons">self_improvement</span> How I Relax</div>
              <div class="profile-value" id="memberDetailRelax">--</div>
            </div>

            <div class="profile-item" id="profileEarlyJobItem">
              <div class="profile-label"><span class="material-icons">history</span> First Job</div>
              <div class="profile-value" id="memberDetailEarlyJob">--</div>
            </div>
          </div>
        </div>

        <div class="member-availability-section">
          <h4>Current Availability</h4>
          <div id="memberAvailabilityList" class="member-availability-list">
            <p class="text-muted">No upcoming OOO</p>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="Team.closeModal('memberDetailModal')">Close</button>
    </div>
  </div>
</div>

<!-- Parking Lot Item Detail Modal -->
<div class="modal" id="plItemDetailModal">
  <div class="modal-content modal-md">
    <div class="modal-header">
      <h3 id="plItemDetailTitle">Item Details</h3>
      <button class="modal-close" onclick="Team.closeModal('plItemDetailModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="pl-detail-header">
        <span class="pl-type-badge" id="plDetailTypeBadge">
          <span class="material-icons">lightbulb</span>
          <span>Idea</span>
        </span>
        <span class="pl-priority-badge" id="plDetailPriorityBadge">Medium</span>
        <span class="pl-status-badge" id="plDetailStatusBadge">New</span>
      </div>

      <div class="pl-detail-content">
        <div class="pl-detail-description" id="plDetailDescription">
          No description provided.
        </div>

        <div class="pl-detail-meta">
          <div class="pl-meta-item">
            <span class="material-icons">person</span>
            <span>Submitted by: <strong id="plDetailSubmitter">--</strong></span>
          </div>
          <div class="pl-meta-item">
            <span class="material-icons">schedule</span>
            <span>Created: <strong id="plDetailCreated">--</strong></span>
          </div>
          <div class="pl-meta-item" id="plDetailSolutionRow" style="display:none;">
            <span class="material-icons">widgets</span>
            <span>Solution: <strong id="plDetailSolution">--</strong></span>
          </div>
          <div class="pl-meta-item" id="plDetailAssigneeRow" style="display:none;">
            <span class="material-icons">assignment_ind</span>
            <span>Assigned to: <strong id="plDetailAssignee">--</strong></span>
          </div>
          <div class="pl-meta-item" id="plDetailTagsRow" style="display:none;">
            <span class="material-icons">label</span>
            <span>Tags: <strong id="plDetailTags">--</strong></span>
          </div>
        </div>

        <div class="pl-detail-notes" id="plDetailNotesSection" style="display:none;">
          <h4>Notes</h4>
          <div id="plDetailNotes" class="pl-notes-content"></div>
        </div>
      </div>

      <!-- Actions Section -->
      <div class="pl-detail-actions">
        <h4>Actions</h4>
        <div class="form-row">
          <div class="form-group form-group-half">
            <label>Update Status</label>
            <select id="plDetailStatusSelect" onchange="Team.updatePLItemStatus()">
              <option value="new">New</option>
              <option value="discussed">Discussed</option>
              <option value="assigned">Assigned</option>
              <option value="in_progress">In Progress</option>
              <option value="resolved">Resolved</option>
              <option value="archived">Archived</option>
            </select>
          </div>
          <div class="form-group form-group-half">
            <label>Assign To</label>
            <select id="plDetailAssignSelect" onchange="Team.assignPLItem()">
              <option value="">-- Unassigned --</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Add Note</label>
          <div class="pl-note-input">
            <input type="text" id="plDetailNoteInput" placeholder="Add a note...">
            <button class="btn btn-sm btn-primary" onclick="Team.addPLNote()">
              <span class="material-icons">add</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-danger btn-sm" onclick="Team.deletePLItem()">
        <span class="material-icons">delete</span>
        Delete
      </button>
      <button class="btn btn-secondary" onclick="Team.closeModal('plItemDetailModal')">Close</button>
    </div>
  </div>
</div>

<!-- Action Detail Drawer -->
<div class="drawer-overlay" id="action-drawer">
  <div class="drawer">
    <div class="drawer-header">
      <h3>Action Details</h3>
      <button class="btn-icon" onclick="Team.closeActionDrawer()">
        <span class="material-icons">close</span>
      </button>
    </div>
    <div class="drawer-body" id="drawer-body">
      <!-- Populated by JavaScript -->
    </div>
  </div>
</div>

<!-- Add Action Modal -->
<div class="modal" id="addActionModal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add Action</h3>
      <button class="modal-close" onclick="Team.closeModal('addActionModal')">&times;</button>
    </div>
    <div class="modal-body">
      <form id="add-action-form" onsubmit="return Team.submitAction(event)">
        <div class="form-group">
          <label for="add-task">Task *</label>
          <textarea id="add-task" rows="3" required maxlength="1000" placeholder="Describe the action item..."></textarea>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="add-assigned">Assigned To *</label>
            <input type="text" id="add-assigned" list="team-members-list" required placeholder="Select or type name">
            <datalist id="team-members-list">
              <!-- Populated by JavaScript -->
            </datalist>
          </div>
          <div class="form-group">
            <label for="add-category">Source</label>
            <select id="add-category">
              <option value="MO">Internal (MO)</option>
              <option value="SEP">SEP</option>
              <option value="AdHoc">Ad Hoc</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="add-solution">Solution</label>
            <select id="add-solution">
              <option value="">-- Select Solution --</option>
              <optgroup label="3D & Visualization">
                <option value="3d-topo">3D Topo</option>
              </optgroup>
              <optgroup label="Air Quality">
                <option value="aq">Air Quality</option>
                <option value="aq_gmao">AQ GMAO</option>
                <option value="aq_pandora">AQ Pandora</option>
                <option value="aq_pandora-ongoing">AQ Pandora Ongoing</option>
                <option value="aq_pm">AQ PM</option>
                <option value="tempo_enhanced">TEMPO Enhanced</option>
                <option value="tempo_nrt">TEMPO NRT</option>
              </optgroup>
              <optgroup label="Land & Vegetation">
                <option value="hls">HLS</option>
                <option value="hls_10m">HLS 10m</option>
                <option value="hls_et">HLS ET</option>
                <option value="hls_ll">HLS LL</option>
                <option value="hls_lst">HLS LST</option>
                <option value="hls_vi">HLS VI</option>
                <option value="global-et">Global ET</option>
                <option value="targeted_rs">Targeted RS</option>
              </optgroup>
              <optgroup label="Water">
                <option value="opera">OPERA</option>
                <option value="opera_disp">OPERA DISP</option>
                <option value="opera_dist">OPERA DIST</option>
                <option value="opera_dswx">OPERA DSWx</option>
                <option value="water-quality">Water Quality</option>
                <option value="sss">SSS</option>
              </optgroup>
              <optgroup label="Disasters & Events">
                <option value="firms-2g">FIRMS 2G</option>
                <option value="harm-tir">HARM TIR</option>
                <option value="volcano">Volcano</option>
                <option value="vlm">VLM</option>
              </optgroup>
              <optgroup label="Geodesy & SAR">
                <option value="nisar_dl">NISAR DL</option>
                <option value="nisar_hi_res">NISAR Hi-Res</option>
                <option value="nisar_sm">NISAR SM</option>
                <option value="grace-fo">GRACE-FO</option>
                <option value="icesat">ICESat</option>
              </optgroup>
              <optgroup label="Atmospheric">
                <option value="admg">ADMG</option>
                <option value="pbl">PBL</option>
                <option value="pbl_height">PBL Height</option>
                <option value="mwow">MWOW</option>
              </optgroup>
              <optgroup label="Programs & Partnerships">
                <option value="csda">CSDA</option>
                <option value="dcd">DCD</option>
                <option value="gaban">GABAN</option>
                <option value="gacr">GACR</option>
                <option value="gcc">GCC</option>
                <option value="ioa">IOA</option>
                <option value="nga">NGA</option>
              </optgroup>
              <optgroup label="MO Internal">
                <option value="mo">MO</option>
                <option value="mo_assess">MO Assessment</option>
                <option value="mo_comms">MO Comms</option>
                <option value="mo_impl">MO Implementation</option>
                <option value="mo_sep">MO SEP</option>
              </optgroup>
            </select>
          </div>
          <div class="form-group">
            <label for="add-priority">Priority</label>
            <select id="add-priority">
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="low">Low</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label for="add-due">Due Date</label>
          <input type="date" id="add-due">
        </div>
        <div class="form-group">
          <label for="add-notes">Notes</label>
          <textarea id="add-notes" rows="2" maxlength="2000" placeholder="Additional context (optional)"></textarea>
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" onclick="Team.closeModal('addActionModal')">Cancel</button>
      <button type="submit" class="btn btn-primary" id="add-submit-btn" onclick="Team.submitAction(event)">
        <span class="material-icons">add</span> Add Action
      </button>
    </div>
  </div>
</div>

<!-- Team Page Styles -->
<style>
  /* Page accent color for shared styles */
  .team-viewer {
    --page-accent: var(--color-primary);
    max-width: 1600px;
    margin: 0 auto;
  }

  /* Team Grid Layout */
  .team-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: var(--space-lg);
  }

  .team-profiles-section,
  .availability-section {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    box-shadow: var(--shadow-sm);
    border-top: 3px solid var(--page-accent);
  }

  .team-grid-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: var(--space-md);
    margin-top: var(--space-md);
  }

  .team-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    text-align: center;
    transition: all var(--transition-fast);
    cursor: pointer;
  }

  .team-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
    border-color: var(--color-primary);
  }

  .team-card .avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--color-primary), #60a5fa);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0 auto var(--space-sm);
  }

  .team-card .name {
    font-weight: 600;
    margin-bottom: var(--space-xs);
    color: var(--color-text);
  }

  .team-card .title {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-xs);
  }

  .team-card .team-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: var(--font-size-xs);
    font-weight: 500;
  }

  .team-badge.Leadership { background: #e3f2fd; color: #1565c0; }
  .team-badge.Assessment { background: #fff3e0; color: #ef6c00; }
  .team-badge.SEP { background: #e8f5e9; color: #2e7d32; }
  .team-badge.Comms { background: #fce4ec; color: #c2185b; }
  .team-badge.Operations { background: #f3e5f5; color: #7b1fa2; }
  .team-badge.Implementation { background: #e0f7fa; color: #00838f; }

  /* Availability List */
  .availability-list {
    margin-top: var(--space-md);
    max-height: 400px;
    overflow-y: auto;
  }

  .availability-item {
    display: flex;
    align-items: center;
    padding: var(--space-sm);
    border-bottom: 1px solid var(--color-border-light);
    gap: var(--space-sm);
  }

  .availability-item:last-child {
    border-bottom: none;
  }

  .avail-type-badge {
    padding: 2px 6px;
    border-radius: 4px;
    font-size: var(--font-size-xs);
    font-weight: 500;
    text-transform: uppercase;
  }

  .avail-type-badge.vacation { background: #e8f5e9; color: #2e7d32; }
  .avail-type-badge.work_travel { background: #e3f2fd; color: #1565c0; }
  .avail-type-badge.ooo { background: #fff3e0; color: #ef6c00; }
  .avail-type-badge.nine_80 { background: #f3e5f5; color: #7b1fa2; }
  .avail-type-badge.holiday { background: #ffebee; color: #c62828; }
  .avail-type-badge.special_event { background: #fce4ec; color: #c2185b; }

  /* Partner tags for holidays */
  .partner-tags {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
  }
  .partner-tag {
    font-size: var(--font-size-xs);
    padding: 1px 4px;
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    color: var(--color-text-secondary);
  }

  /* Checkbox group styling */
  .checkbox-group {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
  }
  .checkbox-label {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: var(--font-size-sm);
    cursor: pointer;
    padding: var(--space-xs) var(--space-sm);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    border: 1px solid var(--color-border);
    transition: all var(--transition-fast);
  }
  .checkbox-label:hover {
    border-color: var(--color-primary);
  }
  .checkbox-label input[type="checkbox"] {
    width: auto;
    margin: 0;
  }
  .checkbox-label input[type="checkbox"]:checked + span,
  .checkbox-label:has(input:checked) {
    color: var(--color-primary);
  }

  /* Recurrence indicator */
  .recurrence-icon {
    color: var(--color-text-muted);
    font-size: var(--font-size-xs);
  }

  .avail-name {
    font-weight: 500;
    font-size: var(--font-size-sm);
  }

  .avail-dates {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .avail-location {
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
  }

  .avail-notes {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    font-style: italic;
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .availability-item:hover {
    background: var(--color-gray-50);
  }

  /* Meetings Layout */
  .meetings-layout {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-lg);
  }

  .meetings-schedule-section {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    box-shadow: var(--shadow-sm);
  }

  .meeting-filters {
    display: flex;
    gap: var(--space-sm);
  }

  .meeting-filters select {
    padding: var(--space-xs) var(--space-sm);
    font-size: var(--font-size-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    background: var(--color-surface);
  }

  .weekly-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: var(--space-sm);
    background: var(--color-surface-alt);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    margin-top: var(--space-md);
  }

  .day-column {
    min-height: 200px;
  }

  .day-header {
    font-weight: 600;
    font-size: var(--font-size-sm);
    padding: var(--space-sm);
    background: var(--color-surface);
    border-radius: var(--radius-sm);
    text-align: center;
    margin-bottom: var(--space-sm);
  }

  .day-meetings {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .meeting-chip {
    padding: var(--space-xs) var(--space-sm);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-xs);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .meeting-chip:hover {
    background: rgba(11, 61, 145, 0.1);
    border-color: var(--color-primary);
  }

  .meeting-chip .meeting-time {
    font-weight: 600;
    display: block;
    color: var(--color-text);
  }

  .meeting-chip .meeting-name {
    color: var(--color-text-muted);
  }

  .meeting-chip .meeting-cadence {
    font-style: italic;
    color: var(--color-text-muted);
    font-size: 0.9em;
  }

  /* Meeting Row Highlight (when clicked from weekly grid) */
  .meeting-row.highlight {
    animation: highlightPulse 1.5s ease-out;
  }

  @keyframes highlightPulse {
    0% { background-color: rgba(11, 61, 145, 0.2); }
    100% { background-color: var(--color-surface); }
  }

  /* Meeting Detail Modal */
  .meeting-detail-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-md);
    margin-bottom: var(--space-md);
  }

  .meeting-detail-section {
    margin-bottom: var(--space-md);
  }

  .meeting-detail-section h4 {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    margin: 0 0 var(--space-sm) 0;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .meeting-detail-section h4 .material-icons {
    font-size: 16px;
  }

  .meeting-detail-row {
    padding: var(--space-xs) 0;
    font-size: var(--font-size-sm);
  }

  .meeting-detail-section p {
    margin: 0;
    color: var(--color-text);
    line-height: 1.5;
  }

  .meeting-detail-section .btn-sm {
    padding: var(--space-xs) var(--space-sm);
    font-size: var(--font-size-xs);
    margin-right: var(--space-xs);
    margin-top: var(--space-xs);
  }

  .meeting-detail-section .btn-sm .material-icons {
    font-size: 14px;
    margin-right: var(--space-xs);
    vertical-align: middle;
  }

  /* Meetings List */
  .meetings-list-section {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    box-shadow: var(--shadow-sm);
  }

  .meetings-list {
    margin-top: var(--space-md);
  }

  .meeting-row {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    margin-bottom: var(--space-sm);
    overflow: hidden;
  }

  .meeting-row-header {
    display: flex;
    align-items: center;
    padding: var(--space-md);
    cursor: pointer;
    gap: var(--space-md);
    transition: background var(--transition-fast);
  }

  .meeting-row-header:hover {
    background: var(--color-surface-alt);
  }

  .meeting-row-header .expand-icon {
    transition: transform 0.2s;
    color: var(--color-text-muted);
  }

  .meeting-row.expanded .expand-icon {
    transform: rotate(90deg);
  }

  .meeting-row-details {
    display: none;
    padding: var(--space-md);
    border-top: 1px solid var(--color-border-light);
    background: var(--color-surface-alt);
  }

  .meeting-row.expanded .meeting-row-details {
    display: block;
  }

  .meeting-meta {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
    margin-bottom: var(--space-md);
  }

  .meeting-meta-item {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
  }

  .meeting-meta-item svg { width: 14px; height: 14px; }

  .artifacts-section {
    margin-top: var(--space-md);
  }

  .artifacts-section h4 {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-sm);
  }

  .artifacts-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .artifact-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm);
    background: var(--color-surface);
    border-radius: var(--radius-sm);
  }

  .artifact-item svg { width: 14px; height: 14px; color: var(--color-primary); }

  .artifact-item a {
    color: var(--color-primary);
    text-decoration: none;
    font-size: var(--font-size-sm);
  }

  .artifact-item a:hover {
    text-decoration: underline;
  }

  /* Documents Grid */
  .documents-section {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    box-shadow: var(--shadow-sm);
  }

  .section-description {
    color: var(--color-text-secondary);
    font-size: var(--font-size-sm);
    margin-top: var(--space-xs);
  }

  .documents-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--space-md);
    margin-top: var(--space-md);
  }

  .document-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    display: flex;
    align-items: center;
    gap: var(--space-md);
    transition: all var(--transition-fast);
  }

  .document-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
  }

  .document-card .doc-icon {
    width: 40px;
    height: 40px;
    background: rgba(11, 61, 145, 0.1);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-primary);
    flex-shrink: 0;
  }

  .document-card .doc-icon svg { width: 20px; height: 20px; }
  .document-card .doc-icon .material-icons { font-size: 20px; }

  .document-card .doc-info {
    flex: 1;
    min-width: 0;
  }

  .document-card .doc-title {
    font-weight: 600;
    margin-bottom: var(--space-xs);
    color: var(--color-text);
  }

  .document-card .doc-description {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  .document-card .doc-external-icon {
    font-size: 16px;
    color: var(--color-text-muted);
    opacity: 0;
    transition: opacity var(--transition-fast);
    flex-shrink: 0;
  }

  .document-card:hover .doc-external-icon {
    opacity: 1;
  }

  /* Documents category sections */
  .documents-category {
    margin-bottom: var(--space-lg);
  }

  .documents-category:last-child {
    margin-bottom: 0;
  }

  .category-docs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: var(--space-md);
  }

  .category-header {
    font-size: var(--font-size-md);
    font-weight: 600;
    margin: 0;
  }

  /* Make document cards clickable links */
  a.document-card {
    text-decoration: none;
    color: inherit;
  }

  a.document-card:hover {
    border-color: var(--color-primary);
  }

  a.document-card:hover .doc-title {
    color: var(--color-primary);
  }

  /* Category badges for meetings */
  .category-badge {
    padding: 2px 8px;
    border-radius: 10px;
    font-size: var(--font-size-xs);
    font-weight: 500;
  }

  .category-badge.MO { background: #e3f2fd; color: #1565c0; }
  .category-badge.Assessment { background: #fff3e0; color: #ef6c00; }
  .category-badge.SEP { background: #e8f5e9; color: #2e7d32; }
  .category-badge.Comms { background: #fce4ec; color: #c2185b; }
  .category-badge.Operations { background: #f3e5f5; color: #7b1fa2; }
  .category-badge.Implementation { background: #e0f7fa; color: #00838f; }

  .type-badge {
    padding: 2px 8px;
    border-radius: 10px;
    font-size: var(--font-size-xs);
    font-weight: 500;
    background: var(--color-surface-alt);
    color: var(--color-text-secondary);
  }

  /* Buttons - matching SEP pattern */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-md);
    font-size: var(--font-size-sm);
    font-weight: 500;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: all var(--transition-fast);
    border: none;
  }
  .btn svg { width: 16px; height: 16px; }
  .btn-primary { background: var(--color-primary); color: white; }
  .btn-primary:hover { background: var(--color-primary-dark); }
  .btn-secondary { background: var(--color-surface-alt); color: var(--color-text); border: 1px solid var(--color-border); }
  .btn-secondary:hover { background: var(--color-border-light); }
  .btn-danger { background: #ef4444; color: white; border: none; }
  .btn-danger:hover { background: #dc2626; }
  .btn-sm { padding: var(--space-xs) var(--space-sm); font-size: var(--font-size-xs); }

  /* Modal Styles - matching SEP pattern */
  .modal {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: var(--space-md);
  }
  .modal.show { display: flex; }
  .modal-content {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }
  .modal-content.modal-sm { max-width: 450px; }
  .modal-content.modal-lg { max-width: 900px; }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-md) var(--space-lg);
    border-bottom: 1px solid var(--color-border-light);
    background: var(--color-surface-alt);
  }
  .modal-header h3 { font-size: var(--font-size-lg); font-weight: 600; margin: 0; }
  .modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-text-muted); }
  .modal-close:hover { color: var(--color-text); }
  .modal-body { padding: var(--space-lg); overflow-y: auto; }
  .modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--space-sm);
    padding: var(--space-md) var(--space-lg);
    border-top: 1px solid var(--color-border-light);
    background: var(--color-surface-alt);
  }

  /* Member Detail Modal */
  .member-detail-header {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
    padding-bottom: var(--space-md);
    border-bottom: 1px solid var(--color-border-light);
  }
  .member-avatar-lg {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--color-primary), #60a5fa);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    font-weight: 600;
    flex-shrink: 0;
  }
  .member-detail-name h2 {
    font-size: var(--font-size-lg);
    margin: 0 0 var(--space-xs) 0;
    color: var(--color-text);
  }
  .member-role {
    color: var(--color-text-muted);
    font-size: var(--font-size-sm);
    margin: 0;
  }
  .member-detail-info {
    margin-bottom: var(--space-lg);
  }
  .member-info-row {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) 0;
    font-size: var(--font-size-sm);
  }
  .member-info-row .info-icon {
    width: 16px;
    height: 16px;
    color: var(--color-text-muted);
  }
  .member-email {
    color: var(--color-primary);
    text-decoration: none;
  }
  .member-email:hover { text-decoration: underline; }
  .member-availability-section h4 {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-sm);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .member-availability-list {
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    padding: var(--space-sm);
  }
  .member-avail-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-xs) 0;
    font-size: var(--font-size-sm);
  }
  .member-avail-item + .member-avail-item {
    border-top: 1px solid var(--color-border-light);
    padding-top: var(--space-sm);
    margin-top: var(--space-xs);
  }

  /* Profile badge on team cards */
  .team-card {
    position: relative;
  }
  .team-card.has-profile {
    border-color: rgba(46, 125, 50, 0.3);
  }
  .team-card.has-profile:hover {
    border-color: #2e7d32;
  }
  .profile-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 24px;
    height: 24px;
    background: linear-gradient(135deg, #4caf50, #2e7d32);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .profile-badge .material-icons {
    font-size: 14px;
    color: white;
  }

  /* Profile section in modal */
  .member-profile-section {
    margin: var(--space-lg) 0;
    padding-top: var(--space-lg);
    border-top: 1px solid var(--color-border-light);
  }
  .profile-section-header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--font-size-md);
    color: #2e7d32;
    margin-bottom: var(--space-md);
  }
  .profile-section-header .material-icons {
    font-size: 20px;
  }
  .profile-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-md);
  }
  .profile-item {
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
    padding: var(--space-sm) var(--space-md);
  }
  .profile-label {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: var(--space-xs);
  }
  .profile-label .material-icons {
    font-size: 14px;
  }
  .profile-value {
    font-size: var(--font-size-sm);
    color: var(--color-text);
    line-height: 1.5;
  }

  @media (max-width: 768px) {
    .profile-grid {
      grid-template-columns: 1fr;
    }
  }

  /* Form Styles - matching SEP pattern */
  .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-md); }
  .form-group { margin-bottom: var(--space-md); }
  .form-group label { display: block; font-size: var(--font-size-sm); font-weight: 500; margin-bottom: var(--space-xs); color: var(--color-text); }
  .form-group input, .form-group select, .form-group textarea {
    width: 100%;
    padding: var(--space-sm);
    font-size: var(--font-size-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    font-family: inherit;
    background: var(--color-surface);
  }
  .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
    outline: none;
    border-color: var(--color-primary);
  }

  /* Empty State (loading/button states now in global styles.html) */
  .empty-state { text-align: center; padding: var(--space-lg); color: var(--color-text-muted); }

  /* Hidden form groups */
  .form-group.hidden { display: none; }

  /* Team filter select */
  .team-filter select {
    padding: var(--space-xs) var(--space-sm);
    font-size: var(--font-size-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    background: var(--color-surface);
  }

  /* ============================================
     KUDOS STYLES - The Fun Stuff!
     ============================================ */

  /* Kudos Layout */
  .kudos-layout {
    display: grid;
    grid-template-columns: 400px 1fr;
    gap: var(--space-lg);
  }

  /* Give Kudos Card */
  .kudos-give-section {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .kudos-give-card {
    background: linear-gradient(135deg, #fff 0%, #fce4ec 100%);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    box-shadow: var(--shadow-md);
    border: 2px solid #f8bbd9;
  }

  .kudos-give-header {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
  }

  .kudos-header-icon {
    font-size: 48px;
    color: #e91e63;
    animation: wiggle 2s ease-in-out infinite;
  }

  @keyframes wiggle {
    0%, 100% { transform: rotate(-5deg); }
    50% { transform: rotate(5deg); }
  }

  .kudos-give-header h2 {
    margin: 0;
    font-size: var(--font-size-xl);
    color: #c2185b;
  }

  .kudos-give-header p {
    margin: 0;
    color: var(--color-text-secondary);
    font-size: var(--font-size-sm);
  }

  /* Category Picker */
  .kudos-category-picker {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-xs);
    margin-top: var(--space-xs);
  }

  .kudos-cat-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: var(--space-sm);
    background: white;
    border: 2px solid var(--color-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s ease;
    min-width: 70px;
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
  }

  .kudos-cat-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-sm);
  }

  .kudos-cat-btn.selected {
    border-color: #e91e63;
    background: #fce4ec;
    color: #c2185b;
  }

  .kudos-cat-btn .material-icons {
    font-size: 24px;
  }

  .kudos-cat-btn[data-category="teamwork"] .material-icons { color: #2196F3; }
  .kudos-cat-btn[data-category="innovation"] .material-icons { color: #FF9800; }
  .kudos-cat-btn[data-category="above_and_beyond"] .material-icons { color: #9C27B0; }
  .kudos-cat-btn[data-category="mentorship"] .material-icons { color: #4CAF50; }
  .kudos-cat-btn[data-category="delivery"] .material-icons { color: #00BCD4; }

  /* Message Textarea */
  #kudosMessage {
    resize: none;
    font-size: var(--font-size-md);
  }

  .char-count {
    text-align: right;
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
    margin-top: 4px;
  }

  /* Slack Option */
  .kudos-slack-option {
    margin-top: var(--space-sm);
  }

  .kudos-slack-checkbox {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-md);
    background: #4a154b;
    color: white;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: var(--font-size-sm);
    font-weight: 500;
    border: none;
  }

  .kudos-slack-checkbox:hover {
    background: #611f69;
  }

  .kudos-slack-checkbox input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #36c5f0;
  }

  .kudos-slack-checkbox .slack-icon {
    font-size: 18px;
    color: #36c5f0;
  }

  /* Send Button */
  .btn-kudos {
    width: 100%;
    padding: var(--space-md);
    background: linear-gradient(135deg, #e91e63, #c2185b);
    color: white;
    font-size: var(--font-size-md);
    font-weight: 600;
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
  }

  .btn-kudos:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(233, 30, 99, 0.4);
  }

  .btn-kudos:active {
    transform: translateY(0);
  }

  .btn-kudos.sending {
    opacity: 0.7;
    pointer-events: none;
  }

  /* Kudos Stats Card */
  .kudos-stats-card {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    box-shadow: var(--shadow-sm);
  }

  .kudos-stats-card h3 {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--font-size-md);
    margin: 0 0 var(--space-md) 0;
    color: var(--color-text);
  }

  .kudos-stats-card h3 .material-icons {
    color: #e91e63;
  }

  .kudos-mini-stats {
    display: flex;
    gap: var(--space-md);
    margin-bottom: var(--space-md);
  }

  .kudos-mini-stat {
    flex: 1;
    text-align: center;
    padding: var(--space-sm);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
  }

  .kudos-mini-stat .stat-num {
    display: block;
    font-size: var(--font-size-xl);
    font-weight: 700;
    color: #e91e63;
  }

  .kudos-mini-stat .stat-desc {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .kudos-top-recipients h4 {
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    margin: 0 0 var(--space-sm) 0;
  }

  .kudos-top-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .kudos-top-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-xs);
    font-size: var(--font-size-sm);
  }

  .kudos-top-item .rank {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #fce4ec;
    color: #c2185b;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--font-size-xs);
    font-weight: 700;
  }

  .kudos-top-item .rank.gold { background: #fff3cd; color: #856404; }
  .kudos-top-item .rank.silver { background: #e2e3e5; color: #495057; }
  .kudos-top-item .rank.bronze { background: #f5e0d3; color: #7c4a03; }

  /* Kudos Feed */
  .kudos-feed-section {
    background: var(--color-surface);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    box-shadow: var(--shadow-sm);
  }

  .kudos-feed-section .section-header {
    margin-bottom: var(--space-md);
  }

  .kudos-feed-section .section-header h2 {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
  }

  .kudos-feed-section .section-header h2 .material-icons {
    color: #e91e63;
  }

  .kudos-feed {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    max-height: 600px;
    overflow-y: auto;
  }

  /* Individual Kudos Card */
  .kudos-card {
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    transition: all 0.2s ease;
    position: relative;
    overflow: hidden;
  }

  .kudos-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
  }

  .kudos-card.cat-teamwork::before { background: #2196F3; }
  .kudos-card.cat-innovation::before { background: #FF9800; }
  .kudos-card.cat-above_and_beyond::before { background: #9C27B0; }
  .kudos-card.cat-mentorship::before { background: #4CAF50; }
  .kudos-card.cat-delivery::before { background: #00BCD4; }

  .kudos-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateX(4px);
  }

  .kudos-card-header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-sm);
  }

  .kudos-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #e91e63, #9c27b0);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: var(--font-size-sm);
  }

  .kudos-meta {
    flex: 1;
  }

  .kudos-names {
    font-weight: 600;
    color: var(--color-text);
  }

  .kudos-names .from { color: var(--color-text-secondary); }
  .kudos-names .to { color: #c2185b; }
  .kudos-names .arrow { color: var(--color-text-muted); margin: 0 4px; }

  .kudos-time {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .kudos-category-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: var(--font-size-xs);
    font-weight: 500;
  }

  .kudos-category-badge.teamwork { background: #e3f2fd; color: #1565c0; }
  .kudos-category-badge.innovation { background: #fff3e0; color: #ef6c00; }
  .kudos-category-badge.above_and_beyond { background: #f3e5f5; color: #7b1fa2; }
  .kudos-category-badge.mentorship { background: #e8f5e9; color: #2e7d32; }
  .kudos-category-badge.delivery { background: #e0f7fa; color: #00838f; }

  .kudos-category-badge .material-icons {
    font-size: 14px;
  }

  .kudos-message {
    font-size: var(--font-size-md);
    color: var(--color-text);
    line-height: 1.5;
    margin-top: var(--space-sm);
  }

  /* Empty state for kudos */
  .kudos-empty {
    text-align: center;
    padding: var(--space-xl);
    color: var(--color-text-muted);
  }

  .kudos-empty .material-icons {
    font-size: 64px;
    color: #f8bbd9;
    margin-bottom: var(--space-md);
  }

  /* Success animation */
  @keyframes kudos-success {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  .kudos-card.new {
    animation: kudos-success 0.5s ease;
    border-color: #e91e63;
    box-shadow: 0 0 20px rgba(233, 30, 99, 0.3);
  }

  /* ============================================
     PARKING LOT STYLES
     ============================================ */

  .parking-lot-layout {
    display: grid;
    grid-template-columns: 380px 1fr;
    gap: var(--space-lg);
  }

  .parking-lot-sidebar {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .parking-lot-add-card {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--color-border);
  }

  .parking-lot-add-header {
    display: flex;
    align-items: flex-start;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
  }

  .parking-lot-add-header > .material-icons {
    font-size: 32px;
    color: #FFC107;
    background: rgba(255, 193, 7, 0.15);
    padding: var(--space-sm);
    border-radius: var(--radius-md);
  }

  .parking-lot-add-header h2 {
    margin: 0 0 4px 0;
    font-size: var(--font-size-lg);
  }

  .parking-lot-add-header p {
    margin: 0;
    color: var(--color-text-muted);
    font-size: var(--font-size-sm);
  }

  /* Type Picker */
  .pl-type-picker {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-xs);
  }

  .pl-type-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: var(--space-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    background: var(--color-surface);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .pl-type-btn .material-icons {
    font-size: 20px;
    color: var(--color-text-muted);
  }

  .pl-type-btn span:last-child {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .pl-type-btn:hover {
    border-color: var(--color-primary);
    background: rgba(99, 102, 241, 0.05);
  }

  .pl-type-btn.selected {
    border-color: var(--color-primary);
    background: rgba(99, 102, 241, 0.1);
  }

  .pl-type-btn.selected .material-icons {
    color: var(--color-primary);
  }

  .pl-type-btn[data-type="idea"].selected { border-color: #FFC107; background: rgba(255, 193, 7, 0.1); }
  .pl-type-btn[data-type="idea"].selected .material-icons { color: #FFC107; }

  .pl-type-btn[data-type="discussion_topic"].selected { border-color: #2196F3; background: rgba(33, 150, 243, 0.1); }
  .pl-type-btn[data-type="discussion_topic"].selected .material-icons { color: #2196F3; }

  .pl-type-btn[data-type="stakeholder_connection"].selected { border-color: #4CAF50; background: rgba(76, 175, 80, 0.1); }
  .pl-type-btn[data-type="stakeholder_connection"].selected .material-icons { color: #4CAF50; }

  .pl-type-btn[data-type="follow_up"].selected { border-color: #FF5722; background: rgba(255, 87, 34, 0.1); }
  .pl-type-btn[data-type="follow_up"].selected .material-icons { color: #FF5722; }

  .pl-type-btn[data-type="process_suggestion"].selected { border-color: #9C27B0; background: rgba(156, 39, 176, 0.1); }
  .pl-type-btn[data-type="process_suggestion"].selected .material-icons { color: #9C27B0; }

  .pl-type-btn[data-type="random_info"].selected { border-color: #607D8B; background: rgba(96, 125, 139, 0.1); }
  .pl-type-btn[data-type="random_info"].selected .material-icons { color: #607D8B; }

  /* Stats Card */
  .parking-lot-stats-card {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--color-border);
  }

  .parking-lot-stats-card h3 {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin: 0 0 var(--space-md) 0;
    font-size: var(--font-size-md);
  }

  .parking-lot-stats-card h3 .material-icons {
    color: var(--color-text-muted);
  }

  .pl-mini-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-sm);
    text-align: center;
  }

  .pl-mini-stat {
    padding: var(--space-sm);
    background: var(--color-surface-alt);
    border-radius: var(--radius-sm);
  }

  .pl-mini-stat .stat-num {
    display: block;
    font-size: var(--font-size-xl);
    font-weight: 600;
    color: var(--color-text);
  }

  .pl-mini-stat .stat-desc {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .pl-mini-stat.stat-warning .stat-num {
    color: #FF5722;
  }

  /* Feed Section */
  .parking-lot-feed-section {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--color-border);
  }

  .parking-lot-feed-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-lg);
    flex-wrap: wrap;
    gap: var(--space-sm);
  }

  .parking-lot-feed-header h2 {
    margin: 0;
    font-size: var(--font-size-lg);
  }

  .pl-filters {
    display: flex;
    gap: var(--space-sm);
  }

  .pl-filters select {
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-sm);
    border: 1px solid var(--color-border);
    font-size: var(--font-size-sm);
  }

  .parking-lot-feed {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    max-height: 600px;
    overflow-y: auto;
  }

  /* Parking Lot Item Card */
  .pl-item-card {
    display: flex;
    gap: var(--space-md);
    padding: var(--space-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    background: var(--color-surface);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .pl-item-card:hover {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-sm);
  }

  .pl-item-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .pl-item-icon .material-icons {
    font-size: 20px;
    color: white;
  }

  .pl-item-icon.idea { background: #FFC107; }
  .pl-item-icon.discussion_topic { background: #2196F3; }
  .pl-item-icon.stakeholder_connection { background: #4CAF50; }
  .pl-item-icon.follow_up { background: #FF5722; }
  .pl-item-icon.process_suggestion { background: #9C27B0; }
  .pl-item-icon.random_info { background: #607D8B; }

  .pl-item-content {
    flex: 1;
    min-width: 0;
  }

  .pl-item-title {
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 4px;
  }

  .pl-item-description {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
    margin-bottom: var(--space-sm);
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .pl-item-meta {
    display: flex;
    gap: var(--space-md);
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .pl-item-meta span {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .pl-item-meta .material-icons {
    font-size: 14px;
  }

  .pl-item-badges {
    display: flex;
    flex-direction: column;
    gap: 4px;
    align-items: flex-end;
    flex-shrink: 0;
  }

  .pl-status-badge, .pl-priority-badge {
    padding: 2px 8px;
    border-radius: 12px;
    font-size: var(--font-size-xs);
    font-weight: 500;
  }

  .pl-status-badge {
    background: var(--color-surface-alt);
    color: var(--color-text-muted);
  }

  .pl-status-badge.new { background: #E3F2FD; color: #1976D2; }
  .pl-status-badge.discussed { background: #FFF3E0; color: #F57C00; }
  .pl-status-badge.assigned { background: #F3E5F5; color: #7B1FA2; }
  .pl-status-badge.in_progress { background: #E0F7FA; color: #00838F; }
  .pl-status-badge.resolved { background: #E8F5E9; color: #388E3C; }
  .pl-status-badge.archived { background: #ECEFF1; color: #546E7A; }

  .pl-priority-badge.high { background: #FFEBEE; color: #C62828; }
  .pl-priority-badge.medium { background: #FFF3E0; color: #EF6C00; }
  .pl-priority-badge.low { background: #E8F5E9; color: #2E7D32; }

  /* Detail Modal */
  .pl-detail-header {
    display: flex;
    gap: var(--space-sm);
    margin-bottom: var(--space-lg);
    flex-wrap: wrap;
  }

  .pl-type-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: var(--font-size-sm);
    font-weight: 500;
  }

  .pl-type-badge .material-icons {
    font-size: 16px;
  }

  .pl-type-badge.idea { background: rgba(255, 193, 7, 0.15); color: #F57F17; }
  .pl-type-badge.discussion_topic { background: rgba(33, 150, 243, 0.15); color: #1565C0; }
  .pl-type-badge.stakeholder_connection { background: rgba(76, 175, 80, 0.15); color: #2E7D32; }
  .pl-type-badge.follow_up { background: rgba(255, 87, 34, 0.15); color: #D84315; }
  .pl-type-badge.process_suggestion { background: rgba(156, 39, 176, 0.15); color: #7B1FA2; }
  .pl-type-badge.random_info { background: rgba(96, 125, 139, 0.15); color: #455A64; }

  .pl-detail-content {
    margin-bottom: var(--space-lg);
  }

  .pl-detail-description {
    padding: var(--space-md);
    background: var(--color-surface-alt);
    border-radius: var(--radius-md);
    margin-bottom: var(--space-md);
    white-space: pre-wrap;
  }

  .pl-detail-meta {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .pl-meta-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  .pl-meta-item .material-icons {
    font-size: 18px;
    color: var(--color-text-muted);
  }

  .pl-detail-notes {
    margin-top: var(--space-md);
    padding-top: var(--space-md);
    border-top: 1px solid var(--color-border);
  }

  .pl-detail-notes h4 {
    margin: 0 0 var(--space-sm) 0;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  .pl-notes-content {
    padding: var(--space-md);
    background: var(--color-surface-alt);
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    white-space: pre-wrap;
    max-height: 150px;
    overflow-y: auto;
  }

  .pl-detail-actions {
    padding-top: var(--space-md);
    border-top: 1px solid var(--color-border);
  }

  .pl-detail-actions h4 {
    margin: 0 0 var(--space-md) 0;
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  .pl-note-input {
    display: flex;
    gap: var(--space-sm);
  }

  .pl-note-input input {
    flex: 1;
  }

  .pl-empty-state {
    text-align: center;
    padding: var(--space-xl);
    color: var(--color-text-muted);
  }

  .pl-empty-state .material-icons {
    font-size: 48px;
    margin-bottom: var(--space-md);
    opacity: 0.5;
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .team-grid { grid-template-columns: 1fr; }
    .kudos-layout { grid-template-columns: 1fr; }
    .parking-lot-layout { grid-template-columns: 1fr; }
  }
  @media (max-width: 768px) {
    .stats-row { grid-template-columns: repeat(2, 1fr); }
    .weekly-grid { grid-template-columns: repeat(3, 1fr); }
    .form-row { grid-template-columns: 1fr; }
    .kudos-category-picker { justify-content: center; }
    .pl-type-picker { grid-template-columns: repeat(2, 1fr); }
  }

  /* ============================================
     ACTIONS VIEW STYLES
     ============================================ */
  .actions-subheader {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-md);
  }

  .actions-view-toggle {
    display: flex;
    gap: var(--space-xs);
  }

  .actions-view-toggle .view-btn {
    padding: var(--space-xs) var(--space-sm);
    font-size: var(--font-size-sm);
  }

  .actions-filters {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
    flex-wrap: wrap;
  }

  .filter-chips {
    display: flex;
    gap: var(--space-xs);
  }

  .chip {
    padding: var(--space-xs) var(--space-md);
    border: 1px solid var(--color-border);
    background: var(--color-surface);
    border-radius: 20px;
    font-size: var(--font-size-sm);
    font-weight: 500;
    color: var(--color-text-secondary);
    cursor: pointer;
    transition: all 0.2s;
  }

  .chip:hover {
    border-color: var(--color-border-dark);
    color: var(--color-text);
  }

  .chip.active {
    background: var(--color-text);
    border-color: var(--color-text);
    color: white;
  }

  .filter-search {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-xs) var(--space-md);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    flex: 1;
    max-width: 300px;
  }

  .filter-search .material-icons {
    font-size: 18px;
    color: var(--color-text-muted);
  }

  .filter-search input {
    border: none;
    outline: none;
    font-size: var(--font-size-sm);
    width: 100%;
    background: transparent;
  }

  .actions-filters select {
    padding: var(--space-xs) var(--space-md);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
    background: var(--color-surface);
    color: var(--color-text);
    cursor: pointer;
  }

  .actions-content {
    min-height: 300px;
  }

  /* Assignee View */
  .assignee-view {
    display: none;
  }

  .assignee-view.active {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: var(--space-md);
  }

  .assignee-section {
    background: var(--color-gray-50);
    border-radius: var(--radius-md);
    overflow: hidden;
  }

  .assignee-header {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-md);
    background: var(--color-surface);
    border-bottom: 1px solid var(--color-border);
    cursor: pointer;
    user-select: none;
  }

  .assignee-header:hover {
    background: var(--color-gray-50);
  }

  .assignee-toggle {
    font-size: 20px;
    color: var(--color-text-muted);
    transition: transform 0.2s;
  }

  .assignee-section.collapsed .assignee-toggle {
    transform: rotate(-90deg);
  }

  .assignee-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: linear-gradient(135deg, #6366f1, #8b5cf6);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: var(--font-size-sm);
    flex-shrink: 0;
  }

  .assignee-name {
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--color-text);
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .assignee-count {
    background: #eef2ff;
    color: #4f46e5;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: var(--font-size-xs);
    font-weight: 600;
    flex-shrink: 0;
  }

  .assignee-actions {
    display: flex;
    flex-direction: column;
    gap: 1px;
    background: var(--color-border);
    max-height: 400px;
    overflow-y: auto;
  }

  .assignee-section.collapsed .assignee-actions {
    display: none;
  }

  /* Action Row */
  .action-row {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-md);
    background: var(--color-surface);
    cursor: pointer;
    transition: all 0.15s;
  }

  .action-row:hover {
    background: var(--color-gray-50);
  }

  .action-status {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .status-dot.pending { background: #f59e0b; }
  .status-dot.not-started { background: #94a3b8; }
  .status-dot.in-progress { background: #3b82f6; }
  .status-dot.done { background: #10b981; }

  .status-text {
    font-size: var(--font-size-xs);
    font-weight: 500;
    color: var(--color-text-secondary);
    text-transform: capitalize;
  }

  .action-task {
    font-size: var(--font-size-sm);
    color: var(--color-text);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .action-row-meta {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    flex-wrap: wrap;
  }

  .action-source {
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .action-solution {
    font-size: 10px;
    font-weight: 600;
    padding: 2px 6px;
    border-radius: 4px;
    background: var(--color-gray-100);
    color: var(--color-text-secondary);
    white-space: nowrap;
  }

  .action-solution.is-solution {
    background: #dbeafe;
    color: #1d4ed8;
  }

  /* Status/Kanban View */
  .status-view {
    display: none;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-md);
  }

  .status-view.active {
    display: grid;
  }

  .kanban-column {
    background: var(--color-gray-50);
    border-radius: var(--radius-md);
    padding: var(--space-md);
    min-height: 400px;
  }

  .column-header {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    margin-bottom: var(--space-md);
    font-size: var(--font-size-sm);
    font-weight: 600;
    color: var(--color-text);
  }

  .column-header .dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
  }

  .dot.pending { background: #f59e0b; }
  .dot.not-started { background: #94a3b8; }
  .dot.in-progress { background: #3b82f6; }
  .dot.done { background: #10b981; }

  .column-header .count {
    margin-left: auto;
    background: var(--color-surface);
    padding: 2px 8px;
    border-radius: 10px;
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
  }

  .column-cards {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }

  .kanban-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: var(--space-sm);
    cursor: pointer;
    transition: all 0.2s;
  }

  .kanban-card:hover {
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
  }

  .kanban-card .task {
    font-size: var(--font-size-sm);
    color: var(--color-text);
    line-height: 1.5;
    margin-bottom: var(--space-sm);
  }

  .kanban-card .meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: var(--font-size-xs);
    color: var(--color-text-muted);
  }

  .kanban-card .owner {
    font-weight: 500;
    color: var(--color-text-secondary);
  }

  /* Drawer */
  .drawer-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.3);
    z-index: 1000;
  }

  .drawer-overlay.active {
    display: block;
  }

  .drawer {
    position: fixed;
    top: 0;
    right: 0;
    width: 480px;
    max-width: 100%;
    height: 100%;
    background: var(--color-surface);
    box-shadow: -4px 0 24px rgba(0,0,0,0.15);
    display: flex;
    flex-direction: column;
  }

  .drawer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-md) var(--space-lg);
    border-bottom: 1px solid var(--color-border);
  }

  .drawer-header h3 {
    font-size: var(--font-size-lg);
    font-weight: 600;
    color: var(--color-text);
    margin: 0;
  }

  .drawer-body {
    flex: 1;
    padding: var(--space-lg);
    overflow-y: auto;
  }

  .detail-field {
    margin-bottom: var(--space-md);
  }

  .detail-field label {
    display: block;
    font-size: var(--font-size-xs);
    font-weight: 500;
    color: var(--color-text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: var(--space-xs);
  }

  .detail-field .value {
    font-size: var(--font-size-md);
    color: var(--color-text);
    line-height: 1.6;
  }

  .status-buttons {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-sm);
    margin-top: var(--space-lg);
    padding-top: var(--space-lg);
    border-top: 1px solid var(--color-border);
  }

  .status-btn {
    padding: var(--space-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    background: var(--color-surface);
    font-size: var(--font-size-sm);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-xs);
  }

  .status-btn:hover {
    background: var(--color-gray-50);
  }

  .status-btn.active {
    background: var(--color-text);
    color: white;
    border-color: var(--color-text);
  }

  .status-btn.success {
    background: #10b981;
    color: white;
    border-color: #10b981;
  }

  .btn-icon {
    background: none;
    border: none;
    padding: var(--space-xs);
    cursor: pointer;
    color: var(--color-text-muted);
    border-radius: var(--radius-sm);
  }

  .btn-icon:hover {
    background: var(--color-gray-100);
    color: var(--color-text);
  }

  .assignee-field {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }

  .btn-reassign {
    background: transparent;
    border: none;
    padding: 4px;
    cursor: pointer;
    color: var(--color-text-muted);
    border-radius: 4px;
    display: flex;
    align-items: center;
  }

  .btn-reassign:hover {
    background: var(--color-gray-100);
    color: var(--color-primary);
  }

  .btn-reassign .material-icons {
    font-size: 16px;
  }

  .reassign-form {
    margin-top: var(--space-sm);
    padding: var(--space-sm);
    background: var(--color-gray-50);
    border-radius: var(--radius-sm);
    border: 1px solid var(--color-border);
  }

  .reassign-form input[type="text"] {
    width: 100%;
    padding: var(--space-xs) var(--space-sm);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    font-size: var(--font-size-sm);
  }

  .reassign-buttons {
    display: flex;
    gap: var(--space-xs);
    margin-top: var(--space-sm);
    justify-content: flex-end;
  }

  @media (max-width: 1200px) {
    .status-view { grid-template-columns: repeat(2, 1fr); }
  }

  @media (max-width: 768px) {
    .status-view { grid-template-columns: 1fr; }
    .actions-filters { flex-direction: column; align-items: stretch; }
    .filter-search { max-width: none; }
  }
</style>

<!-- Team Page JavaScript -->
<script>
  // Local error handler for this page
  function handleError(error) {
    console.error('Team page error:', error);
  }

  // escapeHtml() and escapeAttr() - use globals from index.html

  var Team = {
    members: [],
    meetings: [],
    availability: [],
    editingAvailabilityId: null,
    documents: [],
    kudos: [],
    kudosStats: null,
    selectedKudosCategory: null,
    currentView: 'overview',
    // Actions state
    actionsData: [],
    filteredActions: [],
    actionsSubview: 'assignee',
    actionsFilter: 'open',
    currentAction: null,
    editingActionId: null,
    collapsedAssignees: {},

    init: function() {
      this.loadData();
      this.setupKudosForm();
      this.loadCurrentUser();
    },

    loadCurrentUser: function() {
      google.script.run
        .withSuccessHandler(function(user) {
          window.currentUserName = user.name || 'Anonymous';
          // If user has a name, we can personalize the kudos form
          if (user.name) {
            var header = document.querySelector('.kudos-give-header p');
            if (header) {
              header.textContent = 'Hey ' + user.firstName + '! Recognize a teammate for their awesome work';
            }
          }
        })
        .withFailureHandler(function(error) {
          console.error('Could not load user info:', error);
          window.currentUserName = 'Anonymous';
        })
        .getCurrentUserInfo();

      // Check if Slack is configured
      google.script.run
        .withSuccessHandler(function(isConfigured) {
          if (isConfigured) {
            var slackGroup = document.getElementById('slackOptionGroup');
            if (slackGroup) slackGroup.style.display = '';
          }
        })
        .withFailureHandler(function() {
          // Slack not configured, keep hidden
        })
        .isSlackConfigured();
    },

    loadData: function() {
      // Load team members with profiles
      google.script.run
        .withSuccessHandler(function(data) {
          Team.members = data || [];
          Team.renderTeamProfiles();
          Team.updateStats();
          Team.populatePersonSelect();
        })
        .withFailureHandler(handleError)
        .getInternalTeamWithProfiles();

      // Load meetings
      google.script.run
        .withSuccessHandler(function(data) {
          Team.meetings = data || [];
          Team.renderMeetings();
          Team.updateStats();
        })
        .withFailureHandler(handleError)
        .getAllMeetings();

      // Load availability
      google.script.run
        .withSuccessHandler(function(data) {
          Team.availability = data || [];
          Team.renderAvailability();
          Team.updateStats();
        })
        .withFailureHandler(handleError)
        .getAvailability();

      // Load directing documents
      google.script.run
        .withSuccessHandler(function(data) {
          Team.documents = data || [];
          Team.renderDocuments();
          Team.updateStats();
        })
        .withFailureHandler(handleError)
        .getDirectingDocuments();

      // Load kudos
      this.loadKudos();
    },

    loadKudos: function() {
      // Load recent kudos
      google.script.run
        .withSuccessHandler(function(data) {
          Team.kudos = data || [];
          Team.renderKudosFeed();
          Team.updateStats();
        })
        .withFailureHandler(handleError)
        .getAllKudos({ days: 30, limit: 50 });

      // Load kudos stats
      google.script.run
        .withSuccessHandler(function(data) {
          Team.kudosStats = data;
          Team.renderKudosStats();
        })
        .withFailureHandler(handleError)
        .getKudosStats(90);
    },

    setupKudosForm: function() {
      // Character counter for message
      var messageInput = document.getElementById('kudosMessage');
      var charCount = document.getElementById('kudosCharCount');
      if (messageInput && charCount) {
        messageInput.addEventListener('input', function() {
          charCount.textContent = this.value.length;
          if (this.value.length > 280) {
            charCount.style.color = '#c62828';
          } else {
            charCount.style.color = '';
          }
        });
      }
    },

    selectKudosCategory: function(category) {
      this.selectedKudosCategory = category;
      document.getElementById('kudosCategory').value = category;

      // Update button states
      document.querySelectorAll('.kudos-cat-btn').forEach(function(btn) {
        btn.classList.remove('selected');
      });
      document.querySelector('.kudos-cat-btn[data-category="' + category + '"]').classList.add('selected');
    },

    submitKudos: function() {
      var recipientSelect = document.getElementById('kudosRecipient');
      var category = document.getElementById('kudosCategory').value;
      var message = document.getElementById('kudosMessage').value.trim();

      // Validation
      if (!recipientSelect.value) {
        alert('Please select a teammate!');
        return;
      }
      if (!category) {
        alert('Please pick a category!');
        return;
      }
      if (!message) {
        alert('Please write a message!');
        return;
      }
      if (message.length > 280) {
        alert('Message is too long! Keep it under 280 characters.');
        return;
      }

      var selectedOption = recipientSelect.options[recipientSelect.selectedIndex];
      var toName = selectedOption.textContent;

      // Get current user info (from session or prompt)
      var fromName = window.currentUserName || 'Anonymous';

      // Check if Slack posting is enabled
      var postToSlack = document.getElementById('kudosPostToSlack');
      var shouldPostToSlack = postToSlack && postToSlack.checked;

      var btn = document.querySelector('.btn-kudos');
      btn.classList.add('sending');
      btn.innerHTML = '<span class="material-icons">hourglass_empty</span> Sending...';

      var data = {
        from_name: fromName,
        to_name: toName,
        message: message,
        category: category,
        post_to_slack: shouldPostToSlack
      };

      google.script.run
        .withSuccessHandler(function(result) {
          btn.classList.remove('sending');
          btn.innerHTML = '<span class="material-icons">check</span> Sent!';

          // Celebrate!
          Team.celebrate();

          // Add new kudos to top of feed with animation
          Team.kudos.unshift(result);
          Team.renderKudosFeed();

          // Highlight the new kudos
          setTimeout(function() {
            var firstCard = document.querySelector('.kudos-card');
            if (firstCard) firstCard.classList.add('new');
          }, 100);

          // Reset form after delay
          setTimeout(function() {
            btn.innerHTML = '<span class="material-icons">send</span> Send Kudos!';
            document.getElementById('kudosForm').reset();
            document.querySelectorAll('.kudos-cat-btn').forEach(function(b) { b.classList.remove('selected'); });
            Team.selectedKudosCategory = null;
            document.getElementById('kudosCharCount').textContent = '0';
          }, 2000);

          // Reload stats
          Team.loadKudos();
        })
        .withFailureHandler(function(error) {
          btn.classList.remove('sending');
          btn.innerHTML = '<span class="material-icons">send</span> Send Kudos!';
          alert('Failed to send kudos: ' + (error.message || error));
        })
        .submitKudos(data);
    },

    renderKudosFeed: function() {
      var container = document.getElementById('kudosFeed');
      if (!this.kudos.length) {
        container.innerHTML = '<div class="kudos-empty">' +
          '<span class="material-icons">emoji_events</span>' +
          '<p>No kudos yet!</p>' +
          '<p>Be the first to recognize a teammate.</p>' +
        '</div>';
        return;
      }

      var categoryIcons = {
        'teamwork': 'group',
        'innovation': 'lightbulb',
        'above_and_beyond': 'star',
        'mentorship': 'school',
        'delivery': 'check_circle'
      };

      var categoryNames = {
        'teamwork': 'Teamwork',
        'innovation': 'Innovation',
        'above_and_beyond': 'Above & Beyond',
        'mentorship': 'Mentorship',
        'delivery': 'Delivery'
      };

      var html = this.kudos.map(function(k) {
        var toInitials = (k.to_name || '??').split(' ').map(function(n) { return n.charAt(0); }).join('').toUpperCase();
        var timeAgo = Team.timeAgo(k.created_at);
        var catIcon = categoryIcons[k.category] || 'star';
        var catName = categoryNames[k.category] || k.category;

        return '<div class="kudos-card cat-' + k.category + '">' +
          '<div class="kudos-card-header">' +
            '<div class="kudos-avatar">' + toInitials + '</div>' +
            '<div class="kudos-meta">' +
              '<div class="kudos-names">' +
                '<span class="from">' + Team.escapeHtml(k.from_name) + '</span>' +
                '<span class="arrow">&rarr;</span>' +
                '<span class="to">' + Team.escapeHtml(k.to_name) + '</span>' +
              '</div>' +
              '<div class="kudos-time">' + timeAgo + '</div>' +
            '</div>' +
            '<span class="kudos-category-badge ' + k.category + '">' +
              '<span class="material-icons">' + catIcon + '</span>' +
              catName +
            '</span>' +
          '</div>' +
          '<div class="kudos-message">' + Team.escapeHtml(k.message) + '</div>' +
        '</div>';
      }).join('');

      container.innerHTML = html;
    },

    renderKudosStats: function() {
      if (!this.kudosStats) return;

      document.getElementById('kudosThisQuarter').textContent = this.kudosStats.total || 0;

      // Calculate this month from the kudos array
      var thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
      var thisMonth = this.kudos.filter(function(k) {
        return new Date(k.created_at) >= thirtyDaysAgo;
      }).length;
      document.getElementById('kudosThisMonth').textContent = thisMonth;

      // Top recipients
      var topContainer = document.getElementById('kudosTopRecipients');
      if (this.kudosStats.top_recipients && this.kudosStats.top_recipients.length > 0) {
        var html = '<h4>Top Kudos Recipients</h4><div class="kudos-top-list">';
        this.kudosStats.top_recipients.slice(0, 5).forEach(function(r, i) {
          var rankClass = i === 0 ? 'gold' : (i === 1 ? 'silver' : (i === 2 ? 'bronze' : ''));
          html += '<div class="kudos-top-item">' +
            '<span class="rank ' + rankClass + '">' + (i + 1) + '</span>' +
            '<span style="flex:1;">' + Team.escapeHtml(r.name) + '</span>' +
            '<span style="color:#e91e63;font-weight:600;">' + r.count + '</span>' +
          '</div>';
        });
        html += '</div>';
        topContainer.innerHTML = html;
      } else {
        topContainer.innerHTML = '<p class="text-muted text-sm">No kudos data yet</p>';
      }
    },

    filterKudosFeed: function(value) {
      var options = {};
      if (value === 'quarter') {
        options.quarter = this.kudosStats ? this.kudosStats.current_quarter : '';
      } else if (value !== 'all') {
        options.days = parseInt(value);
      }
      options.limit = 50;

      google.script.run
        .withSuccessHandler(function(data) {
          Team.kudos = data || [];
          Team.renderKudosFeed();
        })
        .withFailureHandler(handleError)
        .getAllKudos(options);
    },

    // Confetti celebration!
    celebrate: function() {
      var canvas = document.getElementById('confettiCanvas');
      canvas.style.display = 'block';
      var ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      var particles = [];
      var colors = ['#e91e63', '#9c27b0', '#2196f3', '#4caf50', '#ff9800', '#00bcd4', '#ffeb3b'];

      // Create particles
      for (var i = 0; i < 150; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height - canvas.height,
          r: Math.random() * 6 + 4,
          d: Math.random() * 150 + 50,
          color: colors[Math.floor(Math.random() * colors.length)],
          tilt: Math.floor(Math.random() * 10) - 10,
          tiltAngle: 0,
          tiltAngleIncrement: Math.random() * 0.07 + 0.05
        });
      }

      var animationFrame;
      var frameCount = 0;

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        frameCount++;

        particles.forEach(function(p, i) {
          ctx.beginPath();
          ctx.lineWidth = p.r / 2;
          ctx.strokeStyle = p.color;
          ctx.moveTo(p.x + p.tilt + p.r / 4, p.y);
          ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 4);
          ctx.stroke();

          p.tiltAngle += p.tiltAngleIncrement;
          p.y += (Math.cos(p.d) + 3 + p.r / 2) / 2;
          p.x += Math.sin(0);
          p.tilt = Math.sin(p.tiltAngle) * 15;

          if (p.y > canvas.height) {
            particles[i] = {
              x: Math.random() * canvas.width,
              y: -10,
              r: p.r,
              d: p.d,
              color: p.color,
              tilt: p.tilt,
              tiltAngle: p.tiltAngle,
              tiltAngleIncrement: p.tiltAngleIncrement
            };
          }
        });

        if (frameCount < 180) {
          animationFrame = requestAnimationFrame(draw);
        } else {
          cancelAnimationFrame(animationFrame);
          canvas.style.display = 'none';
        }
      }

      draw();
    },

    timeAgo: function(dateString) {
      var date = new Date(dateString);
      var now = new Date();
      var seconds = Math.floor((now - date) / 1000);

      var interval = Math.floor(seconds / 31536000);
      if (interval >= 1) return interval + ' year' + (interval > 1 ? 's' : '') + ' ago';

      interval = Math.floor(seconds / 2592000);
      if (interval >= 1) return interval + ' month' + (interval > 1 ? 's' : '') + ' ago';

      interval = Math.floor(seconds / 86400);
      if (interval >= 1) return interval + ' day' + (interval > 1 ? 's' : '') + ' ago';

      interval = Math.floor(seconds / 3600);
      if (interval >= 1) return interval + ' hour' + (interval > 1 ? 's' : '') + ' ago';

      interval = Math.floor(seconds / 60);
      if (interval >= 1) return interval + ' minute' + (interval > 1 ? 's' : '') + ' ago';

      return 'Just now';
    },

    escapeHtml: function(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
    },

    setView: function(view) {
      this.currentView = view;

      // Update view buttons
      document.querySelectorAll('.view-btn').forEach(function(btn) {
        btn.classList.remove('active');
      });
      document.querySelector('[data-view="' + view + '"]').classList.add('active');

      // Show/hide view panels
      document.querySelectorAll('.view-panel').forEach(function(panel) {
        panel.classList.remove('active');
      });
      document.getElementById(view + 'View').classList.add('active');

      // Update add button label based on view
      var addBtn = document.getElementById('addEntryBtn');
      var addLabel = document.getElementById('addEntryLabel');
      if (view === 'overview') {
        addBtn.style.display = '';
        addLabel.textContent = 'Add Availability';
      } else if (view === 'meetings') {
        addBtn.style.display = '';
        addLabel.textContent = 'Add Meeting';
      } else if (view === 'actions') {
        addBtn.style.display = 'none'; // Actions has its own add button in subheader
        // Load actions data if not already loaded
        if (Team.actionsData.length === 0) {
          Team.loadActions();
        }
      } else if (view === 'kudos') {
        addBtn.style.display = 'none'; // Kudos has inline form
      } else if (view === 'parkingLot') {
        addBtn.style.display = 'none'; // Parking Lot has inline form
        // Load parking lot data if not already loaded
        if (Team.parkingLotItems.length === 0) {
          Team.loadParkingLot();
        }
      } else {
        addBtn.style.display = 'none'; // Hide for documents view
      }
    },

    // Toggle form fields based on availability type
    toggleFormFields: function() {
      var typeSelect = document.getElementById('availTypeSelect');
      var personGroup = document.getElementById('personSelectGroup');
      var personSelect = document.getElementById('availPersonSelect');
      var holidayNameGroup = document.getElementById('holidayNameGroup');
      var partnersGroup = document.getElementById('partnersGroup');
      var locationGroup = document.getElementById('locationGroup');
      var recurrenceSelect = document.getElementById('availRecurrence');
      var selectedType = typeSelect.value;

      var officeWideTypes = ['holiday', 'special_event'];
      var isOfficeWide = officeWideTypes.indexOf(selectedType) !== -1;
      var isHoliday = selectedType === 'holiday';

      // Person select: hide for office-wide types
      if (isOfficeWide) {
        personGroup.classList.add('hidden');
        personSelect.removeAttribute('required');
        personSelect.value = '';
      } else {
        personGroup.classList.remove('hidden');
        personSelect.setAttribute('required', 'required');
      }

      // Holiday name and partners: show only for holidays
      if (isHoliday) {
        holidayNameGroup.classList.remove('hidden');
        partnersGroup.classList.remove('hidden');
        locationGroup.classList.add('hidden');
        // Default to annually for holidays
        recurrenceSelect.value = 'annually';
      } else {
        holidayNameGroup.classList.add('hidden');
        partnersGroup.classList.add('hidden');
        locationGroup.classList.remove('hidden');
        // Reset to none for non-holidays (unless already set)
        if (recurrenceSelect.value === 'annually') {
          recurrenceSelect.value = 'none';
        }
      }
    },

    renderTeamProfiles: function() {
      var container = document.getElementById('teamProfilesGrid');
      if (!container) {
        // SPA navigation - elements no longer exist
        return;
      }
      if (!this.members.length) {
        container.innerHTML = '<p class="text-muted">No team members found</p>';
        return;
      }

      var html = this.members.map(function(member) {
        var initials = (member.first_name || '').charAt(0) + (member.last_name || '').charAt(0);
        var teamClass = escapeAttr((member.internal_team || '').replace(/\s+/g, ''));
        var profileIndicator = member.has_profile ? '<span class="profile-badge" title="View About Me"><span class="material-icons">person</span></span>' : '';

        return '<div class="team-card' + (member.has_profile ? ' has-profile' : '') + '" onclick="Team.showMemberDetail(\'' + escapeAttr(member.contact_id) + '\')">' +
          profileIndicator +
          '<div class="avatar">' + escapeHtml(initials.toUpperCase()) + '</div>' +
          '<div class="name">' + escapeHtml(member.first_name || '') + ' ' + escapeHtml(member.last_name || '') + '</div>' +
          '<div class="title">' + escapeHtml(member.internal_title || '') + '</div>' +
          '<span class="team-badge ' + teamClass + '">' + escapeHtml(member.internal_team || '') + '</span>' +
        '</div>';
      }).join('');

      container.innerHTML = html;
    },

    filterTeam: function(team) {
      var cards = document.querySelectorAll('.team-card');
      cards.forEach(function(card) {
        var badge = card.querySelector('.team-badge');
        if (team === 'all' || (badge && badge.textContent === team)) {
          card.style.display = '';
        } else {
          card.style.display = 'none';
        }
      });
    },

    // Map type codes to display labels
    typeLabels: {
      'vacation': 'Vacation',
      'work_travel': 'Travel',
      'ooo': 'OOO',
      '9_80': '9/80',
      'holiday': 'Holiday',
      'special_event': 'Event'
    },

    // Map recurrence codes to icons/labels
    recurrenceLabels: {
      'weekly': 'Weekly',
      'biweekly': 'Bi-weekly',
      'monthly': 'Monthly',
      'annually': 'Annual'
    },

    // Parse date string as local time (avoids UTC timezone shift)
    parseLocalDate: function(dateStr) {
      if (!dateStr) return null;
      // Remove any time portion and parse as local date
      var datePart = String(dateStr).split('T')[0];
      var parts = datePart.split('-');
      if (parts.length === 3) {
        return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
      }
      // Fallback: add time to force local interpretation
      return new Date(datePart + 'T12:00:00');
    },

    // Format date to human-friendly format (e.g., "Jan 15" or "Jan 15 - 20" or "Jan 15 - Feb 2")
    formatDateRange: function(startDateStr, endDateStr) {
      var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      var start = this.parseLocalDate(startDateStr);
      var end = this.parseLocalDate(endDateStr);

      var startMonth = months[start.getMonth()];
      var startDay = start.getDate();
      var endMonth = months[end.getMonth()];
      var endDay = end.getDate();

      // Same day
      if (startDateStr === endDateStr) {
        return startMonth + ' ' + startDay;
      }

      // Same month
      if (start.getMonth() === end.getMonth() && start.getFullYear() === end.getFullYear()) {
        return startMonth + ' ' + startDay + ' - ' + endDay;
      }

      // Different months
      return startMonth + ' ' + startDay + ' - ' + endMonth + ' ' + endDay;
    },

    renderAvailability: function() {
      var container = document.getElementById('availabilityList');
      if (!container) {
        // SPA navigation - elements no longer exist
        return;
      }
      if (!this.availability.length) {
        container.innerHTML = '<p class="text-muted">No upcoming availability entries</p>';
        return;
      }

      // Filter out past dates and sort by start date
      var today = new Date();
      today.setHours(0, 0, 0, 0);

      var self = this;
      var filtered = this.availability.filter(function(item) {
        var endDate = self.parseLocalDate(item.end_date || item.start_date);
        if (endDate) endDate.setHours(23, 59, 59, 999);
        return endDate && endDate >= today;
      });

      if (!filtered.length) {
        container.innerHTML = '<p class="text-muted">No upcoming availability entries</p>';
        return;
      }

      var sorted = filtered.sort(function(a, b) {
        return self.parseLocalDate(a.start_date) - self.parseLocalDate(b.start_date);
      });

      var self = this;
      var html = sorted.map(function(item) {
        var typeClass = (item.type || '').replace(/\s+/g, '_').replace('9_80', 'nine_80');
        var typeLabel = self.typeLabels[item.type] || item.type || '';
        var dateStr = self.formatDateRange(item.start_date, item.end_date);

        // For office-wide events, show differently
        var officeWideTypes = ['holiday', 'special_event'];
        var isOfficeWide = officeWideTypes.indexOf(item.type) !== -1;
        var isHoliday = item.type === 'holiday';
        // Use holiday_name for holidays, notes for special events, contact_name for personal
        var nameDisplay = isHoliday
          ? (item.holiday_name || item.notes || 'Holiday')
          : (isOfficeWide ? (item.notes || 'Office Event') : (item.contact_name || ''));

        // Build partner tags for holidays
        var partnerHtml = '';
        if (isHoliday && item.partners) {
          var partners = item.partners.split(',').map(function(p) { return p.trim(); }).filter(function(p) { return p; });
          if (partners.length > 0) {
            partnerHtml = '<span class="partner-tags">' +
              partners.map(function(p) { return '<span class="partner-tag">' + p + '</span>'; }).join('') +
            '</span>';
          }
        }

        // Recurrence indicator
        var recurrenceHtml = '';
        if (item.recurrence && item.recurrence !== 'none') {
          var recLabel = self.recurrenceLabels[item.recurrence] || item.recurrence;
          recurrenceHtml = '<span class="recurrence-icon" title="' + recLabel + '"></span>';
        }

        // Notes display (for non-holiday items that have notes)
        var notesHtml = '';
        if (!isHoliday && item.notes) {
          notesHtml = '<span class="avail-notes">' + item.notes + '</span>';
        }

        // Make clickable for editing (not holidays)
        var clickAttr = !isHoliday ? ' onclick="Team.editAvailability(\'' + item.availability_id + '\')" style="cursor: pointer;"' : '';

        return '<div class="availability-item"' + clickAttr + '>' +
          '<span class="avail-type-badge ' + typeClass + '">' + typeLabel + '</span>' +
          '<span class="avail-name">' + nameDisplay + '</span>' +
          partnerHtml +
          '<span class="avail-dates">' + dateStr + recurrenceHtml + '</span>' +
          (item.location && !isOfficeWide ? '<span class="avail-location">(' + item.location + ')</span>' : '') +
          notesHtml +
        '</div>';
      }).join('');

      container.innerHTML = html;
    },

    renderMeetings: function() {
      // Guard against SPA navigation - elements may not exist
      var listContainer = document.getElementById('meetingsList');
      if (!listContainer) {
        // SPA navigation - elements no longer exist
        return;
      }

      // Render weekly grid
      var days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
      days.forEach(function(day) {
        var container = document.getElementById('meetings' + day);
        if (!container) return;

        var dayMeetings = Team.meetings.filter(function(m) {
          return m.day_of_week === day && m.is_active;
        });

        if (!dayMeetings.length) {
          container.innerHTML = '<p class="text-muted text-sm">No meetings</p>';
          return;
        }

        var html = dayMeetings.map(function(m) {
          var cadenceText = m.cadence && m.cadence.toLowerCase() !== 'weekly' ? ' <span class="meeting-cadence">(' + m.cadence + ')</span>' : '';
          return '<div class="meeting-chip" onclick="Team.showMeetingDetail(\'' + m.meeting_id + '\')">' +
            '<span class="meeting-time">' + (m.time || 'TBD') + '</span>' +
            '<span class="meeting-name">' + m.name + cadenceText + '</span>' +
          '</div>';
        }).join('');

        container.innerHTML = html;
      });

      // Render meetings list
      var html = this.meetings.map(function(m) {
        return '<div class="meeting-row" id="meeting-' + m.meeting_id + '">' +
          '<div class="meeting-row-header" onclick="Team.toggleMeetingRow(\'' + m.meeting_id + '\')">' +
            '<span class="material-icons">chevron_right</span>' +
            '<span class="meeting-name-col" style="flex:1;font-weight:600;">' + m.name + '</span>' +
            '<span class="category-badge ' + m.category + '">' + m.category + '</span>' +
            '<span class="type-badge">' + m.type + '</span>' +
            '<span style="width:100px;text-align:right;">' + (m.cadence || '') + '</span>' +
          '</div>' +
          '<div class="meeting-row-details">' +
            '<div class="meeting-meta">' +
              '<div class="meeting-meta-item"><span class="material-icons">schedule</span>' + (m.day_of_week || 'TBD') + ' ' + (m.time || '') + '</div>' +
              '<div class="meeting-meta-item"><span class="material-icons">repeat</span>' + (m.cadence || '') + '</div>' +
              '<div class="meeting-meta-item"><span class="material-icons">schedule</span>' + (m.duration_minutes || 60) + ' min</div>' +
            '</div>' +
            '<p><strong>Purpose:</strong> ' + (m.purpose || 'Not specified') + '</p>' +
            (m.online_link ? '<p><a href="' + m.online_link + '" target="_blank">Join Online</a></p>' : '') +
            (m.drive_folder_url ? '<p><a href="' + m.drive_folder_url + '" target="_blank">Drive Folder</a></p>' : '') +
            '<div class="artifacts-section">' +
              '<h4>Resources</h4>' +
              '<div class="artifacts-list">' +
                (m.agenda_url ? '<div class="artifact-item"><span class="material-icons">description</span><a href="' + m.agenda_url + '" target="_blank">Agenda</a></div>' : '') +
                (m.notes_url ? '<div class="artifact-item"><span class="material-icons">edit</span><a href="' + m.notes_url + '" target="_blank">Notes</a></div>' : '') +
                (m.slides_url ? '<div class="artifact-item"><span class="material-icons">monitor</span><a href="' + m.slides_url + '" target="_blank">Slides</a></div>' : '') +
                (m.recording_url ? '<div class="artifact-item"><span class="material-icons">videocam</span><a href="' + m.recording_url + '" target="_blank">Recording</a></div>' : '') +
                (!m.agenda_url && !m.notes_url && !m.slides_url && !m.recording_url ? '<p class="text-muted text-sm">No resources linked yet</p>' : '') +
              '</div>' +
            '</div>' +
          '</div>' +
        '</div>';
      }).join('');

      listContainer.innerHTML = html;
},

    toggleMeetingRow: function(meetingId) {
      var row = document.getElementById('meeting-' + meetingId);
      row.classList.toggle('expanded');
},

    filterMeetings: function() {
      var category = document.getElementById('meetingCategoryFilter').value;
      var type = document.getElementById('meetingTypeFilter').value;

      document.querySelectorAll('.meeting-row').forEach(function(row) {
        var catBadge = row.querySelector('.category-badge');
        var typeBadge = row.querySelector('.type-badge');
        var catMatch = category === 'all' || (catBadge && catBadge.textContent === category);
        var typeMatch = type === 'all' || (typeBadge && typeBadge.textContent === type);
        row.style.display = (catMatch && typeMatch) ? '' : 'none';
      });
    },

    renderDocuments: function() {
      var container = document.getElementById('directingDocsList');
      if (!container) {
        // SPA navigation - elements no longer exist
        return;
      }
      if (!this.documents.length) {
        container.innerHTML = '<div class="empty-state"><p>No directing documents configured.</p><p class="text-muted">Add document IDs to MO-DB_Config to display them here.</p></div>';
        return;
      }

      // Group by category
      var byCategory = {};
      this.documents.forEach(function(doc) {
        if (!byCategory[doc.category]) {
          byCategory[doc.category] = [];
        }
        byCategory[doc.category].push(doc);
      });

      // Category display order and colors
      var categoryConfig = {
        'Core': { color: '#1565c0', bg: '#e3f2fd' },
        'SEP': { color: '#2e7d32', bg: '#e8f5e9' },
        'Comms': { color: '#c2185b', bg: '#fce4ec' },
        'Assessment': { color: '#ef6c00', bg: '#fff3e0' },
        'Operations': { color: '#7b1fa2', bg: '#f3e5f5' },
        'Templates': { color: '#00838f', bg: '#e0f7fa' }
      };

      var categoryOrder = ['Core', 'SEP', 'Comms', 'Assessment', 'Operations', 'Templates'];
      var html = '';

      categoryOrder.forEach(function(category) {
        var docs = byCategory[category];
        if (!docs || docs.length === 0) return;

        var cfg = categoryConfig[category] || { color: '#666', bg: '#f5f5f5' };

        html += '<div class="documents-category">';
        html += '<h3 class="category-header" style="color:' + cfg.color + '; border-left: 3px solid ' + cfg.color + '; padding-left: var(--space-sm); margin-bottom: var(--space-md);">' + category + '</h3>';
        html += '<div class="category-docs-grid">';

        docs.forEach(function(doc) {
          // Ensure exactly one icon - use first if multiple, fallback if none
          var iconName = 'description'; // default fallback
          if (doc.icon && doc.icon.trim()) {
            iconName = doc.icon.trim().split(/\s+/)[0]; // take first icon only
          }
          html += '<a href="' + doc.url + '" target="_blank" class="document-card">' +
            '<div class="doc-icon" style="background:' + cfg.bg + '; color:' + cfg.color + ';">' +
              '<span class="material-icons">' + iconName + '</span>' +
            '</div>' +
            '<div class="doc-info">' +
              '<div class="doc-title">' + doc.name + '</div>' +
              '<div class="doc-description">' + doc.description + '</div>' +
            '</div>' +
            '<span class="material-icons doc-external-icon">open_in_new</span>' +
          '</a>';
        });

        html += '</div></div>';
      });

      container.innerHTML = html;
},

    updateStats: function() {
      // Guard against SPA navigation
      var statEl = document.getElementById('statTeamMembers');
      if (!statEl) {
        // SPA navigation - elements no longer exist
        return;
      }
      statEl.textContent = this.members.length;

      // Count meetings this week (recurring meetings with day_of_week set)
      var weeklyMeetings = this.meetings.filter(function(m) {
        return m.day_of_week && m.is_active;
      });
      document.getElementById('statMeetingsThisWeek').textContent = weeklyMeetings.length;

      // Count people out this week
      var today = new Date();
      var self = this;
      var outThisWeek = this.availability.filter(function(a) {
        var start = self.parseLocalDate(a.start_date);
        var end = self.parseLocalDate(a.end_date);
        return start && end && start <= today && end >= today;
      });
      document.getElementById('statOutThisWeek').textContent = outThisWeek.length;

      // Kudos this month
      var thirtyDaysAgo = new Date();
      thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
      var kudosThisMonth = this.kudos.filter(function(k) {
        return new Date(k.created_at) >= thirtyDaysAgo;
      }).length;
      document.getElementById('statKudosMonth').textContent = kudosThisMonth;
    },

    populatePersonSelect: function() {
      // Availability person select - display first names, use contact_id as value
      var select = document.getElementById('availPersonSelect');
      var options = '<option value="">Select person...</option>';
      this.members.forEach(function(m) {
        var contactId = m.contact_id ? String(m.contact_id) : '';
        var displayName = m.first_name || (m.first_name + ' ' + m.last_name).trim();
        options += '<option value="' + contactId + '">' + displayName + '</option>';
      });
      select.innerHTML = options;

      // Kudos recipient select
      var kudosSelect = document.getElementById('kudosRecipient');
      if (kudosSelect) {
        var kudosOptions = '<option value="">Select teammate...</option>';
        this.members.forEach(function(m) {
          var fullName = ((m.first_name || '') + ' ' + (m.last_name || '')).trim();
          kudosOptions += '<option value="' + m.contact_id + '">' + fullName + '</option>';
        });
        kudosSelect.innerHTML = kudosOptions;
      }
    },

    // Modal functions
    showAddModal: function() {
      if (this.currentView === 'meetings') {
        this.showAddMeetingModal();
      } else {
        this.showAddAvailabilityModal();
      }
    },

    showAddAvailabilityModal: function() {
      // Clear editing state
      this.editingAvailabilityId = null;
      document.getElementById('availabilityForm').reset();
      // Update modal title
      document.querySelector('#addAvailabilityModal .modal-header h3').textContent = 'Add Availability Entry';
      // Hide delete button
      var deleteBtn = document.getElementById('deleteAvailabilityBtn');
      if (deleteBtn) deleteBtn.style.display = 'none';
      // Reset form field visibility
      document.getElementById('personSelectGroup').classList.remove('hidden');
      document.getElementById('availPersonSelect').setAttribute('required', 'required');
      document.getElementById('holidayNameGroup').classList.add('hidden');
      document.getElementById('partnersGroup').classList.add('hidden');
      document.getElementById('locationGroup').classList.remove('hidden');
      // Uncheck all partner checkboxes
      document.querySelectorAll('#partnerCheckboxes input[type="checkbox"]').forEach(function(cb) {
        cb.checked = false;
      });
      // Reset save button state
      document.getElementById('saveAvailabilityBtn').classList.remove('loading');
      document.getElementById('addAvailabilityModal').classList.add('show');
    },

    editAvailability: function(availabilityId) {
      var item = this.availability.find(function(a) {
        return a.availability_id === availabilityId;
      });
      if (!item) {
        alert('Availability entry not found');
        return;
      }

      // Set editing state
      this.editingAvailabilityId = availabilityId;

      // Update modal title
      document.querySelector('#addAvailabilityModal .modal-header h3').textContent = 'Edit Availability Entry';

      // Show delete button
      var deleteBtn = document.getElementById('deleteAvailabilityBtn');
      if (deleteBtn) deleteBtn.style.display = '';

      // Reset form first
      document.getElementById('availabilityForm').reset();

      // Set form values - try multiple matching strategies
      var personSelect = document.getElementById('availPersonSelect');
      var contactIdStr = item.contact_id ? String(item.contact_id) : '';
      var contactName = item.contact_name || '';
      var matched = false;

      // Strategy 1: Try direct value match on contact_id
      personSelect.value = contactIdStr;
      if (personSelect.value === contactIdStr && contactIdStr) {
        matched = true;
      }

      // Strategy 2: Iterate options to find contact_id match (handles type mismatches)
      if (!matched && contactIdStr) {
        for (var i = 0; i < personSelect.options.length; i++) {
          if (String(personSelect.options[i].value) === contactIdStr) {
            personSelect.selectedIndex = i;
            matched = true;
            break;
          }
        }
      }

      // Strategy 3: Fall back to matching by contact_name (or first name) if contact_id didn't match
      if (!matched && contactName) {
        var nameParts = contactName.trim().split(' ');
        var firstName = nameParts[0] || '';
        for (var i = 0; i < personSelect.options.length; i++) {
          var optionText = personSelect.options[i].textContent.trim();
          // Try exact match first, then first name match
          if (optionText === contactName.trim() || optionText === firstName) {
            personSelect.selectedIndex = i;
            matched = true;
            break;
          }
        }
      }

      // Log warning if no match found
      if (!matched && (contactIdStr || contactName)) {
        console.warn('Could not match availability to team member. contact_id:', contactIdStr, 'contact_name:', contactName);
      }

      document.getElementById('availTypeSelect').value = item.type || '';
      document.getElementById('availHolidayName').value = item.holiday_name || '';
      document.getElementById('availStartDate').value = item.start_date ? item.start_date.split('T')[0] : '';
      document.getElementById('availEndDate').value = item.end_date ? item.end_date.split('T')[0] : '';
      document.getElementById('availRecurrence').value = item.recurrence || 'none';
      document.getElementById('availLocation').value = item.location || '';
      document.getElementById('availNotes').value = item.notes || '';

      // Set partner checkboxes for holidays
      if (item.partners) {
        var partners = item.partners.split(',').map(function(p) { return p.trim(); });
        document.querySelectorAll('#partnerCheckboxes input[type="checkbox"]').forEach(function(cb) {
          cb.checked = partners.indexOf(cb.value) !== -1;
        });
      } else {
        document.querySelectorAll('#partnerCheckboxes input[type="checkbox"]').forEach(function(cb) {
          cb.checked = false;
        });
      }

      // Toggle form fields based on type
      this.toggleFormFields();

      // Reset save button state
      document.getElementById('saveAvailabilityBtn').classList.remove('loading');
      document.getElementById('addAvailabilityModal').classList.add('show');
    },

    showAddMeetingModal: function() {
      document.getElementById('meetingForm').reset();
      document.getElementById('addMeetingModal').classList.add('show');
    },

    showMeetingDetail: function(meetingId) {
      // Scroll to and expand the meeting row in the list below
      var row = document.getElementById('meeting-' + meetingId);
      if (!row) return;

      // Expand the row if not already expanded
      if (!row.classList.contains('expanded')) {
        this.toggleMeetingRow(meetingId);
      }

      // Scroll into view with some offset for the header
      row.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // Brief highlight effect
      row.classList.add('highlight');
      setTimeout(function() {
        row.classList.remove('highlight');
      }, 1500);
    },

    showMemberDetail: function(contactId) {
      var member = this.members.find(function(m) { return m.contact_id === contactId; });
      if (!member) return;

      var initials = (member.first_name || '').charAt(0) + (member.last_name || '').charAt(0);
      var fullName = (member.first_name || '') + ' ' + (member.last_name || '');

      // Populate modal
      document.getElementById('memberDetailAvatar').textContent = initials.toUpperCase();
      document.getElementById('memberDetailName').textContent = fullName;
      document.getElementById('memberDetailTitle2').textContent = member.internal_title || 'Team Member';
      document.getElementById('memberDetailTeam').textContent = member.internal_team || '--';

      // Email
      var emailEl = document.getElementById('memberDetailEmail');
      if (member.email) {
        emailEl.textContent = member.email;
        emailEl.href = 'mailto:' + member.email;
      } else {
        emailEl.textContent = 'No email on file';
        emailEl.href = '#';
      }

      // Phone (if available)
      var phoneRow = document.getElementById('memberDetailPhoneRow');
      if (member.phone) {
        document.getElementById('memberDetailPhone').textContent = member.phone;
        phoneRow.style.display = '';
      } else {
        phoneRow.style.display = 'none';
      }

      // Organization (if available)
      var orgRow = document.getElementById('memberDetailOrgRow');
      if (member.organization) {
        document.getElementById('memberDetailOrg').textContent = member.organization;
        orgRow.style.display = '';
      } else {
        orgRow.style.display = 'none';
      }

      // Profile section (About Me)
      var profileSection = document.getElementById('memberProfileSection');
      if (member.has_profile) {
        profileSection.style.display = '';

        // Helper to set profile field and show/hide its container
        function setProfileField(elementId, itemId, value) {
          var el = document.getElementById(elementId);
          var item = document.getElementById(itemId);
          if (value && value.trim()) {
            el.textContent = value;
            item.style.display = '';
          } else {
            item.style.display = 'none';
          }
        }

        setProfileField('memberDetailEducation', 'profileEducationItem', member.education);
        setProfileField('memberDetailDuties', 'profileDutiesItem', member.job_duties);
        setProfileField('memberDetailSkills', 'profileSkillsItem', member.professional_skills);
        setProfileField('memberDetailNonWorkSkills', 'profileNonWorkSkillsItem', member.non_work_skills);
        setProfileField('memberDetailHobbies', 'profileHobbiesItem', member.hobbies);
        setProfileField('memberDetailGoals', 'profileGoalsItem', member.goals);
        setProfileField('memberDetailRelax', 'profileRelaxItem', member.relax);
        setProfileField('memberDetailEarlyJob', 'profileEarlyJobItem', member.early_job);
      } else {
        profileSection.style.display = 'none';
      }

      // Build availability list for this member
      var memberAvail = this.availability.filter(function(a) {
        return a.contact_id === contactId;
      }).sort(function(a, b) {
        return Team.parseLocalDate(a.start_date) - Team.parseLocalDate(b.start_date);
      });

      var availListEl = document.getElementById('memberAvailabilityList');
      if (memberAvail.length === 0) {
        availListEl.innerHTML = '<p class="text-muted">No upcoming OOO</p>';
      } else {
        var self = this;
        var availHtml = memberAvail.slice(0, 5).map(function(a) {
          var typeLabel = self.typeLabels[a.type] || a.type;
          var dateStr = self.formatDateRange(a.start_date, a.end_date);
          return '<div class="member-avail-item">' +
            '<span class="avail-type-badge ' + a.type.replace('9_80', 'nine_80') + '">' + typeLabel + '</span>' +
            '<span>' + dateStr + '</span>' +
          '</div>';
        }).join('');
        availListEl.innerHTML = availHtml;
      }

      document.getElementById('memberDetailModal').classList.add('show');
    },

    closeModal: function(modalId) {
      document.getElementById(modalId).classList.remove('show');
    },

    saveAvailability: function() {
      var typeSelect = document.getElementById('availTypeSelect');
      var personSelect = document.getElementById('availPersonSelect');
      var selectedOption = personSelect.options[personSelect.selectedIndex];
      var saveBtn = document.getElementById('saveAvailabilityBtn');
      var selectedType = typeSelect.value;

      // Validate required fields
      if (!selectedType) {
        alert('Please select a type');
        return;
      }

      // Validate person for personal types
      var officeWideTypes = ['holiday', 'special_event'];
      var isOfficeWide = officeWideTypes.indexOf(selectedType) !== -1;
      var isHoliday = selectedType === 'holiday';

      if (!isOfficeWide && !personSelect.value) {
        alert('Please select a team member');
        return;
      }

      // Collect selected partners for holidays
      var partners = '';
      if (isHoliday) {
        var selectedPartners = [];
        document.querySelectorAll('#partnerCheckboxes input[type="checkbox"]:checked').forEach(function(cb) {
          selectedPartners.push(cb.value);
        });
        partners = selectedPartners.join(', ');
      }

      // Show loading state
      saveBtn.classList.add('loading');

      var data = {
        contact_id: isOfficeWide ? '' : personSelect.value,
        contact_name: isOfficeWide ? '' : (selectedOption ? selectedOption.textContent.trim() : ''),
        type: selectedType,
        start_date: document.getElementById('availStartDate').value,
        end_date: document.getElementById('availEndDate').value,
        recurrence: document.getElementById('availRecurrence').value,
        holiday_name: isHoliday ? document.getElementById('availHolidayName').value : '',
        partners: partners,
        location: isHoliday ? '' : document.getElementById('availLocation').value,
        notes: document.getElementById('availNotes').value
      };

      var self = this;

      // Check if editing existing entry or creating new
      if (this.editingAvailabilityId) {
        google.script.run
          .withSuccessHandler(function(result) {
            saveBtn.classList.remove('loading');
            if (result && result.success) {
              self.editingAvailabilityId = null;
              Team.closeModal('addAvailabilityModal');
              Team.loadData();
            } else {
              alert('Failed to update: ' + (result && result.error ? result.error : 'Unknown error'));
            }
          })
          .withFailureHandler(function(error) {
            saveBtn.classList.remove('loading');
            handleError(error);
            alert('Failed to update: ' + (error.message || error));
          })
          .updateAvailability(this.editingAvailabilityId, data);
      } else {
        google.script.run
          .withSuccessHandler(function() {
            saveBtn.classList.remove('loading');
            Team.closeModal('addAvailabilityModal');
            Team.loadData();
          })
          .withFailureHandler(function(error) {
            saveBtn.classList.remove('loading');
            handleError(error);
            alert('Failed to save: ' + (error.message || error));
          })
          .addAvailability(data);
      }
    },

    deleteAvailability: function() {
      if (!this.editingAvailabilityId) return;

      if (!confirm('Are you sure you want to delete this availability entry?')) {
        return;
      }

      var saveBtn = document.getElementById('saveAvailabilityBtn');
      saveBtn.classList.add('loading');
      var self = this;

      google.script.run
        .withSuccessHandler(function(result) {
          saveBtn.classList.remove('loading');
          if (result && result.success) {
            self.editingAvailabilityId = null;
            Team.closeModal('addAvailabilityModal');
            Team.loadData();
          } else {
            alert('Failed to delete: ' + (result && result.error ? result.error : 'Unknown error'));
          }
        })
        .withFailureHandler(function(error) {
          saveBtn.classList.remove('loading');
          handleError(error);
          alert('Failed to delete: ' + (error.message || error));
        })
        .deleteAvailability(this.editingAvailabilityId);
    },

    saveMeeting: function() {
      var data = {
        name: document.getElementById('meetingName').value,
        category: document.getElementById('meetingCategory').value,
        type: document.getElementById('meetingType').value,
        cadence: document.getElementById('meetingCadence').value,
        day_of_week: document.getElementById('meetingDay').value,
        time: document.getElementById('meetingTime').value,
        duration_minutes: parseInt(document.getElementById('meetingDuration').value) || 60,
        purpose: document.getElementById('meetingPurpose').value,
        online_link: document.getElementById('meetingLink').value,
        drive_folder_url: document.getElementById('meetingDriveFolder').value,
        agenda_url: document.getElementById('meetingAgendaUrl').value,
        notes_url: document.getElementById('meetingNotesUrl').value,
        slides_url: document.getElementById('meetingSlidesUrl').value,
        recording_url: document.getElementById('meetingRecordingUrl').value
      };

      google.script.run
        .withSuccessHandler(function() {
          Team.closeModal('addMeetingModal');
          Team.loadData();
        })
        .withFailureHandler(handleError)
        .addMeeting(data);
    },

    // ============================================
    // PARKING LOT FUNCTIONS
    // ============================================

    parkingLotItems: [],
    currentPLItem: null,
    selectedPLType: 'idea',

    loadParkingLot: function() {
      // Set default type selection
      Team.selectPLType('idea');

      google.script.run
        .withSuccessHandler(function(items) {
          Team.parkingLotItems = items || [];
          Team.renderParkingLot();
          Team.updatePLStats();
        })
        .withFailureHandler(function(error) {
          console.error('Failed to load parking lot:', error);
          Team.parkingLotItems = [];
          Team.renderParkingLot();
        })
        .getAllParkingLotItems();

      // Load solutions for dropdown
      google.script.run
        .withSuccessHandler(function(solutions) {
          Team.populatePLSolutionDropdown(solutions || []);
        })
        .withFailureHandler(handleError)
        .getAllSolutions();

      // Populate assignee dropdown with team members
      Team.populatePLAssigneeDropdown();
    },

    populatePLSolutionDropdown: function(solutions) {
      var select = document.getElementById('plSolution');
      if (!select) return;

      select.innerHTML = '<option value="">-- None --</option>';
      solutions.forEach(function(sol) {
        var opt = document.createElement('option');
        opt.value = sol.core_id;
        opt.textContent = (sol.core_id || '').toUpperCase() + ' - ' + (sol.core_official_name || '');
        select.appendChild(opt);
      });
    },

    populatePLAssigneeDropdown: function() {
      var select = document.getElementById('plDetailAssignSelect');
      if (!select || !Team.members) return;

      select.innerHTML = '<option value="">-- Unassigned --</option>';
      Team.members.forEach(function(m) {
        if (m.email) {
          var opt = document.createElement('option');
          opt.value = m.email;
          opt.textContent = (m.first_name || '') + ' ' + (m.last_name || '');
          select.appendChild(opt);
        }
      });
    },

    selectPLType: function(type) {
      Team.selectedPLType = type;
      document.getElementById('plType').value = type;

      document.querySelectorAll('.pl-type-btn').forEach(function(btn) {
        btn.classList.remove('selected');
      });
      var selectedBtn = document.querySelector('.pl-type-btn[data-type="' + type + '"]');
      if (selectedBtn) selectedBtn.classList.add('selected');
    },

    submitParkingLotItem: function() {
      var title = document.getElementById('plTitle').value.trim();
      if (!title) {
        alert('Please enter a title');
        return;
      }

      var itemData = {
        title: title,
        description: document.getElementById('plDescription').value.trim(),
        item_type: Team.selectedPLType || 'idea',
        priority: document.getElementById('plPriority').value,
        solution_id: document.getElementById('plSolution').value || '',
        tags: document.getElementById('plTags').value.trim(),
        submitted_by: window.currentUserName || 'Anonymous',
        submitted_by_email: ''
      };

      google.script.run
        .withSuccessHandler(function(newItem) {
          // Clear form
          document.getElementById('plTitle').value = '';
          document.getElementById('plDescription').value = '';
          document.getElementById('plPriority').value = 'medium';
          document.getElementById('plSolution').value = '';
          document.getElementById('plTags').value = '';
          Team.selectPLType('idea');

          // Reload
          Team.loadParkingLot();
        })
        .withFailureHandler(function(error) {
          console.error('Failed to create parking lot item:', error);
          alert('Failed to add item. Please try again.');
        })
        .createParkingLotItem(itemData);
    },

    renderParkingLot: function() {
      var feed = document.getElementById('parkingLotFeed');
      if (!feed) return;

      var items = Team.getFilteredPLItems();

      if (items.length === 0) {
        feed.innerHTML = '<div class="pl-empty-state">' +
          '<span class="material-icons">lightbulb</span>' +
          '<p>No items in the parking lot yet.</p>' +
          '<p>Add your first idea above!</p>' +
          '</div>';
        return;
      }

      var typeIcons = {
        'idea': 'lightbulb',
        'discussion_topic': 'forum',
        'stakeholder_connection': 'people',
        'follow_up': 'flag',
        'process_suggestion': 'settings',
        'random_info': 'info'
      };

      var html = '';
      items.forEach(function(item) {
        var icon = typeIcons[item.item_type] || 'help';
        var createdDate = item.created_at ? new Date(item.created_at).toLocaleDateString() : '--';

        html += '<div class="pl-item-card" onclick="Team.showPLItemDetail(\'' + escapeAttr(item.item_id) + '\')">';
        html += '<div class="pl-item-icon ' + escapeAttr(item.item_type) + '">';
        html += '<span class="material-icons">' + icon + '</span>';
        html += '</div>';
        html += '<div class="pl-item-content">';
        html += '<div class="pl-item-title">' + escapeHtml(item.title) + '</div>';
        if (item.description) {
          html += '<div class="pl-item-description">' + escapeHtml(item.description) + '</div>';
        }
        html += '<div class="pl-item-meta">';
        html += '<span><span class="material-icons">person</span>' + escapeHtml(item.submitted_by || 'Unknown') + '</span>';
        html += '<span><span class="material-icons">schedule</span>' + createdDate + '</span>';
        if (item.solution_id) {
          html += '<span><span class="material-icons">widgets</span>' + escapeHtml(item.solution_id).toUpperCase() + '</span>';
        }
        html += '</div>';
        html += '</div>';
        html += '<div class="pl-item-badges">';
        html += '<span class="pl-status-badge ' + escapeAttr(item.status) + '">' + Team.formatPLStatus(item.status) + '</span>';
        html += '<span class="pl-priority-badge ' + escapeAttr(item.priority) + '">' + Team.formatPLPriority(item.priority) + '</span>';
        html += '</div>';
        html += '</div>';
      });

      feed.innerHTML = html;
    },

    getFilteredPLItems: function() {
      var typeFilter = document.getElementById('plFilterType').value;
      var statusFilter = document.getElementById('plFilterStatus').value;

      return Team.parkingLotItems.filter(function(item) {
        if (typeFilter !== 'all' && item.item_type !== typeFilter) return false;

        if (statusFilter === 'active') {
          return item.status !== 'resolved' && item.status !== 'archived';
        } else if (statusFilter !== 'all' && item.status !== statusFilter) {
          return false;
        }

        return true;
      });
    },

    filterParkingLot: function() {
      Team.renderParkingLot();
    },

    formatPLStatus: function(status) {
      var names = {
        'new': 'New',
        'discussed': 'Discussed',
        'assigned': 'Assigned',
        'in_progress': 'In Progress',
        'resolved': 'Resolved',
        'archived': 'Archived'
      };
      return names[status] || status;
    },

    formatPLPriority: function(priority) {
      return (priority || '').charAt(0).toUpperCase() + (priority || '').slice(1);
    },

    formatPLType: function(type) {
      var names = {
        'idea': 'Idea',
        'discussion_topic': 'Discussion Topic',
        'stakeholder_connection': 'Stakeholder Connection',
        'follow_up': 'Follow-up',
        'process_suggestion': 'Process Suggestion',
        'random_info': 'Random Info'
      };
      return names[type] || type;
    },

    updatePLStats: function() {
      var items = Team.parkingLotItems.filter(function(i) {
        return i.status !== 'archived';
      });

      var newItems = items.filter(function(i) { return i.status === 'new'; });
      var highPriority = items.filter(function(i) {
        return i.priority === 'high' && i.status !== 'resolved';
      });

      document.getElementById('plStatTotal').textContent = items.length;
      document.getElementById('plStatNew').textContent = newItems.length;
      document.getElementById('plStatHighPriority').textContent = highPriority.length;
    },

    showPLItemDetail: function(itemId) {
      var item = Team.parkingLotItems.find(function(i) { return i.item_id === itemId; });
      if (!item) return;

      Team.currentPLItem = item;

      // Update modal content
      document.getElementById('plItemDetailTitle').textContent = item.title;

      // Type badge
      var typeIcons = {
        'idea': 'lightbulb',
        'discussion_topic': 'forum',
        'stakeholder_connection': 'people',
        'follow_up': 'flag',
        'process_suggestion': 'settings',
        'random_info': 'info'
      };
      var typeBadge = document.getElementById('plDetailTypeBadge');
      typeBadge.className = 'pl-type-badge ' + item.item_type;
      typeBadge.innerHTML = '<span class="material-icons">' + (typeIcons[item.item_type] || 'help') + '</span><span>' + Team.formatPLType(item.item_type) + '</span>';

      // Status & priority badges
      var statusBadge = document.getElementById('plDetailStatusBadge');
      statusBadge.className = 'pl-status-badge ' + item.status;
      statusBadge.textContent = Team.formatPLStatus(item.status);

      var priorityBadge = document.getElementById('plDetailPriorityBadge');
      priorityBadge.className = 'pl-priority-badge ' + item.priority;
      priorityBadge.textContent = Team.formatPLPriority(item.priority);

      // Description
      document.getElementById('plDetailDescription').textContent = item.description || 'No description provided.';

      // Meta info
      document.getElementById('plDetailSubmitter').textContent = item.submitted_by || 'Unknown';
      document.getElementById('plDetailCreated').textContent = item.created_at ? new Date(item.created_at).toLocaleString() : '--';

      // Solution
      var solutionRow = document.getElementById('plDetailSolutionRow');
      if (item.solution_id) {
        solutionRow.style.display = '';
        document.getElementById('plDetailSolution').textContent = item.solution_id.toUpperCase();
      } else {
        solutionRow.style.display = 'none';
      }

      // Assignee
      var assigneeRow = document.getElementById('plDetailAssigneeRow');
      if (item.assigned_to) {
        assigneeRow.style.display = '';
        document.getElementById('plDetailAssignee').textContent = item.assigned_to;
      } else {
        assigneeRow.style.display = 'none';
      }

      // Tags
      var tagsRow = document.getElementById('plDetailTagsRow');
      if (item.tags) {
        tagsRow.style.display = '';
        document.getElementById('plDetailTags').textContent = item.tags;
      } else {
        tagsRow.style.display = 'none';
      }

      // Notes
      var notesSection = document.getElementById('plDetailNotesSection');
      if (item.notes) {
        notesSection.style.display = '';
        document.getElementById('plDetailNotes').textContent = item.notes;
      } else {
        notesSection.style.display = 'none';
      }

      // Set form values
      document.getElementById('plDetailStatusSelect').value = item.status || 'new';
      document.getElementById('plDetailAssignSelect').value = item.assigned_to || '';
      document.getElementById('plDetailNoteInput').value = '';

      // Show modal
      document.getElementById('plItemDetailModal').classList.add('show');
    },

    updatePLItemStatus: function() {
      if (!Team.currentPLItem) return;

      var newStatus = document.getElementById('plDetailStatusSelect').value;

      google.script.run
        .withSuccessHandler(function() {
          Team.currentPLItem.status = newStatus;
          Team.loadParkingLot();

          // Update modal badge
          var statusBadge = document.getElementById('plDetailStatusBadge');
          statusBadge.className = 'pl-status-badge ' + newStatus;
          statusBadge.textContent = Team.formatPLStatus(newStatus);
        })
        .withFailureHandler(handleError)
        .updateParkingLotItemStatus(Team.currentPLItem.item_id, newStatus);
    },

    assignPLItem: function() {
      if (!Team.currentPLItem) return;

      var assignee = document.getElementById('plDetailAssignSelect').value;

      if (assignee) {
        google.script.run
          .withSuccessHandler(function() {
            Team.currentPLItem.assigned_to = assignee;
            Team.currentPLItem.status = 'assigned';
            Team.loadParkingLot();

            // Update modal
            document.getElementById('plDetailAssigneeRow').style.display = '';
            document.getElementById('plDetailAssignee').textContent = assignee;
            document.getElementById('plDetailStatusSelect').value = 'assigned';
            var statusBadge = document.getElementById('plDetailStatusBadge');
            statusBadge.className = 'pl-status-badge assigned';
            statusBadge.textContent = 'Assigned';
          })
          .withFailureHandler(handleError)
          .assignParkingLotItem(Team.currentPLItem.item_id, assignee);
      } else {
        // Unassign
        google.script.run
          .withSuccessHandler(function() {
            Team.currentPLItem.assigned_to = '';
            Team.loadParkingLot();
            document.getElementById('plDetailAssigneeRow').style.display = 'none';
          })
          .withFailureHandler(handleError)
          .updateParkingLotItem(Team.currentPLItem.item_id, { assigned_to: '' });
      }
    },

    addPLNote: function() {
      if (!Team.currentPLItem) return;

      var note = document.getElementById('plDetailNoteInput').value.trim();
      if (!note) return;

      google.script.run
        .withSuccessHandler(function(updatedItem) {
          if (updatedItem) {
            Team.currentPLItem = updatedItem;
            document.getElementById('plDetailNotesSection').style.display = '';
            document.getElementById('plDetailNotes').textContent = updatedItem.notes;
            document.getElementById('plDetailNoteInput').value = '';
            Team.loadParkingLot();
          }
        })
        .withFailureHandler(handleError)
        .addNoteToParkingLotItem(Team.currentPLItem.item_id, note);
    },

    deletePLItem: function() {
      if (!Team.currentPLItem) return;

      if (!confirm('Are you sure you want to delete this item?')) return;

      google.script.run
        .withSuccessHandler(function() {
          Team.closeModal('plItemDetailModal');
          Team.currentPLItem = null;
          Team.loadParkingLot();
        })
        .withFailureHandler(handleError)
        .deleteParkingLotItem(Team.currentPLItem.item_id);
    },

    // ============================================
    // ACTIONS FUNCTIONS
    // ============================================

    loadActions: function() {
      var assigneeView = document.getElementById('assignee-view');
      if (assigneeView) {
        assigneeView.innerHTML = '<div class="loading-state"><span class="loading-spinner"></span><span>Loading actions...</span></div>';
      }

      google.script.run
        .withSuccessHandler(function(actions) {
          Team.actionsData = actions || [];
          Team.filteredActions = Team.actionsData;
          Team.populateSolutionFilter();
          Team.applyActionsFilters();
          Team.populateTeamMembersList();
        })
        .withFailureHandler(function(err) {
          console.error('Failed to load actions:', err);
          var assigneeView = document.getElementById('assignee-view');
          if (assigneeView) {
            assigneeView.innerHTML = '<div class="empty-state"><span class="material-icons">error</span><p>Failed to load actions</p></div>';
          }
        })
        .getAllActions();
    },

    populateSolutionFilter: function() {
      var select = document.getElementById('filter-solution');
      if (!select) return;

      var solutions = {};
      Team.actionsData.forEach(function(action) {
        if (action.solution_id && action.solution_id.trim()) {
          solutions[action.solution_id.trim()] = true;
        }
      });

      select.innerHTML = '<option value="">All Solutions</option>';
      Object.keys(solutions).sort().forEach(function(solution) {
        var option = document.createElement('option');
        option.value = solution;
        option.textContent = solution;
        select.appendChild(option);
      });
    },

    populateTeamMembersList: function() {
      var datalist = document.getElementById('team-members-list');
      if (!datalist) return;

      datalist.innerHTML = '';
      Team.members.forEach(function(m) {
        var option = document.createElement('option');
        option.value = m.first_name || '';
        datalist.appendChild(option);
      });
    },

    setActionsSubview: function(subview) {
      Team.actionsSubview = subview;

      document.querySelectorAll('.actions-view-toggle .view-btn').forEach(function(btn) {
        btn.classList.toggle('active', btn.dataset.subview === subview);
      });

      var assigneeView = document.getElementById('assignee-view');
      var statusView = document.getElementById('status-view');
      if (assigneeView) assigneeView.classList.toggle('active', subview === 'assignee');
      if (statusView) statusView.classList.toggle('active', subview === 'status');

      Team.renderActions();
    },

    setActionsFilter: function(filter) {
      Team.actionsFilter = filter;

      document.querySelectorAll('.filter-chips .chip').forEach(function(chip) {
        chip.classList.toggle('active', chip.dataset.filter === filter);
      });

      Team.applyActionsFilters();
    },

    applyActionsFilters: function() {
      var searchEl = document.getElementById('action-search');
      var sourceEl = document.getElementById('filter-source');
      var solutionEl = document.getElementById('filter-solution');
      if (!searchEl || !sourceEl || !solutionEl) return;

      var search = (searchEl.value || '').toLowerCase();
      var source = sourceEl.value;
      var solution = solutionEl.value;

      Team.filteredActions = Team.actionsData.filter(function(action) {
        var status = Team.normalizeActionStatus(action.status);
        if (Team.actionsFilter === 'open' && status === 'done') return false;
        if (Team.actionsFilter === 'done' && status !== 'done') return false;

        if (source && action.category !== source) return false;
        if (solution && action.solution_id !== solution) return false;

        if (search) {
          var text = [action.task, action.assigned_to, action.source_document, action.solution_id].join(' ').toLowerCase();
          if (text.indexOf(search) === -1) return false;
        }

        return true;
      });

      Team.renderActions();
      Team.showActionsEmpty(Team.filteredActions.length === 0);
    },

    renderActions: function() {
      if (Team.actionsSubview === 'assignee') {
        Team.renderAssigneeView();
      } else {
        Team.renderStatusView();
      }
    },

    renderAssigneeView: function() {
      var container = document.getElementById('assignee-view');
      if (!container) return;
      container.innerHTML = '';

      // Group by assignee
      var byAssignee = {};
      Team.filteredActions.forEach(function(action) {
        var owner = action.assigned_to || 'Unassigned';
        if (!byAssignee[owner]) byAssignee[owner] = [];
        byAssignee[owner].push(action);
      });

      // Sort assignees by count
      var assignees = Object.keys(byAssignee).sort(function(a, b) {
        var diff = byAssignee[b].length - byAssignee[a].length;
        if (diff !== 0) return diff;
        return a.localeCompare(b);
      });

      assignees.forEach(function(assignee) {
        var actions = byAssignee[assignee];
        var initials = assignee.split(' ').map(function(n) { return n[0] || ''; }).join('').toUpperCase().substring(0, 2) || '?';
        var isCollapsed = Team.collapsedAssignees && Team.collapsedAssignees[assignee];

        var section = document.createElement('div');
        section.className = 'assignee-section' + (isCollapsed ? ' collapsed' : '');

        var header = document.createElement('div');
        header.className = 'assignee-header';
        header.onclick = function() { Team.toggleAssignee(assignee, section); };

        header.innerHTML = '<span class="material-icons assignee-toggle">expand_more</span>' +
          '<div class="assignee-avatar">' + initials + '</div>' +
          '<span class="assignee-name">' + escapeHtml(assignee) + '</span>' +
          '<span class="assignee-count">' + actions.length + '</span>';

        section.appendChild(header);

        var actionsDiv = document.createElement('div');
        actionsDiv.className = 'assignee-actions';

        actions.forEach(function(action) {
          var status = Team.normalizeActionStatus(action.status);
          var solution = action.solution_id || action.category || '';
          var isSolution = solution && solution !== action.category;

          var row = document.createElement('div');
          row.className = 'action-row';
          row.onclick = function(e) {
            e.stopPropagation();
            Team.showActionDetail(action.action_id);
          };

          row.innerHTML = '<div class="action-task">' + escapeHtml(action.task || '') + '</div>' +
            '<div class="action-row-meta">' +
            '<span class="action-status"><span class="status-dot ' + status.replace('_', '-') + '"></span>' +
            '<span class="status-text">' + Team.formatActionStatus(status) + '</span></span>' +
            (solution ? '<span class="action-solution' + (isSolution ? ' is-solution' : '') + '">' + escapeHtml(solution) + '</span>' : '') +
            (action.source_date ? '<span class="action-source">' + action.source_date + '</span>' : '') +
            '</div>';

          actionsDiv.appendChild(row);
        });

        section.appendChild(actionsDiv);
        container.appendChild(section);
      });
    },

    toggleAssignee: function(assignee, section) {
      if (!Team.collapsedAssignees) Team.collapsedAssignees = {};
      Team.collapsedAssignees[assignee] = !Team.collapsedAssignees[assignee];
      section.classList.toggle('collapsed');
    },

    renderStatusView: function() {
      var statuses = ['pending', 'not_started', 'in_progress', 'done'];

      statuses.forEach(function(status) {
        var container = document.getElementById('cards-' + status.replace('_', '-'));
        var countEl = document.getElementById('count-' + status.replace('_', '-'));
        if (!container || !countEl) return;

        var actions = Team.filteredActions.filter(function(a) {
          return Team.normalizeActionStatus(a.status) === status;
        });

        countEl.textContent = actions.length;
        container.innerHTML = '';

        actions.forEach(function(action) {
          var solution = action.solution_id || action.category || '';
          var isSolution = solution && solution !== action.category;

          var card = document.createElement('div');
          card.className = 'kanban-card';
          card.onclick = function() { Team.showActionDetail(action.action_id); };
          card.innerHTML = '<div class="task">' + escapeHtml(action.task || '') + '</div>' +
            '<div class="meta">' +
            '<span class="owner">' + escapeHtml(action.assigned_to || 'Unassigned') + '</span>' +
            '<span class="action-solution' + (isSolution ? ' is-solution' : '') + '" style="font-size:10px;padding:2px 6px;">' + escapeHtml(solution) + '</span>' +
            '</div>';
          container.appendChild(card);
        });
      });
    },

    showActionDetail: function(actionId) {
      var action = Team.actionsData.find(function(a) { return a.action_id === actionId; });
      if (!action) return;

      Team.currentAction = action;
      var status = Team.normalizeActionStatus(action.status);

      var container = document.getElementById('drawer-body');
      container.innerHTML = '';

      // Task
      var taskField = document.createElement('div');
      taskField.className = 'detail-field';
      taskField.innerHTML = '<label>Task</label><div class="value">' + escapeHtml(action.task || '-') + '</div>';
      container.appendChild(taskField);

      // Assigned To
      var assigneeField = document.createElement('div');
      assigneeField.className = 'detail-field';
      assigneeField.innerHTML = '<label>Assigned To</label>' +
        '<div class="value assignee-field"><span class="current-assignee">' + escapeHtml(action.assigned_to || 'Unassigned') + '</span>' +
        '<button class="btn-reassign" onclick="Team.showReassign()" title="Reassign"><span class="material-icons">edit</span></button></div>';
      container.appendChild(assigneeField);

      // Reassign form (hidden)
      var reassignDiv = document.createElement('div');
      reassignDiv.id = 'reassign-form';
      reassignDiv.className = 'reassign-form';
      reassignDiv.style.display = 'none';
      reassignDiv.innerHTML = '<input type="text" id="reassign-input" list="drawer-team-list" placeholder="Select team member">' +
        '<datalist id="drawer-team-list"></datalist>' +
        '<div class="reassign-buttons">' +
        '<button class="btn btn-secondary btn-sm" onclick="Team.cancelReassign()">Cancel</button>' +
        '<button class="btn btn-primary btn-sm" id="reassign-btn" onclick="Team.confirmReassign()">Reassign</button>' +
        '</div>';
      container.appendChild(reassignDiv);

      // Populate datalist with first names only
      var drawerDatalist = reassignDiv.querySelector('#drawer-team-list');
      Team.members.forEach(function(m) {
        var opt = document.createElement('option');
        opt.value = m.first_name || '';
        drawerDatalist.appendChild(opt);
      });

      // Status
      var statusField = document.createElement('div');
      statusField.className = 'detail-field';
      statusField.innerHTML = '<label>Status</label><div class="value">' + Team.formatActionStatus(status) + '</div>';
      container.appendChild(statusField);

      // Solution
      var solution = action.solution_id || action.category || '';
      var solutionField = document.createElement('div');
      solutionField.className = 'detail-field';
      solutionField.innerHTML = '<label>Solution/Source</label><div class="value">' + escapeHtml(solution) + '</div>';
      container.appendChild(solutionField);

      // Source document
      if (action.source_document || action.source_url) {
        var sourceField = document.createElement('div');
        sourceField.className = 'detail-field';
        var sourceHtml = '<label>Source</label><div class="value">';
        if (action.source_url) {
          sourceHtml += '<a href="' + escapeHtml(action.source_url) + '" target="_blank">' + escapeHtml(action.source_document || 'View Source') + '</a>';
        } else {
          sourceHtml += escapeHtml(action.source_document);
        }
        if (action.source_date) {
          sourceHtml += ' <span style="color:var(--color-text-muted);">(' + action.source_date + ')</span>';
        }
        sourceHtml += '</div>';
        sourceField.innerHTML = sourceHtml;
        container.appendChild(sourceField);
      }

      // Notes
      if (action.notes) {
        var notesField = document.createElement('div');
        notesField.className = 'detail-field';
        notesField.innerHTML = '<label>Notes</label><div class="value" style="white-space:pre-wrap;">' + escapeHtml(action.notes) + '</div>';
        container.appendChild(notesField);
      }

      // Status buttons
      var btnsDiv = document.createElement('div');
      btnsDiv.className = 'status-buttons';
      ['pending', 'not_started', 'in_progress', 'done'].forEach(function(s) {
        var btn = document.createElement('button');
        btn.className = 'status-btn' + (status === s ? ' active' : '');
        btn.textContent = Team.formatActionStatus(s);
        btn.onclick = function() { Team.updateActionStatus(s); };
        btnsDiv.appendChild(btn);
      });
      container.appendChild(btnsDiv);

      // Edit and Delete buttons
      var actionBtns = document.createElement('div');
      actionBtns.className = 'action-buttons';
      actionBtns.style.cssText = 'display:flex; gap:var(--space-sm); margin-top:var(--space-md); padding-top:var(--space-md); border-top:1px solid var(--color-border);';

      var editBtn = document.createElement('button');
      editBtn.className = 'btn btn-secondary btn-sm';
      editBtn.innerHTML = '<span class="material-icons">edit</span> Edit';
      editBtn.onclick = function() { Team.editAction(action.action_id); };
      actionBtns.appendChild(editBtn);

      var deleteBtn = document.createElement('button');
      deleteBtn.className = 'btn btn-danger btn-sm';
      deleteBtn.innerHTML = '<span class="material-icons">delete</span> Delete';
      deleteBtn.onclick = function() { Team.deleteAction(action.action_id); };
      actionBtns.appendChild(deleteBtn);

      container.appendChild(actionBtns);

      document.getElementById('action-drawer').classList.add('active');
    },

    closeActionDrawer: function() {
      document.getElementById('action-drawer').classList.remove('active');
      Team.currentAction = null;
    },

    updateActionStatus: function(newStatus) {
      if (!Team.currentAction) return;

      var buttons = document.querySelectorAll('.status-btn');
      buttons.forEach(function(btn) { btn.disabled = true; });

      google.script.run
        .withSuccessHandler(function() {
          Team.currentAction.status = newStatus;
          buttons.forEach(function(btn) {
            btn.disabled = false;
            btn.classList.remove('active');
            if (btn.textContent === Team.formatActionStatus(newStatus)) {
              btn.classList.add('active', 'success');
            }
          });
          setTimeout(function() {
            Team.closeActionDrawer();
            Team.loadActions();
          }, 600);
        })
        .withFailureHandler(function(err) {
          buttons.forEach(function(btn) { btn.disabled = false; });
          alert('Failed to update: ' + err);
        })
        .updateActionStatus(Team.currentAction.action_id, newStatus);
    },

    editAction: function(actionId) {
      var action = Team.actionsData.find(function(a) { return a.action_id === actionId; });
      if (!action) return;

      Team.editingActionId = actionId;
      Team.closeActionDrawer();

      // Populate the add modal with existing data
      document.getElementById('addActionModal').querySelector('.modal-header h3').textContent = 'Edit Action';
      document.getElementById('add-task').value = action.task || '';
      document.getElementById('add-category').value = action.category || 'MO';
      document.getElementById('add-assigned').value = action.assigned_to || '';
      document.getElementById('add-due').value = action.due_date || '';
      document.getElementById('add-priority').value = action.priority || 'medium';
      document.getElementById('add-solution').value = action.solution_id || '';
      document.getElementById('add-notes').value = action.notes || '';

      // Change button text
      var btn = document.getElementById('add-submit-btn');
      btn.innerHTML = '<span class="material-icons">save</span> Save Changes';

      document.getElementById('addActionModal').classList.add('show');
    },

    deleteAction: function(actionId) {
      if (!confirm('Are you sure you want to delete this action? This cannot be undone.')) {
        return;
      }

      google.script.run
        .withSuccessHandler(function(result) {
          if (result && result.success) {
            Team.closeActionDrawer();
            Team.loadActions();
          } else {
            alert('Failed to delete: ' + (result && result.error ? result.error : 'Unknown error'));
          }
        })
        .withFailureHandler(function(err) {
          alert('Failed to delete action: ' + err);
        })
        .deleteAction(actionId);
    },

    showReassign: function() {
      var form = document.getElementById('reassign-form');
      if (form) {
        form.style.display = 'block';
        document.getElementById('reassign-input').value = '';
        document.getElementById('reassign-input').focus();
      }
    },

    cancelReassign: function() {
      var form = document.getElementById('reassign-form');
      if (form) form.style.display = 'none';
    },

    confirmReassign: function() {
      if (!Team.currentAction) return;

      var newAssignee = document.getElementById('reassign-input').value.trim();
      if (!newAssignee) {
        alert('Please select or enter a team member name');
        return;
      }

      var btn = document.getElementById('reassign-btn');
      btn.disabled = true;
      btn.textContent = 'Reassigning...';

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            btn.textContent = 'Done!';
            Team.currentAction.assigned_to = newAssignee;
            setTimeout(function() {
              Team.cancelReassign();
              btn.disabled = false;
              btn.textContent = 'Reassign';
              var assigneeSpan = document.querySelector('.current-assignee');
              if (assigneeSpan) assigneeSpan.textContent = newAssignee;
              Team.loadActions();
            }, 600);
          } else {
            btn.disabled = false;
            btn.textContent = 'Reassign';
            alert(result.message || 'Failed to reassign');
          }
        })
        .withFailureHandler(function(err) {
          btn.disabled = false;
          btn.textContent = 'Reassign';
          alert('Failed to reassign: ' + err);
        })
        .assignAction(Team.currentAction.action_id, newAssignee, null, false);
    },

    showAddActionModal: function() {
      Team.editingActionId = null;
      document.getElementById('add-action-form').reset();
      document.getElementById('addActionModal').querySelector('.modal-header h3').textContent = 'Add Action';
      document.getElementById('add-submit-btn').innerHTML = '<span class="material-icons">add</span> Add Action';
      document.getElementById('addActionModal').classList.add('show');
      document.getElementById('add-task').focus();
    },

    submitAction: function(e) {
      if (e) e.preventDefault();

      var task = document.getElementById('add-task').value.trim();
      var assigned = document.getElementById('add-assigned').value.trim();
      var category = document.getElementById('add-category').value;
      var solution = document.getElementById('add-solution').value.trim();
      var priority = document.getElementById('add-priority').value;
      var dueDate = document.getElementById('add-due').value;
      var notes = document.getElementById('add-notes').value.trim();

      if (!task || !assigned) {
        alert('Task and Assigned To are required');
        return false;
      }

      var btn = document.getElementById('add-submit-btn');
      btn.disabled = true;
      var isEditing = !!Team.editingActionId;
      btn.innerHTML = '<span class="loading-spinner-sm"></span> ' + (isEditing ? 'Saving...' : 'Adding...');

      var actionData = {
        task: task,
        assigned_to: assigned,
        category: category,
        solution_id: solution || '',
        priority: priority,
        due_date: dueDate,
        notes: notes
      };

      if (isEditing) {
        // Update existing action
        google.script.run
          .withSuccessHandler(function() {
            btn.innerHTML = '<span class="material-icons">check</span> Saved!';
            setTimeout(function() {
              Team.closeModal('addActionModal');
              btn.disabled = false;
              btn.innerHTML = '<span class="material-icons">add</span> Add Action';
              Team.editingActionId = null;
              Team.loadActions();
            }, 600);
          })
          .withFailureHandler(function(err) {
            btn.disabled = false;
            btn.innerHTML = '<span class="material-icons">save</span> Save Changes';
            alert('Failed to update action: ' + err);
          })
          .updateAction(Team.editingActionId, actionData);
      } else {
        // Create new action
        actionData.status = 'not_started';
        actionData.source_document = 'Dashboard';
        actionData.source_date = new Date().toISOString().split('T')[0];

        google.script.run
          .withSuccessHandler(function() {
            btn.innerHTML = '<span class="material-icons">check</span> Added!';
            setTimeout(function() {
              Team.closeModal('addActionModal');
              btn.disabled = false;
              btn.innerHTML = '<span class="material-icons">add</span> Add Action';
              Team.loadActions();
            }, 600);
          })
          .withFailureHandler(function(err) {
            btn.disabled = false;
            btn.innerHTML = '<span class="material-icons">add</span> Add Action';
            alert('Failed to add action: ' + err);
          })
          .createAction(actionData);
      }

      return false;
    },

    normalizeActionStatus: function(status) {
      if (!status) return 'not_started';
      var s = status.toLowerCase().trim().replace(' ', '_');
      if (s === 'done') return 'done';
      if (s === 'in_progress') return 'in_progress';
      if (s === 'pending') return 'pending';
      return 'not_started';
    },

    formatActionStatus: function(status) {
      var map = {
        'pending': 'Pending',
        'not_started': 'Not Started',
        'in_progress': 'In Progress',
        'done': 'Done'
      };
      return map[status] || status;
    },

    showActionsEmpty: function(show) {
      var emptyEl = document.getElementById('actions-empty');
      var contentEl = document.querySelector('.actions-content');
      if (emptyEl) emptyEl.style.display = show ? 'flex' : 'none';
      if (contentEl) contentEl.style.display = show ? 'none' : 'block';
    },

  };

  // Initialize on load
  Team.init();
</script>
